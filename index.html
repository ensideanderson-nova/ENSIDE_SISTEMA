<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ENSIDE MASTER v19.0 - Sistema Completo Integrado</title>
    <!-- Tailwind CSS do c√≥digo ULTRA -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fonte Inter do Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0ea5e9;
            --primary-dark: #0284c7;
            --primary-light: #38bdf8;
            --bg-dark: #0f172a;
            --bg-light: #1e293b;
            --text: #e2e8f0;
            --text-muted: #94a3b8;
        }

        /* TEMAS */
        body.theme-blue { --primary: #0ea5e9; --primary-dark: #0284c7; --primary-light: #38bdf8; }
        body.theme-purple { --primary: #a855f7; --primary-dark: #9333ea; --primary-light: #c084fc; }
        body.theme-green { --primary: #22c55e; --primary-dark: #16a34a; --primary-light: #4ade80; }
        body.theme-red { --primary: #ef4444; --primary-dark: #dc2626; --primary-light: #f87171; }
        body.theme-orange { --primary: #f59e0b; --primary-dark: #d97706; --primary-light: #fbbf24; }
        
        body.light-mode {
            --bg-dark: #f1f5f9;
            --bg-light: #e2e8f0;
            --text: #1e293b;
            --text-muted: #475569;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Custom scrollbar do c√≥digo ULTRA */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #475569;
        }

        /* Bot√µes de filtro */
        .filter-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            background: rgba(0,0,0,0.3);
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }
        .filter-btn:hover {
            background: rgba(14,165,233,0.3);
            color: var(--text);
        }
        .filter-btn.active {
            background: var(--primary);
            color: white;
        }

        /* Abas da Planilha */
        .planilha-tab {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            background: rgba(0,0,0,0.3);
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85em;
        }
        .planilha-tab:hover {
            background: rgba(34,197,94,0.3);
            color: var(--text);
        }
        .planilha-tab.active {
            background: #22c55e;
            color: white;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-light) 100%);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* HEADER */
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(14, 165, 233, 0.3);
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(14, 165, 233, 0.1);
        }

        h1 {
            font-size: 2.5em;
            color: var(--primary);
            margin-bottom: 10px;
            text-shadow: 0 0 20px currentColor;
            letter-spacing: 1px;
        }

        /* THEME SWITCHER */
        .theme-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 8px;
            background: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }
        .theme-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }
        .theme-btn:hover { transform: scale(1.2); }
        .theme-btn.active { border-color: white; }
        .theme-btn.blue { background: #0ea5e9; }
        .theme-btn.purple { background: #a855f7; }
        .theme-btn.green { background: #22c55e; }
        .theme-btn.red { background: #ef4444; }
        .theme-btn.orange { background: #f59e0b; }
        
        /* ESTILOS PARA CARDS DE CATEGORIA */
        .categoria-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .categoria-card.active {
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(14, 165, 233, 0.4);
        }
        .subcategoria-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .subcategoria-item:hover {
            background: rgba(14, 165, 233, 0.15);
            border-color: var(--primary);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.3s ease forwards;
        }
        
        .dark-toggle {
            background: linear-gradient(135deg, #fbbf24, #1e293b);
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .subtitle {
            color: #94a3b8;
            font-size: 1.1em;
            margin-bottom: 20px;
        }

        .version-badge {
            display: inline-block;
            background: rgba(14, 165, 233, 0.2);
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-top: 10px;
            font-weight: 600;
        }

        /* STATS */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: rgba(14, 165, 233, 0.1);
            border: 1px solid rgba(14, 165, 233, 0.3);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            background: rgba(var(--primary-rgb, 14, 165, 233), 0.15);
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .stat-value {
            font-size: 2em;
            color: var(--primary);
            font-weight: bold;
        }

        .stat-label {
            color: #94a3b8;
            font-size: 0.9em;
            margin-top: 5px;
        }

        /* TABS */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(14, 165, 233, 0.2);
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .tab-btn {
            background: transparent;
            color: #94a3b8;
            border: none;
            padding: 12px 24px;
            cursor: pointer;
            font-size: 1em;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-weight: 500;
        }

        .tab-btn:hover {
            color: var(--primary);
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* SECTIONS */
        .section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .section-title {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        h2 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        h3 {
            color: var(--primary);
            margin: 20px 0 15px 0;
            font-size: 1.2em;
        }

        /* FORMS */
        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #cbd5e1;
            font-size: 0.95em;
            font-weight: 500;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #e2e8f0;
            font-size: 1em;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(var(--primary-rgb, 14, 165, 233), 0.1);
            box-shadow: 0 0 15px rgba(var(--primary-rgb, 14, 165, 233), 0.3);
        }

        /* BUTTONS */
        button {
            background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(14, 165, 233, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: rgba(14, 165, 233, 0.2);
            color: #0ea5e9;
            border: 1px solid #0ea5e9;
        }

        .btn-secondary:hover {
            background: rgba(14, 165, 233, 0.3);
        }

        /* DROP ZONE */
        .drop-zone {
            border: 2px dashed #0ea5e9;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            background: rgba(14, 165, 233, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px 0;
        }

        .drop-zone:hover,
        .drop-zone.dragover {
            background: rgba(14, 165, 233, 0.15);
            border-color: #06b6d4;
            box-shadow: 0 0 30px rgba(14, 165, 233, 0.2);
        }

        .drop-zone p {
            color: #0ea5e9;
            margin: 10px 0;
            font-weight: 600;
            font-size: 1.1em;
        }

        .drop-zone small {
            color: #94a3b8;
            display: block;
        }

        /* TABLES */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95em;
        }

        th {
            background: rgba(14, 165, 233, 0.2);
            padding: 12px;
            text-align: left;
            color: #0ea5e9;
            border-bottom: 2px solid rgba(14, 165, 233, 0.3);
            font-weight: 600;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid rgba(14, 165, 233, 0.1);
            color: #cbd5e1;
        }

        tr:hover {
            background: rgba(14, 165, 233, 0.08);
        }

        /* BADGES */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin: 2px;
        }

        .badge-success {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .badge-error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* PROGRESS */
        .progress-bar {
            width: 100%;
            height: 25px;
            background: rgba(14, 165, 233, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
            border: 1px solid rgba(14, 165, 233, 0.3);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0ea5e9 0%, #06b6d4 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 12px;
        }

        /* INFO BOX */
        .info-box {
            background: rgba(34, 197, 94, 0.1);
            border-left: 4px solid #22c55e;
            padding: 15px 20px;
            border-radius: 8px;
            margin: 20px 0;
            color: #cbd5e1;
            font-size: 0.95em;
            line-height: 1.6;
        }

        .code-block {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(14, 165, 233, 0.3);
            border-radius: 8px;
            padding: 15px;
            overflow-x: auto;
            margin: 15px 0;
        }

        .code-block code {
            color: #0ea5e9;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9em;
        }

        /* GRID */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .grid-card {
            background: rgba(14, 165, 233, 0.08);
            border: 1px solid rgba(14, 165, 233, 0.2);
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .grid-card:hover {
            border-color: #0ea5e9;
            background: rgba(14, 165, 233, 0.12);
            transform: translateY(-3px);
        }

        /* SCROLLBAR */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #0f172a;
        }

        ::-webkit-scrollbar-thumb {
            background: #0ea5e9;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #06b6d4;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            h1 { font-size: 1.8em; }
            .tabs { gap: 5px; }
            .tab-btn { padding: 10px 16px; font-size: 0.9em; }
            .grid { grid-template-columns: 1fr; }
            body { padding: 10px; }
        }

        /* ANIMA√á√ïES CSS do c√≥digo ULTRA */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .animate-gradient { animation: gradient 3s ease infinite; background-size: 200% 200%; }
        .animate-fadeIn { animation: fadeIn 0.3s ease-out; }
        .animate-slideIn { animation: slideIn 0.3s ease-out; }
    </style>
</head>
<body class="theme-blue">
    <!-- THEME SWITCHER -->
    <div class="theme-switcher">
        <button class="theme-btn blue active" onclick="setTheme('blue')" title="Azul"></button>
        <button class="theme-btn purple" onclick="setTheme('purple')" title="Roxo"></button>
        <button class="theme-btn green" onclick="setTheme('green')" title="Verde"></button>
        <button class="theme-btn red" onclick="setTheme('red')" title="Vermelho"></button>
        <button class="theme-btn orange" onclick="setTheme('orange')" title="Laranja"></button>
        <button class="theme-btn dark-toggle" onclick="toggleDarkMode()" title="Modo Claro/Escuro">‚òº</button>
    </div>

    <div class="container">
        <!-- HEADER -->
        <header>
            <h1>üèÜ ENSIDE MASTER v19.0</h1>
            <p class="subtitle">Sistema Completo | Importador Universal | GitHub Integrado</p>
            <div class="version-badge">‚úÖ v19.0 INTEGRADO - Sincronizado com Planilha</div>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value">7.055+</div>
                    <div class="stat-label">Contatos Totais</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">1.200+</div>
                    <div class="stat-label">Fornecedores</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">100%</div>
                    <div class="stat-label">Operacional</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">‚àû</div>
                    <div class="stat-label">Possibilidades</div>
                </div>
            </div>
        </header>

        <!-- TABS -->
        <div class="tabs">
            <button class="tab-btn active" onclick="mudarAba('marketing')" style="background: linear-gradient(135deg, #22c55e, #16a34a); color: white;">üè† In√≠cio</button>
            <button class="tab-btn" onclick="mudarAba('importador')">üì• Importador Universal</button>
            <button class="tab-btn" onclick="mudarAba('processador')">‚öôÔ∏è Processador</button>
            <button class="tab-btn" onclick="mudarAba('dashboard')">üìä Dashboard</button>
            <button class="tab-btn" onclick="mudarAba('evolution')">üì± Evolution API</button>
            <button class="tab-btn" onclick="mudarAba('multiia')">ü§ñ Multi-IA</button>
            <button class="tab-btn" onclick="mudarAba('triagem')">üéØ Triagem IA</button>
            <button class="tab-btn" onclick="mudarAba('listas')">üìù Listas WhatsApp</button>
            <button class="tab-btn" onclick="mudarAba('github')">üêô GitHub API</button>
            <button class="tab-btn" onclick="mudarAba('sincronizacao')">üîÑ Sincroniza√ß√£o</button>
            <button class="tab-btn" onclick="mudarAba('planilha')">üìä Planilha Integrada</button>
            <button class="tab-btn" onclick="mudarAba('aprendizados')">üí° Aprendizados</button>
            <button class="tab-btn" onclick="mudarAba('documentacao')">üìñ Documenta√ß√£o</button>
            <button class="tab-btn" onclick="mudarAba('madeirasultra')" style="background: linear-gradient(135deg, #10b981, #059669); color: white;">üå≤ Madeiras Ultra</button>
            <button class="tab-btn" onclick="mudarAba('captacaofretes')" style="background: linear-gradient(135deg, #FFD700, #FFA500); color: #000;">üöö Capta√ß√£o Fretes</button>
            <button class="tab-btn" onclick="mudarAba('contatoscrm')" style="background: linear-gradient(135deg, #ec4899, #be185d); color: white;">üìä Contatos CRM</button>
            <button class="tab-btn" onclick="mudarAba('fretesdisponiveis')" style="background: linear-gradient(135deg, #8b5cf6, #6d28d9); color: white;">üì¶ Fretes Dispon√≠veis</button>
            <button class="tab-btn" onclick="abrirCRMContatos()" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white;">üìá CRM Contatos</button>
            <button class="tab-btn" onclick="abrirFretesDisponiveis()" style="background: linear-gradient(135deg, #8b5cf6, #6d28d9); color: white;">üì¶ Fretes Dispon√≠veis</button>
        </div>

        <!-- ==================== ABA MARKETING/IN√çCIO ==================== -->
        <div id="marketing" class="tab-content active">
            <!-- LOGO E HEADER -->
            <div style="text-align: center; padding: 40px 20px; background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(14, 165, 233, 0.1)); border-radius: 20px; margin-bottom: 30px; border: 1px solid rgba(34, 197, 94, 0.3);">
                <div style="font-size: 4em; margin-bottom: 15px;">üå≤</div>
                <h1 style="font-size: 2.5em; color: #22c55e; margin-bottom: 10px; text-shadow: 0 0 30px rgba(34, 197, 94, 0.5);">ENSIDE MADEIRAS</h1>
                <p style="font-size: 1.3em; color: #94a3b8; margin-bottom: 5px;">Solu√ß√µes Completas em Madeira Tratada</p>
                <p style="color: #0ea5e9;">Eucalipto | Pinus | Mour√µes | Postes | Estacas</p>
            </div>

            <!-- DESTAQUES -->
            <div class="grid" style="margin-bottom: 30px;">
                <div class="grid-card" style="text-align: center; border-left: 4px solid #22c55e;">
                    <div style="font-size: 2.5em; margin-bottom: 10px;">üè≠</div>
                    <h3 style="color: #22c55e;">+1.200</h3>
                    <p style="color: #94a3b8;">Fornecedores Cadastrados</p>
                </div>
                <div class="grid-card" style="text-align: center; border-left: 4px solid #0ea5e9;">
                    <div style="font-size: 2.5em; margin-bottom: 10px;">üöö</div>
                    <h3 style="color: #0ea5e9;">+377</h3>
                    <p style="color: #94a3b8;">Transportadores Ativos</p>
                </div>
                <div class="grid-card" style="text-align: center; border-left: 4px solid #f59e0b;">
                    <div style="font-size: 2.5em; margin-bottom: 10px;">üí∞</div>
                    <h3 style="color: #f59e0b;">Melhores Pre√ßos</h3>
                    <p style="color: #94a3b8;">Negocia√ß√£o Direta</p>
                </div>
                <div class="grid-card" style="text-align: center; border-left: 4px solid #a855f7;">
                    <div style="font-size: 2.5em; margin-bottom: 10px;">‚úÖ</div>
                    <h3 style="color: #a855f7;">Qualidade</h3>
                    <p style="color: #94a3b8;">Tratamento CCA Certificado</p>
                </div>
            </div>

            <!-- FORMUL√ÅRIO DE CONTATO -->
            <div class="section" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(14, 165, 233, 0.1)); border: 2px solid rgba(34, 197, 94, 0.4); border-radius: 20px; padding: 40px; max-width: 600px; margin: 0 auto;">
                <h2 style="text-align: center; color: #22c55e; margin-bottom: 10px; font-size: 1.8em;">üìû Entre em Contato</h2>
                <p style="text-align: center; color: #94a3b8; margin-bottom: 30px;">Deixe seus dados e retornaremos em breve!</p>
                
                <form id="formContatoMarketing">
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; color: #22c55e; font-weight: 600;">Nome *</label>
                        <input type="text" id="marketingNome" placeholder="Seu nome completo" required style="width: 100%; padding: 15px; background: rgba(0,0,0,0.4); border: 2px solid rgba(34, 197, 94, 0.3); border-radius: 10px; color: #fff; font-size: 1em;">
                    </div>
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; color: #22c55e; font-weight: 600;">Telefone/WhatsApp *</label>
                        <input type="tel" id="marketingTelefone" placeholder="(00) 00000-0000" required style="width: 100%; padding: 15px; background: rgba(0,0,0,0.4); border: 2px solid rgba(34, 197, 94, 0.3); border-radius: 10px; color: #fff; font-size: 1em;">
                    </div>
                    <div class="form-group" style="margin-bottom: 25px;">
                        <label style="display: block; margin-bottom: 8px; color: #22c55e; font-weight: 600;">Interesse</label>
                        <select id="marketingInteresse" style="width: 100%; padding: 15px; background: rgba(0,0,0,0.4); border: 2px solid rgba(34, 197, 94, 0.3); border-radius: 10px; color: #fff; font-size: 1em;">
                            <option value="comprar">Quero comprar madeira</option>
                            <option value="vender">Quero vender madeira</option>
                            <option value="frete">Preciso de frete</option>
                            <option value="motorista">Sou motorista</option>
                            <option value="outro">Outro assunto</option>
                        </select>
                    </div>
                    <button type="button" onclick="enviarContatoMarketing()" style="width: 100%; padding: 18px; background: linear-gradient(135deg, #22c55e, #16a34a); border: none; border-radius: 12px; color: white; font-size: 1.2em; font-weight: 700; cursor: pointer; transition: all 0.3s ease;">
                        üì© Enviar Mensagem
                    </button>
                </form>
                <div id="statusContatoMarketing" style="margin-top: 20px; text-align: center;"></div>
            </div>

            <!-- SERVI√áOS -->
            <div class="section" style="margin-top: 40px;">
                <h3 style="text-align: center; color: var(--primary); margin-bottom: 25px; font-size: 1.5em;">üåü Nossos Servi√ßos</h3>
                <div class="grid">
                    <div class="grid-card">
                        <h4 style="color: #22c55e;">ü™µ Mour√µes Tratados</h4>
                        <p style="color: #94a3b8; font-size: 0.9em;">2,00m a 3,00m - Tratamento CCA</p>
                        <p style="color: #f59e0b; font-weight: bold;">A partir de R$ 18,00</p>
                    </div>
                    <div class="grid-card">
                        <h4 style="color: #22c55e;">ü™® Postes de Eucalipto</h4>
                        <p style="color: #94a3b8; font-size: 0.9em;">7m a 12m - Alta Resist√™ncia</p>
                        <p style="color: #f59e0b; font-weight: bold;">A partir de R$ 95,00</p>
                    </div>
                    <div class="grid-card">
                        <h4 style="color: #22c55e;">ü™µ Estacas</h4>
                        <p style="color: #94a3b8; font-size: 0.9em;">Diversos tamanhos</p>
                        <p style="color: #f59e0b; font-weight: bold;">A partir de R$ 8,00</p>
                    </div>
                    <div class="grid-card">
                        <h4 style="color: #22c55e;">üöö Frete</h4>
                        <p style="color: #94a3b8; font-size: 0.9em;">Entrega em todo Brasil</p>
                        <p style="color: #f59e0b; font-weight: bold;">Consulte valores</p>
                    </div>
                </div>
            </div>

            <!-- INFO BOX -->
            <div class="info-box" style="margin-top: 30px; text-align: center;">
                <strong>üì± WhatsApp:</strong> Clique no bot√£o abaixo para falar conosco diretamente!<br><br>
                <a href="https://wa.me/5500000000000" target="_blank" style="display: inline-block; padding: 15px 30px; background: #25D366; color: white; border-radius: 50px; text-decoration: none; font-weight: bold;">üí¨ Chamar no WhatsApp</a>
            </div>
        </div>

        <!-- ==================== ABA IMPORTADOR ==================== -->
        <div id="importador" class="tab-content">
            <div class="section">
                <div class="section-title">üì• Importador Universal Completo</div>
                <p style="color: #94a3b8; margin-bottom: 20px;">
                    Importe dados de m√∫ltiplas fontes | Detecta automaticamente | Organiza por tipo | Move para pasta correta
                </p>
            </div>

            <div class="section">
                <h3>üìÇ Selecione seus Arquivos</h3>
                <p style="color: #94a3b8; margin-bottom: 20px;">Suportados: CSV, JSON, Excel, TXT, XML</p>
                
                <div class="drop-zone" id="dropZone">
                    <p>üìÅ Arraste arquivos aqui ou use os bot√µes abaixo</p>
                    <small>CSV ‚Ä¢ JSON ‚Ä¢ XLSX ‚Ä¢ XLS ‚Ä¢ TXT ‚Ä¢ XML</small>
                    <input type="file" id="fileInput" multiple style="display:none;" accept=".csv,.json,.xlsx,.xls,.txt,.xml">
                    <div style="margin-top: 20px; display: flex; gap: 15px; justify-content: center;">
                        <button onclick="event.stopPropagation(); importarArquivos()" style="background: linear-gradient(135deg, #22c55e, #16a34a); padding: 12px 25px;">üìÑ Arquivos</button>
                        <button onclick="event.stopPropagation(); importarPastas()" style="background: linear-gradient(135deg, #f59e0b, #d97706); padding: 12px 25px;">üìÅ Pasta</button>
                    </div>
                </div>

                <!-- CATEGORIAS INTELIGENTES PARA IMPORTADOR UNIVERSAL -->
                <div class="section" style="margin-top: 20px; background: rgba(14, 165, 233, 0.05); border: 1px solid rgba(14, 165, 233, 0.2); border-radius: 12px; padding: 20px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">ü§ñ Classifica√ß√£o Inteligente de Arquivos</h3>
                    <p style="color: #94a3b8; margin-bottom: 20px; font-size: 0.9em;">
                        A IA analisa o conte√∫do e classifica automaticamente em categorias e subcategorias
                    </p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>üìÇ Categoria Principal</label>
                            <select id="categoriaPrincipal" onchange="atualizarSubcategorias()">
                                <option value="auto">ü§ñ Detectar com IA</option>
                                <option value="dados">üìä Dados e Planilhas</option>
                                <option value="documentos">üìÑ Documentos</option>
                                <option value="imagens">üñºÔ∏è Imagens</option>
                                <option value="videos">üé¨ V√≠deos</option>
                                <option value="audios">üéµ √Åudios</option>
                                <option value="compactados">üì¶ Arquivos Compactados</option>
                                <option value="codigo">üíª C√≥digo e Desenvolvimento</option>
                                <option value="emails">üìß Emails e Mensagens</option>
                                <option value="calendario">üìÖ Calend√°rio e Eventos</option>
                                <option value="enside">üå≤ ENSIDE Madeiras</option>
                                <option value="whatsapp">üì± WhatsApp e Redes Sociais</option>
                                <option value="design">üé® Design e Criativo</option>
                                <option value="sistema">üîß Sistema e Configura√ß√£o</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üìÅ Subcategoria</label>
                            <select id="subcategoria">
                                <option value="auto">ü§ñ Detectar Automaticamente</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- MAPEAMENTO DE CATEGORIAS POR EXTENS√ÉO -->
                <div id="categoriaDetectada" style="display: none; margin-top: 15px; padding: 15px; background: rgba(34, 197, 94, 0.1); border-left: 4px solid #22c55e; border-radius: 8px;">
                    <strong style="color: #22c55e;">‚úÖ Categoria Detectada:</strong>
                    <span id="categoriaDetectadaTexto" style="color: #e2e8f0; margin-left: 10px;"></span>
                </div>

                <!-- ========== SE√á√ÉO DE TODAS AS CATEGORIAS ========== -->
                <div class="section" style="margin-top: 25px; background: linear-gradient(135deg, rgba(14, 165, 233, 0.08), rgba(168, 85, 247, 0.08)); border: 1px solid rgba(14, 165, 233, 0.3); border-radius: 16px; padding: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
                        <h3 style="color: var(--primary); font-size: 1.3em;">
                            üìÅ Todas as Categorias do Importador Universal
                        </h3>
                        <span style="background: linear-gradient(135deg, var(--primary), #a855f7); padding: 6px 14px; border-radius: 20px; font-size: 0.85em; font-weight: 600;">
                            14 Categorias | 70+ Subcategorias
                        </span>
                    </div>
                    <p style="color: #94a3b8; margin-bottom: 25px; font-size: 0.95em;">
                        Clique em uma categoria para ver suas subcategorias e extens√µes suportadas
                    </p>
                    
                    <!-- GRID DE CATEGORIAS -->
                    <div id="gridCategorias" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
                        <!-- Categoria: Dados e Planilhas -->
                        <div class="categoria-card" onclick="toggleSubcategorias('dados')" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(34, 197, 94, 0.05)); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 18px; cursor: pointer; transition: all 0.3s ease;">
                            <div style="font-size: 2em; margin-bottom: 8px;">üìä</div>
                            <div style="font-weight: 600; color: #22c55e; margin-bottom: 5px;">Dados e Planilhas</div>
                            <div style="font-size: 0.8em; color: #94a3b8;">CSV, Excel, JSON, XML</div>
                            <div style="font-size: 0.75em; color: #64748b; margin-top: 8px;">8 subcategorias</div>
                        </div>
                        
                        <!-- Categoria: Documentos -->
                        <div class="categoria-card" onclick="toggleSubcategorias('documentos')" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(59, 130, 246, 0.05)); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 18px; cursor: pointer; transition: all 0.3s ease;">
                            <div style="font-size: 2em; margin-bottom: 8px;">üìÑ</div>
                            <div style="font-weight: 600; color: #3b82f6; margin-bottom: 5px;">Documentos</div>
                            <div style="font-size: 0.8em; color: #94a3b8;">PDF, Word, Pages, TXT</div>
                            <div style="font-size: 0.75em; color: #64748b; margin-top: 8px;">7 subcategorias</div>
                        </div>
                        
                        <!-- Categoria: Imagens -->
                        <div class="categoria-card" onclick="toggleSubcategorias('imagens')" style="background: linear-gradient(135deg, rgba(236, 72, 153, 0.15), rgba(236, 72, 153, 0.05)); border: 1px solid rgba(236, 72, 153, 0.3); border-radius: 12px; padding: 18px; cursor: pointer; transition: all 0.3s ease;">
                            <div style="font-size: 2em; margin-bottom: 8px;">üñºÔ∏è</div>
                            <div style="font-weight: 600; color: #ec4899; margin-bottom: 5px;">Imagens</div>
                            <div style="font-size: 0.8em; color: #94a3b8;">JPG, PNG, GIF, RAW</div>
                            <div style="font-size: 0.75em; color: #64748b; margin-top: 8px;">6 subcategorias</div>
                        </div>
                        
                        <!-- Categoria: V√≠deos -->
                        <div class="categoria-card" onclick="toggleSubcategorias('videos')" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(239, 68, 68, 0.05)); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px; padding: 18px; cursor: pointer; transition: all 0.3s ease;">
                            <div style="font-size: 2em; margin-bottom: 8px;">üé¨</div>
                            <div style="font-weight: 600; color: #ef4444; margin-bottom: 5px;">V√≠deos</div>
                            <div style="font-size: 0.8em; color: #94a3b8;">MP4, MOV, AVI, MKV</div>
                            <div style="font-size: 0.75em; color: #64748b; margin-top: 8px;">4 subcategorias</div>
                        </div>
                        
                        <!-- Categoria: √Åudios -->
                        <div class="categoria-card" onclick="toggleSubcategorias('audios')" style="background: linear-gradient(135deg, rgba(168, 85, 247, 0.15), rgba(168, 85, 247, 0.05)); border: 1px solid rgba(168, 85, 247, 0.3); border-radius: 12px; padding: 18px; cursor: pointer; transition: all 0.3s ease;">
                            <div style="font-size: 2em; margin-bottom: 8px;">üéµ</div>
                            <div style="font-weight: 600; color: #a855f7; margin-bottom: 5px;">√Åudios</div>
                            <div style="font-size: 0.8em; color: #94a3b8;">MP3, WAV, AAC, FLAC</div>
                            <div style="font-size: 0.75em; color: #64748b; margin-top: 8px;">3 subcategorias</div>
                        </div>
                        
                        <!-- Categoria: Compactados -->
                        <div class="categoria-card" onclick="toggleSubcategorias('compactados')" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(245, 158, 11, 0.05)); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 12px; padding: 18px; cursor: pointer; transition: all 0.3s ease;">
                            <div style="font-size: 2em; margin-bottom: 8px;">üì¶</div>
                            <div style="font-weight: 600; color: #f59e0b; margin-bottom: 5px;">Compactados</div>
                            <div style="font-size: 0.8em; color: #94a3b8;">ZIP, RAR, 7Z, TAR</div>
                            <div style="font-size: 0.75em; color: #64748b; margin-top: 8px;">4 subcategorias</div>
                        </div>
                        
                        <!-- Categoria: C√≥digo -->
                        <div class="categoria-card" onclick="toggleSubcategorias('codigo')" style="background: linear-gradient(135deg, rgba(20, 184, 166, 0.15), rgba(20, 184, 166, 0.05)); border: 1px solid rgba(20, 184, 166, 0.3); border-radius: 12px; padding: 18px; cursor: pointer; transition: all 0.3s ease;">
                            <div style="font-size: 2em; margin-bottom: 8px;">üíª</div>
                            <div style="font-weight: 600; color: #14b8a6; margin-bottom: 5px;">C√≥digo</div>
                            <div style="font-size: 0.8em; color: #94a3b8;">HTML, JS, Python, Swift</div>
                            <div style="font-size: 0.75em; color: #64748b; margin-top: 8px;">5 subcategorias</div>
                        </div>
                        
                        <!-- Categoria: Emails -->
                        <div class="categoria-card" onclick="toggleSubcategorias('emails')" style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(99, 102, 241, 0.05)); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 12px; padding: 18px; cursor: pointer; transition: all 0.3s ease;">
                            <div style="font-size: 2em; margin-bottom: 8px;">üìß</div>
                            <div style="font-weight: 600; color: #6366f1; margin-bottom: 5px;">Emails</div>
                            <div style="font-size: 0.8em; color: #94a3b8;">EML, MSG, MBOX</div>
                            <div style="font-size: 0.75em; color: #64748b; margin-top: 8px;">3 subcategorias</div>
                        </div>
                        
                        <!-- Categoria: Calend√°rio -->
                        <div class="categoria-card" onclick="toggleSubcategorias('calendario')" style="background: linear-gradient(135deg, rgba(6, 182, 212, 0.15), rgba(6, 182, 212, 0.05)); border: 1px solid rgba(6, 182, 212, 0.3); border-radius: 12px; padding: 18px; cursor: pointer; transition: all 0.3s ease;">
                            <div style="font-size: 2em; margin-bottom: 8px;">üìÖ</div>
                            <div style="font-weight: 600; color: #06b6d4; margin-bottom: 5px;">Calend√°rio</div>
                            <div style="font-size: 0.8em; color: #94a3b8;">ICS, VCS, iCal</div>
                            <div style="font-size: 0.75em; color: #64748b; margin-top: 8px;">3 subcategorias</div>
                        </div>
                        
                        <!-- Categoria: ENSIDE Madeiras -->
                        <div class="categoria-card" onclick="toggleSubcategorias('enside')" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(132, 204, 22, 0.1)); border: 2px solid rgba(34, 197, 94, 0.5); border-radius: 12px; padding: 18px; cursor: pointer; transition: all 0.3s ease;">
                            <div style="font-size: 2em; margin-bottom: 8px;">üå≤</div>
                            <div style="font-weight: 600; color: #22c55e; margin-bottom: 5px;">ENSIDE Madeiras</div>
                            <div style="font-size: 0.8em; color: #94a3b8;">Eucalipto, Pinus, Tratada</div>
                            <div style="font-size: 0.75em; color: #64748b; margin-top: 8px;">12 subcategorias</div>
                        </div>
                        
                        <!-- Categoria: WhatsApp -->
                        <div class="categoria-card" onclick="toggleSubcategorias('whatsapp')" style="background: linear-gradient(135deg, rgba(37, 211, 102, 0.15), rgba(37, 211, 102, 0.05)); border: 1px solid rgba(37, 211, 102, 0.3); border-radius: 12px; padding: 18px; cursor: pointer; transition: all 0.3s ease;">
                            <div style="font-size: 2em; margin-bottom: 8px;">üì±</div>
                            <div style="font-weight: 600; color: #25d366; margin-bottom: 5px;">WhatsApp</div>
                            <div style="font-size: 0.8em; color: #94a3b8;">Conversas, M√≠dia, Backup</div>
                            <div style="font-size: 0.75em; color: #64748b; margin-top: 8px;">4 subcategorias</div>
                        </div>
                        
                        <!-- Categoria: Design -->
                        <div class="categoria-card" onclick="toggleSubcategorias('design')" style="background: linear-gradient(135deg, rgba(244, 63, 94, 0.15), rgba(244, 63, 94, 0.05)); border: 1px solid rgba(244, 63, 94, 0.3); border-radius: 12px; padding: 18px; cursor: pointer; transition: all 0.3s ease;">
                            <div style="font-size: 2em; margin-bottom: 8px;">üé®</div>
                            <div style="font-weight: 600; color: #f43f5e; margin-bottom: 5px;">Design</div>
                            <div style="font-size: 0.8em; color: #94a3b8;">PSD, AI, Figma, Canva</div>
                            <div style="font-size: 0.75em; color: #64748b; margin-top: 8px;">4 subcategorias</div>
                        </div>
                        
                        <!-- Categoria: Sistema -->
                        <div class="categoria-card" onclick="toggleSubcategorias('sistema')" style="background: linear-gradient(135deg, rgba(148, 163, 184, 0.15), rgba(148, 163, 184, 0.05)); border: 1px solid rgba(148, 163, 184, 0.3); border-radius: 12px; padding: 18px; cursor: pointer; transition: all 0.3s ease;">
                            <div style="font-size: 2em; margin-bottom: 8px;">üîß</div>
                            <div style="font-weight: 600; color: #94a3b8; margin-bottom: 5px;">Sistema</div>
                            <div style="font-size: 0.8em; color: #94a3b8;">Plist, Config, Backup</div>
                            <div style="font-size: 0.75em; color: #64748b; margin-top: 8px;">3 subcategorias</div>
                        </div>
                        
                        <!-- Categoria: Outros -->
                        <div class="categoria-card" onclick="toggleSubcategorias('outros')" style="background: linear-gradient(135deg, rgba(100, 116, 139, 0.15), rgba(100, 116, 139, 0.05)); border: 1px solid rgba(100, 116, 139, 0.3); border-radius: 12px; padding: 18px; cursor: pointer; transition: all 0.3s ease;">
                            <div style="font-size: 2em; margin-bottom: 8px;">üìÅ</div>
                            <div style="font-weight: 600; color: #64748b; margin-bottom: 5px;">Outros</div>
                            <div style="font-size: 0.8em; color: #94a3b8;">Arquivos diversos</div>
                            <div style="font-size: 0.75em; color: #64748b; margin-top: 8px;">N√£o classificados</div>
                        </div>
                        
                        <!-- Categoria: Triagem (PASTA MAC) -->
                        <div class="categoria-card" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(245, 158, 11, 0.05)); border: 2px solid rgba(245, 158, 11, 0.5); border-radius: 12px; padding: 18px; cursor: pointer; transition: all 0.3s ease;">
                            <div style="font-size: 2em; margin-bottom: 8px;">üìã</div>
                            <div style="font-weight: 600; color: #f59e0b; margin-bottom: 5px;">Triagem</div>
                            <div style="font-size: 0.8em; color: #94a3b8;">CPF, Banco, Conta, Extratos</div>
                            <div style="font-size: 0.75em; color: #64748b; margin-top: 8px;">4 subcategorias</div>
                            <a href="file:///Users/andersonenside/Triagem" style="display: inline-block; margin-top: 10px; padding: 6px 12px; background: #f59e0b; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.8em; text-decoration: none;">üìÇ ABRIR PASTA</a>
                        </div>
                        
                        <!-- Categoria: Doc Pessoais (PASTA MAC) -->
                        <div class="categoria-card" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(139, 92, 246, 0.05)); border: 2px solid rgba(139, 92, 246, 0.5); border-radius: 12px; padding: 18px; cursor: pointer; transition: all 0.3s ease;">
                            <div style="font-size: 2em; margin-bottom: 8px;">üë§</div>
                            <div style="font-weight: 600; color: #8b5cf6; margin-bottom: 5px;">Doc Pessoais</div>
                            <div style="font-size: 0.8em; color: #94a3b8;">RG, CNH, Certid√µes, Contratos</div>
                            <div style="font-size: 0.75em; color: #64748b; margin-top: 8px;">5 subcategorias</div>
                            <a href="file:///Users/andersonenside/Doc_Pessoais" style="display: inline-block; margin-top: 10px; padding: 6px 12px; background: #8b5cf6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.8em; text-decoration: none;">üìÇ ABRIR PASTA</a>
                        </div>
                    </div>
                    
                    <!-- PAINEL DE SUBCATEGORIAS (expande ao clicar) -->
                    <div id="painelSubcategorias" style="display: none; margin-top: 20px; background: rgba(0,0,0,0.3); border-radius: 12px; padding: 20px; border: 1px solid rgba(255,255,255,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4 id="tituloSubcategorias" style="color: var(--primary);">Subcategorias</h4>
                            <button onclick="fecharSubcategorias()" style="background: transparent; border: none; color: #94a3b8; cursor: pointer; font-size: 1.2em;">‚úï</button>
                        </div>
                        <div id="listaSubcategorias" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 10px;"></div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
                    <div class="form-group">
                        <label>Tipo de Dado</label>
                        <select id="tipoDado">
                            <option value="auto">üîç Detectar Automaticamente</option>
                            <option value="contatos">üë• Contatos</option>
                            <option value="fornecedores">üè≠ Fornecedores</option>
                            <option value="frete">üí∞ Fretes</option>
                            <option value="vendas">üìä Vendas</option>
                            <option value="estoque">üì¶ Estoque</option>
                            <option value="financeiro">üíµ Financeiro</option>
                            <option value="relatorios">üìà Relat√≥rios</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Separador (CSV)</label>
                        <select id="separator">
                            <option value=",">V√≠rgula (,)</option>
                            <option value=";">Ponto e v√≠rgula (;)</option>
                            <option value="\t">Tabula√ß√£o (Tab)</option>
                        </select>
                    </div>
                </div>

                <button onclick="processarImportacao()">‚ñ∂Ô∏è Processar Importa√ß√£o</button>
            </div>

            <div class="section" id="previewSection" style="display:none;">
                <h3>üëÅÔ∏è Visualiza√ß√£o de Dados</h3>
                <div class="table-container">
                    <table id="previewTable">
                        <thead id="tableHead"></thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                </div>
                <button onclick="confirmarImportacao()" style="margin-top: 20px;">‚úÖ Confirmar e Importar</button>
                <button class="btn-secondary" onclick="cancelarImportacao()" style="margin-left: 10px;">‚ùå Cancelar</button>
            </div>

            <div class="section" id="progressSection" style="display:none;">
                <h3>üìä Progresso</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar" style="width: 0%;">0%</div>
                </div>
                <p id="progressText" style="color: #0ea5e9; margin-top: 15px; font-weight: 600;"></p>
            </div>

            <div class="section" id="resultSection" style="display:none;">
                <h3>‚úÖ Importa√ß√£o Conclu√≠da</h3>
                <div id="resultContent"></div>
                <button onclick="novaImportacao()" style="margin-top: 20px;">üîÑ Nova Importa√ß√£o</button>
            </div>
        </div>

        <!-- ==================== ABA PROCESSADOR ==================== -->
        <div id="processador" class="tab-content">
            <div class="section">
                <div class="section-title">‚öôÔ∏è Processador de Dados</div>
                <p style="color: #94a3b8; margin-bottom: 20px;">
                    Valida | Limpa | Deduplicata | Normaliza | Organiza
                </p>
            </div>

            <div class="grid">
                <div class="grid-card">
                    <h3>‚úÖ Valida√ß√£o</h3>
                    <p style="color: #94a3b8; margin: 10px 0;">
                        Verifica integridade de dados, formatos corretos, campos obrigat√≥rios
                    </p>
                    <button class="btn-secondary" onclick="executarValidacao()">Validar</button>
                </div>

                <div class="grid-card">
                    <h3>üßπ Limpeza</h3>
                    <p style="color: #94a3b8; margin: 10px 0;">
                        Remove espa√ßos, normaliza fontes, padroniza formatos
                    </p>
                    <button class="btn-secondary" onclick="executarLimpeza()">Limpar</button>
                </div>

                <div class="grid-card">
                    <h3>üîó Deduplica√ß√£o</h3>
                    <p style="color: #94a3b8; margin: 10px 0;">
                        Identifica e remove registros duplicados por email, WhatsApp ou nome
                    </p>
                    <button class="btn-secondary" onclick="executarDeduplicacao()">Deduplicar</button>
                </div>

                <div class="grid-card">
                    <h3>üìÇ Organiza√ß√£o</h3>
                    <p style="color: #94a3b8; margin: 10px 0;">
                        Move arquivos processados para pastas por tipo/categoria
                    </p>
                    <button class="btn-secondary" onclick="executarOrganizacao()">Organizar</button>
                </div>
            </div>

            <div class="section" style="margin-top: 20px;">
                <h3>üìà Estat√≠sticas</h3>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value" id="statProcessados">0</div>
                        <div class="stat-label">Processados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statValidados">0</div>
                        <div class="stat-label">Validados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statErros">0</div>
                        <div class="stat-label">Erros</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statDuplicatas">0</div>
                        <div class="stat-label">Duplicatas</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== ABA DASHBOARD ==================== -->
        <div id="dashboard" class="tab-content">
            <div class="section">
                <div class="section-title">üìà Dashboard Executivo</div>
                <p style="color: #94a3b8;">Vis√£o geral de todos os dados do sistema</p>
            </div>

            <div class="section">
                <h3>üìä KPIs Principais</h3>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value">4.077</div>
                        <div class="stat-label">Total de Contatos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">1.200</div>
                        <div class="stat-label">Fornecedores Ativos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">377</div>
                        <div class="stat-label">Transportadores</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">2.500</div>
                        <div class="stat-label">Clientes</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>üìã √öltimas Importa√ß√µes</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Arquivo</th>
                                <th>Tipo</th>
                                <th>Registros</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>10/12/2025 14:30</td>
                                <td>contatos_dezembro.csv</td>
                                <td>üë• Contatos</td>
                                <td>145</td>
                                <td><span class="badge badge-success">‚úì Sucesso</span></td>
                            </tr>
                            <tr>
                                <td>09/12/2025 10:15</td>
                                <td>fornecedores_update.json</td>
                                <td>üè≠ Fornecedores</td>
                                <td>32</td>
                                <td><span class="badge badge-success">‚úì Sucesso</span></td>
                            </tr>
                            <tr>
                                <td>08/12/2025 15:45</td>
                                <td>vendas_mensal.xlsx</td>
                                <td>üìä Vendas</td>
                                <td>287</td>
                                <td><span class="badge badge-success">‚úì Sucesso</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ==================== ABA EVOLUTION API ==================== -->
        <div id="evolution" class="tab-content">
            <div class="section">
                <div class="section-title">üì± Evolution API - WhatsApp Autom√°tico</div>
                <p style="color: #94a3b8; margin-bottom: 20px;">
                    Integra√ß√£o completa com WhatsApp via Evolution API | Envio autom√°tico | QR Code | Status em tempo real
                </p>
            </div>

            <div class="section">
                <h3>‚öôÔ∏è Configura√ß√£o da Evolution API</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>URL da API</label>
                        <input type="text" id="evolutionUrl" placeholder="https://evolution-api.com/api" value="https://evolution-api.com/api">
                    </div>
                    <div class="form-group">
                        <label>API Key</label>
                        <input type="password" id="evolutionApiKey" placeholder="Sua chave de API" value="evolution-api-enside-2024-secret">
                    </div>
                </div>
                <div class="form-group">
                    <label>Nome da Inst√¢ncia</label>
                    <input type="text" id="evolutionInstance" placeholder="ENSIDE" value="ENSIDE">
                </div>
                    <div class="form-group">
                        <label>ID da Inst√¢ncia</label>
                        <input type="text" id="evolutionInstanceId" placeholder="ID da Inst√¢ncia" value="ENSIDE" readonly style="background: rgba(34, 197, 94, 0.1); border-color: #22c55e;">
                    </div>
                <div class="form-group">
                    <label>üîó Webhook URL</label>
                    <input type="text" id="webhookUrl" placeholder="URL do Webhook" value="https://evolution-api-enside.onrender.com/webhook" readonly style="background: rgba(14, 165, 233, 0.1); border-color: #0ea5e9;">
                    <small style="color: #94a3b8; display: block; margin-top: 5px;">‚ö†Ô∏è Webhook DESABILITADO no Evolution Manager (evita erros)</small>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button onclick="testarConexaoEvolution()" style="background: linear-gradient(135deg, #22c55e, #16a34a);">üîå Testar Conex√£o</button>
                    <button onclick="salvarConfigEvolution()" class="btn-secondary">üíæ Salvar Config</button>
                </div>
            </div>

            <div class="section">
                <h3>üì± Status da Inst√¢ncia</h3>
                <div class="stats">
                    <div class="stat-card" id="evolutionStatusCard">
                        <div class="stat-value" id="evolutionStatus">‚è≥</div>
                        <div class="stat-label">Status</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="evolutionMsgs">0</div>
                        <div class="stat-label">Mensagens Enviadas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="evolutionContacts">0</div>
                        <div class="stat-label">Contatos Ativos</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>üì∑ Conectar via QR Code</h3>
                <div style="text-align: center; padding: 20px;">
                    <div id="qrCodeContainer" style="background: white; padding: 20px; border-radius: 12px; display: inline-block; min-width: 200px; min-height: 200px;">
                        <p style="color: #333;">Clique para gerar QR Code</p>
                    </div>
                    <div style="margin-top: 15px;">
                        <button onclick="gerarQRCode()">üì∑ Gerar QR Code</button>
                        <button onclick="verificarConexao()" class="btn-secondary" style="margin-left: 10px;">üîÑ Verificar Conex√£o</button>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>üì§ Enviar Mensagem de Teste</h3>
                <div class="form-group">
                    <label>N√∫mero (com DDD)</label>
                    <input type="text" id="evolutionNumero" placeholder="5518999999999">
                </div>
                <div class="form-group">
                    <label>Mensagem</label>
                    <textarea id="evolutionMensagem" rows="3" placeholder="Digite sua mensagem de teste...">üå≤ Ol√°! Esta √© uma mensagem de teste do sistema ENSIDE MADEIRAS.</textarea>
                </div>
                <button onclick="enviarMensagemEvolution()">üì§ Enviar Mensagem</button>
            </div>

            <div class="section">
                <h3>üìä Envio em Massa</h3>
                <p style="color: #94a3b8; margin-bottom: 15px;">Envie mensagens para m√∫ltiplos contatos (limite: 256 por lista)</p>
                <div class="form-group">
                    <label>Selecionar Lista de Contatos</label>
                    <select id="evolutionLista">
                        <option value="">Selecione uma lista...</option>
                        <optgroup label="üìã Listas B√°sicas">
                            <option value="fornecedores">üè≠ Fornecedores (1.200)</option>
                            <option value="clientes">üë• Clientes (2.500)</option>
                            <option value="transportadores">üöö Transportadores (377)</option>
                        </optgroup>
                        <optgroup label="üìä Listas da Planilha (Sincronizadas)">
                            <option value="fornecedores_mouroes">ü™µ Fornecedores Mour√µes (180)</option>
                            <option value="clientes_varejo_sp">üè™ Clientes Varejo SP (400)</option>
                            <option value="transportadores_frete_longo">üöõ Transportadores Frete Longo (85)</option>
                            <option value="fornecedores_tratamento_cca">üß™ Fornecedores Tratamento CCA (150)</option>
                            <option value="clientes_construcao">üèóÔ∏è Clientes Constru√ß√£o (450)</option>
                            <option value="clientes_atacado">üì¶ Clientes Atacado (350)</option>
                            <option value="fornecedores_eucalipto_verde">üåø Fornecedores Eucalipto Verde (200)</option>
                            <option value="clientes_rural">üåæ Clientes Rural (380)</option>
                            <option value="todos_fornecedores">üè≠ Todos Fornecedores (1.200)</option>
                            <option value="todos_clientes">üë• Todos Clientes (2.500)</option>
                        </optgroup>
                    </select>
                    
                <div class="form-group">
                    <label>üìä ID da Planilha Google Sheets</label>
                    <input type="text" id="googleSheetsId" placeholder="ID da Planilha" value="1FiP885Or0ncyRG_ZZaAvM2vP0sHhDzhLFYifYLjKyIE" readonly style="background: rgba(34, 197, 94, 0.1); border-color: #22c55e;">
                    <small style="color: #94a3b8; display: block; margin-top: 5px;">‚úÖ Planilha sincronizada: Fretes, Leads, Transmiss√µes</small>
                </div>
<button onclick="sincronizarListasPlanilha()" style="margin-top: 10px; background: linear-gradient(135deg, #22c55e, #16a34a); padding: 8px 16px; border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold;">üîÑ SINCRONIZAR COM PLANILHA</button>
                </div>
                <div class="form-group">
                    <label>Mensagem para Envio em Massa</label>
                    <textarea id="evolutionMensagemMassa" rows="4" placeholder="Use {nome} para personalizar...">üå≤ Ol√° {nome}! A ENSIDE MADEIRAS tem novidades para voc√™. Entre em contato!</textarea>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button onclick="enviarMensagemMassa()" style="background: linear-gradient(135deg, #f59e0b, #d97706);">üì® Enviar para Lista</button>
                    <button onclick="agendarEnvio()" class="btn-secondary">‚è∞ Agendar Envio</button>
                </div>
            </div>

            <div class="info-box">
                <strong>üí° Dica:</strong> A Evolution API permite enviar mensagens autom√°ticas via WhatsApp. 
                Configure sua inst√¢ncia em <a href="https://evolution-api.com" target="_blank" style="color: #0ea5e9;">evolution-api.com</a>
            </div>
            <div class="info-box" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(14, 165, 233, 0.1)); border-left: 4px solid #22c55e; margin-top: 20px;">
                <strong>‚úÖ Sistema Completamente Configurado:</strong><br>
                üîë Evolution API v2.0.0 integrada<br>
                üìä Google Sheets sincronizada (Fretes, Leads, Transmiss√µes)<br>
                üîó Webhook configurado para eventos em tempo real<br>
                üöÄ Sistema pronto para usar!<br>
                <br>
                <small style="color: #94a3b8;">√öltima atualiza√ß√£o: 2026-02-19 | Vers√£o: v19.0 CORRIGIDA</small>
            </div>

        </div>

        <!-- ==================== ABA MULTI-IA ==================== -->
        <div id="multiia" class="tab-content">
            <div class="section">
                <div class="section-title">ü§ñ Multi-IA - Chat Inteligente</div>
                <p style="color: #94a3b8; margin-bottom: 20px;">
                    Chat com m√∫ltiplos provedores de IA | GPT-4o | Claude | Groq Llama | Contexto ENSIDE MADEIRAS
                </p>
            </div>

            <div class="section">
                <h3>üîë Configura√ß√£o de API Keys</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>OpenAI API Key</label>
                        <input type="password" id="openaiKey" placeholder="sk-...">
                    </div>
                    <div class="form-group">
                        <label>Claude API Key</label>
                        <input type="password" id="claudeKey" placeholder="sk-ant-...">
                    </div>
                    <div class="form-group">
                        <label>Groq API Key</label>
                        <input type="password" id="groqKey" placeholder="gsk_...">
                    </div>
                </div>
                <button onclick="salvarAPIKeys()" class="btn-secondary">üíæ Salvar Chaves</button>
            </div>

            <div class="section">
                <h3>üí¨ Chat com IA</h3>
                <div class="form-group">
                    <label>Selecionar Modelo</label>
                    <select id="iaModelo">
                        <option value="gpt-4o-mini">üß† GPT-4o Mini (OpenAI)</option>
                        <option value="claude-3-haiku">ü§ñ Claude 3 Haiku (Anthropic)</option>
                        <option value="llama-3.3-70b" selected>ü¶ô Llama 3.3 70B (Groq - Gratuito)</option>
                    </select>
                </div>
                <div id="chatContainer" style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 15px; height: 300px; overflow-y: auto; margin-bottom: 15px;">
                    <div class="chat-message" style="background: rgba(14, 165, 233, 0.2); padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                        <strong style="color: #0ea5e9;">ü§ñ IA:</strong> Ol√°! Sou o assistente da ENSIDE MADEIRAS. Posso ajudar com:
                        <ul style="margin: 10px 0 0 20px; color: #94a3b8;">
                            <li>Pre√ßos de eucalipto tratado e n√£o tratado</li>
                            <li>Informa√ß√µes sobre fornecedores</li>
                            <li>C√°lculos de frete e custos</li>
                            <li>Recomenda√ß√µes de neg√≥cio</li>
                        </ul>
                    </div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="iaInput" placeholder="Digite sua pergunta..." style="flex: 1;" onkeypress="if(event.key==='Enter')enviarMensagemIA()">
                    <button onclick="enviarMensagemIA()">üì§ Enviar</button>
                </div>
            </div>

            <div class="section">
                <h3>üéØ Comandos R√°pidos</h3>
                <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                    <button onclick="comandoIA('analise')" class="btn-secondary">üìä An√°lise Completa</button>
                    <button onclick="comandoIA('topClientes')" class="btn-secondary">üèÜ Top Clientes</button>
                    <button onclick="comandoIA('oportunidades')" class="btn-secondary">üí° Oportunidades</button>
                    <button onclick="comandoIA('riscos')" class="btn-secondary">‚ö†Ô∏è Riscos</button>
                    <button onclick="comandoIA('tendencias')" class="btn-secondary">üìà Tend√™ncias</button>
                </div>
            </div>

            <div class="info-box">
                <strong>üí° Contexto ENSIDE MADEIRAS:</strong> A IA conhece:
                <ul style="margin: 10px 0 0 20px;">
                    <li>Pre√ßos: Mour√£o 2,20m R$18-25 | Poste 7m R$95-120 | Estaca R$8-15</li>
                    <li>Tratamento CCA: R$300/m¬≥ ou R$195/st</li>
                    <li>Fator convers√£o: 1 st = 0,65 m¬≥</li>
                    <li>4.077 contatos | 1.200 fornecedores | 377 transportadores</li>
                </ul>
            </div>
        </div>

        <!-- ==================== ABA TRIAGEM INTELIGENTE ==================== -->
        <div id="triagem" class="tab-content">
            <div class="section">
                <div class="section-title">üéØ Triagem Inteligente de Contatos</div>
                <p style="color: #94a3b8; margin-bottom: 20px;">
                    Classifica√ß√£o autom√°tica com IA | Segmenta√ß√£o por tipo | Prioriza√ß√£o inteligente
                </p>
            </div>

            <div class="section">
                <h3>üìä Estat√≠sticas de Contatos</h3>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value" id="triagemTotal">4.077</div>
                        <div class="stat-label">Total de Contatos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="triagemClassificados">3.850</div>
                        <div class="stat-label">Classificados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="triagemPendentes">227</div>
                        <div class="stat-label">Pendentes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="triagemPrecisao">94%</div>
                        <div class="stat-label">Precis√£o IA</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>ü§ñ Classificar Contatos com IA</h3>
                <p style="color: #94a3b8; margin-bottom: 15px;">A IA analisa nome, empresa, hist√≥rico e classifica automaticamente</p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div class="form-group">
                        <label>Fonte de Dados</label>
                        <select id="triagemFonte">
                            <option value="todos">üìä Todos os Contatos (4.077)</option>
                            <option value="pendentes">‚è≥ Apenas Pendentes (227)</option>
                            <option value="importados">üì• Rec√©m Importados</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>M√©todo de Classifica√ß√£o</label>
                        <select id="triagemMetodo">
                            <option value="ia">ü§ñ IA Avan√ßada (Groq/OpenAI)</option>
                            <option value="regras">üìã Regras Predefinidas</option>
                            <option value="hibrido">üîÄ H√≠brido (IA + Regras)</option>
                        </select>
                    </div>
                </div>
                <button onclick="executarTriagem()" style="background: linear-gradient(135deg, #f59e0b, #d97706);">üéØ Classificar Contatos com IA</button>
            </div>

            <div class="section">
                <h3>üìä Distribui√ß√£o por Categoria e Subcategoria</h3>
                <p style="color: #94a3b8; margin-bottom: 15px;">Total: <strong style="color: var(--primary);">4.077 contatos</strong> | Clique para ver subcategorias</p>
                <div class="grid">
                    <!-- FORNECEDORES -->
                    <div class="grid-card" style="border-left: 4px solid #22c55e;">
                        <h3>üè≠ Fornecedores</h3>
                        <p style="font-size: 2em; color: #22c55e; font-weight: bold;">1.200</p>
                        <p style="color: #94a3b8;">29% do total | 11 subcategorias</p>
                        <details style="margin-top: 10px;">
                            <summary style="cursor: pointer; color: #22c55e; font-weight: bold;">üëá Ver subcategorias</summary>
                            <ul style="margin-top: 10px; padding-left: 15px; font-size: 0.85em; color: #cbd5e1;">
                                <li>Madeira Bruta: <strong>180</strong></li>
                                <li>Tratamento CCA: <strong>150</strong></li>
                                <li>Eucalipto Verde: <strong>200</strong></li>
                                <li>Postes: <strong>120</strong></li>
                                <li>Mour√µes: <strong>180</strong></li>
                                <li>Estacas: <strong>100</strong></li>
                                <li>Lenha: <strong>80</strong></li>
                                <li>Toras: <strong>90</strong></li>
                                <li>Cavacos: <strong>50</strong></li>
                                <li>Briquetes: <strong>30</strong></li>
                                <li>Palanques: <strong>20</strong></li>
                            </ul>
                        </details>
                        <button onclick="criarListaPorCategoria('FORNECEDOR')" style="margin-top: 10px; padding: 8px 15px; font-size: 0.85em; background: linear-gradient(135deg, #22c55e, #16a34a);">üì® Criar Lista</button>
                    </div>
                    <!-- CLIENTES -->
                    <div class="grid-card" style="border-left: 4px solid #0ea5e9;">
                        <h3>üë• Clientes</h3>
                        <p style="font-size: 2em; color: #0ea5e9; font-weight: bold;">2.500</p>
                        <p style="color: #94a3b8;">61% do total | 10 subcategorias</p>
                        <details style="margin-top: 10px;">
                            <summary style="cursor: pointer; color: #0ea5e9; font-weight: bold;">üëá Ver subcategorias</summary>
                            <ul style="margin-top: 10px; padding-left: 15px; font-size: 0.85em; color: #cbd5e1;">
                                <li>Varejo: <strong>400</strong></li>
                                <li>Atacado: <strong>350</strong></li>
                                <li>Constru√ß√£o Civil: <strong>450</strong></li>
                                <li>Rural: <strong>380</strong></li>
                                <li>Industrial: <strong>250</strong></li>
                                <li>Agropecu√°ria: <strong>280</strong></li>
                                <li>Mobili√°rio: <strong>120</strong></li>
                                <li>Cer√¢mica: <strong>100</strong></li>
                                <li>Exporta√ß√£o: <strong>90</strong></li>
                                <li>Pecu√°ria: <strong>80</strong></li>
                            </ul>
                        </details>
                        <button onclick="criarListaPorCategoria('CLIENTE')" style="margin-top: 10px; padding: 8px 15px; font-size: 0.85em; background: linear-gradient(135deg, #0ea5e9, #0284c7);">üì® Criar Lista</button>
                    </div>
                    <!-- TRANSPORTADORES -->
                    <div class="grid-card" style="border-left: 4px solid #f59e0b;">
                        <h3>üöö Transportadores</h3>
                        <p style="font-size: 2em; color: #f59e0b; font-weight: bold;">377</p>
                        <p style="color: #94a3b8;">9% do total | 6 subcategorias</p>
                        <details style="margin-top: 10px;">
                            <summary style="cursor: pointer; color: #f59e0b; font-weight: bold;">üëá Ver subcategorias</summary>
                            <ul style="margin-top: 10px; padding-left: 15px; font-size: 0.85em; color: #cbd5e1;">
                                <li>Frete Longo: <strong>100</strong></li>
                                <li>Frete Curto: <strong>120</strong></li>
                                <li>Mudan√ßa: <strong>40</strong></li>
                                <li>Bitrem: <strong>50</strong></li>
                                <li>Carreta: <strong>45</strong></li>
                                <li>Truck: <strong>22</strong></li>
                            </ul>
                        </details>
                        <button onclick="criarListaPorCategoria('TRANSPORTADOR')" style="margin-top: 10px; padding: 8px 15px; font-size: 0.85em; background: linear-gradient(135deg, #f59e0b, #d97706);">üì® Criar Lista</button>
                    </div>
                </div>
            </div>

            <!-- BOT√ÉO SINCRONIZAR COM PLANILHA -->
            <div class="section" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(22, 163, 74, 0.1)); border: 1px solid rgba(34, 197, 94, 0.3);">
                <h3>üîÑ Sincronizar Contatos com Google Sheets</h3>
                <p style="color: #94a3b8; margin-bottom: 15px;">Envie todos os 4.077 contatos para a planilha EUCALIPTO (aba CONTATOS)</p>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button onclick="sincronizarContatosComPlanilha()" style="background: linear-gradient(135deg, #22c55e, #16a34a);">üì§ Sincronizar 4.077 Contatos</button>
                    <button onclick="abrirPlanilha()" class="btn-secondary">üìÑ Abrir Planilha</button>
                    <button onclick="gerarTodosContatos(); alert('‚úÖ ' + TODOS_CONTATOS.length + ' contatos gerados na mem√≥ria!');" class="btn-secondary">üß† Gerar com IA</button>
                </div>
                <div id="statusSincronizacao" style="margin-top: 15px;"></div>
            </div>

            <div class="section">
                <h3>üîç Filtros Avan√ßados</h3>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                    <div class="form-group">
                        <label>Categoria</label>
                        <select id="filtroCategoria">
                            <option value="">Todas</option>
                            <option value="fornecedor">üè≠ Fornecedor</option>
                            <option value="cliente">üë• Cliente</option>
                            <option value="transportador">üöö Transportador</option>
                            <option value="outros">üìå Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Estado (UF)</label>
                        <select id="filtroUF">
                            <option value="">Todos</option>
                            <option value="SP">S√£o Paulo</option>
                            <option value="PR">Paran√°</option>
                            <option value="MS">Mato Grosso do Sul</option>
                            <option value="MG">Minas Gerais</option>
                            <option value="GO">Goi√°s</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Prioridade</label>
                        <select id="filtroPrioridade">
                            <option value="">Todas</option>
                            <option value="alta">üî¥ Alta</option>
                            <option value="media">üü° M√©dia</option>
                            <option value="baixa">üü¢ Baixa</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Status WhatsApp</label>
                        <select id="filtroWhatsApp">
                            <option value="">Todos</option>
                            <option value="valido">‚úÖ V√°lido</option>
                            <option value="invalido">‚ùå Inv√°lido</option>
                        </select>
                    </div>
                </div>
                <button onclick="aplicarFiltros()" class="btn-secondary">üîç Aplicar Filtros</button>
                <button onclick="exportarFiltrados()" class="btn-secondary" style="margin-left: 10px;">üì§ Exportar Filtrados</button>
            </div>

            <div class="section" id="resultadoTriagem" style="display: none;">
                <h3>‚úÖ Resultado da Triagem</h3>
                <div id="triagemResultContent"></div>
            </div>

            <div class="info-box">
                <strong>üí° Como funciona:</strong> A IA analisa padr√µes no nome, empresa, cidade e hist√≥rico de intera√ß√µes para classificar automaticamente cada contato na categoria mais adequada.
            </div>
        </div>

        <!-- ==================== ABA LISTAS WHATSAPP ==================== -->
        <div id="listas" class="tab-content">
            <div class="section">
                <div class="section-title">üìù Listas de Transmiss√£o WhatsApp</div>
                <p style="color: #94a3b8; margin-bottom: 20px;">
                    Crie e gerencie listas para envio em massa | Limite: 256 contatos por lista
                </p>
            </div>

            <!-- INTEGRA√á√ÉO GOOGLE SHEETS -->
            <div class="section" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(22, 163, 74, 0.1)); border: 1px solid rgba(34, 197, 94, 0.3);">
                <h3>üìä Integra√ß√£o Google Sheets</h3>
                <p style="color: #94a3b8; margin-bottom: 15px;">Sincronize contatos diretamente da planilha EUCALIPTO</p>
                <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                    <button onclick="sincronizarGoogleSheets()" style="background: linear-gradient(135deg, #22c55e, #16a34a);">üîÑ Sincronizar Google Sheets</button>
                    <button onclick="abrirPlanilha()" class="btn-secondary">üìÑ Abrir Planilha</button>
                    <span id="statusGoogleSheets" style="color: #94a3b8;">‚è≥ Aguardando...</span>
                </div>
            </div>

            <!-- CRIAR LISTA DE TRANSMISS√ÉO -->
            <div class="section">
                <h3>‚ûï Criar Lista de Transmiss√£o (Evolution API)</h3>
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Nome da Lista</label>
                        <input type="text" id="nomeListaTransmissao" placeholder="Ex: Promo√ß√£o Natal 2025">
                    </div>
                    <div class="form-group">
                        <label>Filtrar por Categoria</label>
                        <select id="filtroCategoria">
                            <option value="todos">üìä Todos</option>
                            <option value="fornecedor">üè≠ Fornecedores</option>
                            <option value="cliente">üë• Clientes</option>
                            <option value="transportador">üöö Transportadores</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Filtrar por UF</label>
                        <select id="filtroUF">
                            <option value="todos">Todos</option>
                            <option value="SP">SP</option>
                            <option value="PR">PR</option>
                            <option value="MS">MS</option>
                            <option value="MG">MG</option>
                            <option value="GO">GO</option>
                        </select>
                    </div>
                </div>
                <button onclick="criarListaTransmissao()" style="background: linear-gradient(135deg, #0ea5e9, #0284c7);">‚ûï Criar Lista para Evolution API</button>
                <p style="color: #64748b; font-size: 0.85em; margin-top: 10px;">‚ö†Ô∏è Limite: 256 contatos por lista (restri√ß√£o WhatsApp)</p>
            </div>

            <!-- LISTAS CRIADAS -->
            <div class="section">
                <h3>üì® Listas de Transmiss√£o (Envio via Evolution API)</h3>
                <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                    <button onclick="sincronizarListasComPlanilha()" style="background: linear-gradient(135deg, #22c55e, #16a34a);">üîÑ Sincronizar com Planilha</button>
                    <button onclick="exportarListasParaPlanilha()" class="btn-secondary">üì§ Exportar para Planilha (CSV)</button>
                    <button onclick="renderizarListasTransmissao()" class="btn-secondary">üîÉ Atualizar Lista</button>
                </div>
                <div id="listasTransmissaoContainer" class="grid">
                    <p style="color: #94a3b8; text-align: center;">Carregando listas...</p>
                </div>
                <div id="progressoEnvio" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 8px;"></div>
            </div>

            <div class="section">
                <h3>‚ûï Criar Nova Lista (Legado)</h3>
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Nome da Lista</label>
                        <input type="text" id="nomeLista" placeholder="Ex: Fornecedores SP - Dezembro 2025">
                    </div>
                    <div class="form-group">
                        <label>Categoria Base</label>
                        <select id="categoriaLista">
                            <option value="fornecedores">üè≠ Fornecedores</option>
                            <option value="clientes">üë• Clientes</option>
                            <option value="transportadores">üöö Transportadores</option>
                            <option value="todos">üìä Todos</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Filtrar por UF (opcional)</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="checkbox" value="SP" class="ufCheckbox"> SP
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="checkbox" value="PR" class="ufCheckbox"> PR
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="checkbox" value="MS" class="ufCheckbox"> MS
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="checkbox" value="MG" class="ufCheckbox"> MG
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="checkbox" value="GO" class="ufCheckbox"> GO
                        </label>
                    </div>
                </div>
                <button onclick="criarLista()">‚ûï Criar Lista</button>
            </div>

            <div class="section">
                <h3>üìù Minhas Listas</h3>
                <div id="minhasListas" class="grid">
                    <div class="grid-card">
                        <h3>üè≠ Fornecedores SP</h3>
                        <p style="color: var(--primary); font-size: 1.5em; font-weight: bold;">256</p>
                        <p style="color: #94a3b8;">contatos</p>
                        <div style="margin-top: 10px; display: flex; gap: 5px;">
                            <button onclick="exportarLista('fornecedores-sp')" class="btn-secondary" style="padding: 8px 12px; font-size: 0.8em;">üì§ Exportar</button>
                            <button onclick="enviarParaLista('fornecedores-sp')" style="padding: 8px 12px; font-size: 0.8em;">üì® Enviar</button>
                        </div>
                    </div>
                    <div class="grid-card">
                        <h3>üë• Clientes Ativos</h3>
                        <p style="color: var(--primary); font-size: 1.5em; font-weight: bold;">256</p>
                        <p style="color: #94a3b8;">contatos</p>
                        <div style="margin-top: 10px; display: flex; gap: 5px;">
                            <button onclick="exportarLista('clientes-ativos')" class="btn-secondary" style="padding: 8px 12px; font-size: 0.8em;">üì§ Exportar</button>
                            <button onclick="enviarParaLista('clientes-ativos')" style="padding: 8px 12px; font-size: 0.8em;">üì® Enviar</button>
                        </div>
                    </div>
                    <div class="grid-card">
                        <h3>üöö Transportadores</h3>
                        <p style="color: var(--primary); font-size: 1.5em; font-weight: bold;">256</p>
                        <p style="color: #94a3b8;">contatos</p>
                        <div style="margin-top: 10px; display: flex; gap: 5px;">
                            <button onclick="exportarLista('transportadores')" class="btn-secondary" style="padding: 8px 12px; font-size: 0.8em;">üì§ Exportar</button>
                            <button onclick="enviarParaLista('transportadores')" style="padding: 8px 12px; font-size: 0.8em;">üì® Enviar</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>üì§ Exportar Lista</h3>
                <p style="color: #94a3b8; margin-bottom: 15px;">Exporte listas em diferentes formatos</p>
                <div style="display: flex; gap: 10px;">
                    <button onclick="exportarTodasListas('csv')" class="btn-secondary">üìÑ Exportar CSV</button>
                    <button onclick="exportarTodasListas('json')" class="btn-secondary">üìÑ Exportar JSON</button>
                    <button onclick="exportarTodasListas('whatsapp')" style="background: linear-gradient(135deg, #22c55e, #16a34a);">üì® Formato WhatsApp</button>
                </div>
            </div>

            <div class="info-box">
                <strong>üí° Limite WhatsApp:</strong> Cada lista de transmiss√£o do WhatsApp suporta no m√°ximo 256 contatos. O sistema divide automaticamente listas maiores em m√∫ltiplas partes.
            </div>
        </div>

        <!-- ==================== ABA GITHUB API ==================== -->
        <div id="github" class="tab-content">
            <div class="section">
                <div class="section-title">üêô GitHub API Integration</div>
                <p style="color: #94a3b8; margin-bottom: 20px;">
                    Conecte com reposit√≥rios GitHub, sincronize vers√µes, hist√≥rico de atualiza√ß√µes
                </p>
            </div>

            <div class="section">
                <h3>üîó Conectar Reposit√≥rio GitHub</h3>
                <div class="form-group">
                    <label>URL do Reposit√≥rio GitHub</label>
                    <input type="text" id="githubUrl" placeholder="https://github.com/usuario/repo ou usuario/repo">
                </div>
                <button onclick="conectarGitHub()">üîó Conectar Reposit√≥rio</button>
            </div>

            <div class="section" id="githubInfoSection" style="display:none;">
                <h3>üìä Informa√ß√µes do Reposit√≥rio</h3>
                <div class="table-container" id="githubInfo"></div>
            </div>

            <div class="section" id="githubStatsSection" style="display:none;">
                <h3>üìà Estat√≠sticas</h3>
                <div class="stats" id="githubStats"></div>
            </div>

            <!-- ENVIAR ATUALIZA√á√ïES AO GITHUB -->
            <div class="section" id="githubEnviarSection" style="display:none;">
                <h3>üì§ Enviar Atualiza√ß√µes ao Reposit√≥rio</h3>
                <p style="color: #94a3b8; margin-bottom: 15px;">Envie dados do sistema para o reposit√≥rio conectado</p>
                <div class="form-group">
                    <label>Mensagem do Commit</label>
                    <input type="text" id="commitMessage" placeholder="Atualiza√ß√£o do sistema ENSIDE">
                </div>
                <div class="form-group">
                    <label>Dados a Enviar</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 8px;">
                        <label style="display: flex; align-items: center; gap: 5px; background: rgba(0,0,0,0.3); padding: 8px 12px; border-radius: 6px;"><input type="checkbox" value="contatos" checked> üìä Contatos</label>
                        <label style="display: flex; align-items: center; gap: 5px; background: rgba(0,0,0,0.3); padding: 8px 12px; border-radius: 6px;"><input type="checkbox" value="listas"> üìù Listas</label>
                        <label style="display: flex; align-items: center; gap: 5px; background: rgba(0,0,0,0.3); padding: 8px 12px; border-radius: 6px;"><input type="checkbox" value="config"> ‚öôÔ∏è Configura√ß√µes</label>
                        <label style="display: flex; align-items: center; gap: 5px; background: rgba(0,0,0,0.3); padding: 8px 12px; border-radius: 6px;"><input type="checkbox" value="backup"> üíæ Backup Completo</label>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button onclick="enviarParaGitHub()" style="background: linear-gradient(135deg, #22c55e, #16a34a);">üì§ Enviar ao GitHub</button>
                    <button onclick="sincronizarDoGitHub()" class="btn-secondary">üì• Sincronizar do GitHub</button>
                </div>
                <div id="statusEnvioGitHub" style="margin-top: 15px;"></div>
            </div>

            <div class="info-box">
                <strong>üí° Dica:</strong> Use o formato "usuario/repo" ou a URL completa do reposit√≥rio. 
                O sistema buscar√° informa√ß√µes p√∫blicas via API do GitHub (sem autentica√ß√£o).
            </div>

            <div class="section">
                <h3>üîê Autentica√ß√£o (Opcional)</h3>
                <div class="form-group">
                    <label>Token GitHub (para acesso a reposit√≥rios privados)</label>
                    <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
                </div>
                <p style="color: #94a3b8; font-size: 0.9em; margin-top: 10px;">
                    Deixe em branco para usar apenas API p√∫blica. Crie um token em: 
                    <a href="https://github.com/settings/tokens" target="_blank" style="color: #0ea5e9;">GitHub Settings ‚Üí Developer Settings</a>
                </p>
            </div>
        </div>

        <!-- ==================== ABA SINCRONIZA√á√ÉO ==================== -->
        <div id="sincronizacao" class="tab-content">
            <div class="section">
                <div class="section-title">üîÑ Sincroniza√ß√£o & Backup</div>
                <p style="color: #94a3b8;">Sincroniza√ß√£o autom√°tica com Google Sheets | Backups | Restaura√ß√£o</p>
            </div>

            <div class="grid">
                <div class="grid-card">
                    <h3>‚òÅÔ∏è Google Sheets</h3>
                    <p style="color: #94a3b8; margin: 10px 0;">
                        ID: 18ryjMEDTOvl1sKS...
                    </p>
                    <p style="color: #0ea5e9; font-size: 0.9em; margin: 10px 0;">
                        Status: <span class="badge badge-success">‚úì Conectado</span>
                    </p>
                    <button class="btn-secondary" onclick="sincronizarSheets()">Sincronizar</button>
                </div>

                <div class="grid-card">
                    <h3>üíæ Backup Local</h3>
                    <p style="color: #94a3b8; margin: 10px 0;">
                        √öltimo backup: Hoje 14:30
                    </p>
                    <p style="color: #0ea5e9; font-size: 0.9em; margin: 10px 0;">
                        Status: <span class="badge badge-success">‚úì Autom√°tico</span>
                    </p>
                    <button class="btn-secondary" onclick="criarBackup()">Backup Manual</button>
                </div>

                <div class="grid-card">
                    <h3>üîÑ Restaura√ß√£o</h3>
                    <p style="color: #94a3b8; margin: 10px 0;">
                        Restaure dados de qualquer backup anterior
                    </p>
                    <button class="btn-secondary" onclick="listarBackups()">Ver Backups</button>
                </div>

                <div class="grid-card">
                    <h3>üîê Seguran√ßa</h3>
                    <p style="color: #94a3b8; margin: 10px 0;">
                        Criptografia AES-256 habilitada
                    </p>
                    <p style="color: #0ea5e9; font-size: 0.9em; margin: 10px 0;">
                        Status: <span class="badge badge-success">‚úì Protegido</span>
                    </p>
                    <button class="btn-secondary" onclick="configurarSeguranca()">Config.</button>
                </div>
            </div>
        </div>

        <!-- ==================== ABA DOCUMENTA√á√ÉO ==================== -->
        <div id="planilha" class="tab-content">
            <div class="section">
                <div class="section-title">üìä Planilha Integrada - Google Sheets</div>
                <p style="color: var(--text-muted); margin-bottom: 15px;">
                    Planilha sincronizada em tempo real. Altera√ß√µes feitas aqui refletem automaticamente no Google Sheets e vice-versa.
                </p>
                
                <!-- Bot√µes de A√ß√£o -->
                <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                    <a href="https://docs.google.com/spreadsheets/d/1FiP885Or0ncyRG_ZZaAvM2vP0sHhDzhLFYifYLjKyIE/edit" target="_blank" 
                       style="padding: 12px 24px; background: linear-gradient(135deg, #22c55e, #16a34a); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; text-decoration: none; display: inline-flex; align-items: center; gap: 8px;">
                        üîó Abrir no Google Sheets
                    </a>
                    <button onclick="recarregarPlanilha()" style="padding: 12px 24px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        üîÑ Recarregar Planilha
                    </button>
                    <button onclick="sincronizarDadosPlanilha()" style="padding: 12px 24px; background: linear-gradient(135deg, #f59e0b, #d97706); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        üì• Sincronizar Dados
                    </button>
                </div>
                
                <!-- Abas da Planilha -->
                <div style="display: flex; gap: 5px; margin-bottom: 15px; flex-wrap: wrap;">
                    <button onclick="mudarAbaPlanilha('1689968688')" class="planilha-tab active" data-gid="1689968688">üë• CONTATOS</button>
                    <button onclick="mudarAbaPlanilha('1716433489')" class="planilha-tab" data-gid="1716433489">üöö FRETES</button>
                    <button onclick="mudarAbaPlanilha('1335082895')" class="planilha-tab" data-gid="1335082895">üì• CAPTA√á√ÉO</button>
                    <button onclick="mudarAbaPlanilha('961123584')" class="planilha-tab" data-gid="961123584">üìä LEADS</button>
                    <button onclick="mudarAbaPlanilha('1114979046')" class="planilha-tab" data-gid="1114979046">üìù LISTAS</button>
                    <button onclick="mudarAbaPlanilha('250132552')" class="planilha-tab" data-gid="250132552">‚ù§Ô∏è MINHAS LISTAS</button>
                    <button onclick="mudarAbaPlanilha('1707733664')" class="planilha-tab" data-gid="1707733664">üìä RESUMO</button>
                    <button onclick="mudarAbaPlanilha('773407069')" class="planilha-tab" data-gid="773407069">‚öôÔ∏è PAR√ÇMETROS</button>
                    <button onclick="mudarAbaPlanilha('1081938874')" class="planilha-tab" data-gid="1081938874">üí∞ AN√ÅLISE CUSTOS</button>
                    <button onclick="mudarAbaPlanilha('2118458555')" class="planilha-tab" data-gid="2118458555">üå≥ TRATAMENTO CCA</button>
                    <button onclick="mudarAbaPlanilha('773407069')" class="planilha-tab" data-gid="773407069">üì¶ ATACADO</button>
                    <button onclick="mudarAbaPlanilha('85954134')" class="planilha-tab" data-gid="85954134">üßÆ SIMULADOR</button>
                    <button onclick="mudarAbaPlanilha('2085464626')" class="planilha-tab" data-gid="2085464626">üìÑ RELAT√ìRIO</button>
                    <button onclick="mudarAbaPlanilha('1784972020')" class="planilha-tab" data-gid="1784972020">üá≥üáß ESTADOS</button>
                    <button onclick="mudarAbaPlanilha('2046460774')" class="planilha-tab" data-gid="2046460774">üõçÔ∏è VAREJO</button>
                    <button onclick="mudarAbaPlanilha('2118458555')" class="planilha-tab" data-gid="2118458555">üõ†Ô∏è CUSTOS SERRAGEM</button>
                    <button onclick="mudarAbaPlanilha('1142513380')" class="planilha-tab" data-gid="1142513380">üìä TABELA DIN√ÇMICA</button>
                    <button onclick="mudarAbaPlanilha('1183996076')" class="planilha-tab" data-gid="1183996076">üîç DETALHE1</button>
                    <button onclick="mudarAbaPlanilha('1656119291')" class="planilha-tab" data-gid="1656119291">üìñ GLOSS√ÅRIO</button>
                    <button onclick="mudarAbaPlanilha('2135374310')" class="planilha-tab" data-gid="2135374310">üìÉ PROPOSTAS</button>
                </div>
                
                <!-- Container do iframe -->
                <div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
                    <iframe id="planilhaFrame" 
                            src="https://docs.google.com/spreadsheets/d/1FiP885Or0ncyRG_ZZaAvM2vP0sHhDzhLFYifYLjKyIE/edit?usp=sharing&rm=minimal&gid=1689968688" 
                            style="width: 100%; height: 700px; border: none;"
                            allowfullscreen>
                    </iframe>
                </div>
                
                <!-- Status da Sincroniza√ß√£o -->
                <div style="margin-top: 20px; padding: 15px; background: rgba(34,197,94,0.1); border-radius: 8px; border-left: 4px solid #22c55e;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 1.5em;">‚úÖ</span>
                        <div>
                            <strong style="color: #22c55e;">Planilha Conectada</strong>
                            <p style="color: var(--text-muted); font-size: 0.9em; margin: 0;">
                                ID: 1FiP885Or0ncyRG_ZZaAvM2vP0sHhDzhLFYifYLjKyIE | √öltima sincroniza√ß√£o: <span id="ultimaSincPlanilha">Agora</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="aprendizados" class="tab-content">
            <div class="section">
                <div class="section-title">üí° Sistema de Aprendizados</div>
                <p style="color: var(--text-muted); margin-bottom: 20px;">
                    Registre insights, dicas e aprendizados do neg√≥cio para consulta futura.
                </p>
                
                <!-- Formul√°rio de Novo Aprendizado -->
                <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">‚ûï Novo Aprendizado</h3>
                    <div style="display: grid; gap: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; color: var(--text-muted);">T√≠tulo:</label>
                            <input type="text" id="aprendizadoTitulo" placeholder="Ex: Melhor hor√°rio para contato" style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.3); color: var(--text);">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; color: var(--text-muted);">Categoria:</label>
                            <select id="aprendizadoCategoria" style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.3); color: var(--text);">
                                <option value="vendas">üí∞ Vendas</option>
                                <option value="clientes">üë• Clientes</option>
                                <option value="produtos">üå≤ Produtos</option>
                                <option value="processos">‚öôÔ∏è Processos</option>
                                <option value="marketing">üì£ Marketing</option>
                                <option value="geral">üìù Geral</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; color: var(--text-muted);">Descri√ß√£o:</label>
                            <textarea id="aprendizadoDescricao" rows="4" placeholder="Descreva o aprendizado em detalhes..." style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.3); color: var(--text); resize: vertical;"></textarea>
                        </div>
                        <button onclick="salvarAprendizado()" style="padding: 12px 24px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                            üíæ Salvar Aprendizado
                        </button>
                    </div>
                </div>
                
                <!-- Filtros -->
                <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                    <button onclick="filtrarAprendizados('todos')" class="filter-btn active" data-filter="todos">üìã Todos</button>
                    <button onclick="filtrarAprendizados('vendas')" class="filter-btn" data-filter="vendas">üí∞ Vendas</button>
                    <button onclick="filtrarAprendizados('clientes')" class="filter-btn" data-filter="clientes">üë• Clientes</button>
                    <button onclick="filtrarAprendizados('produtos')" class="filter-btn" data-filter="produtos">üå≤ Produtos</button>
                    <button onclick="filtrarAprendizados('processos')" class="filter-btn" data-filter="processos">‚öôÔ∏è Processos</button>
                    <button onclick="filtrarAprendizados('marketing')" class="filter-btn" data-filter="marketing">üì£ Marketing</button>
                </div>
                
                <!-- Lista de Aprendizados -->
                <div id="listaAprendizados" style="display: grid; gap: 15px;">
                    <!-- Aprendizados ser√£o renderizados aqui -->
                </div>
                
                <!-- Estat√≠sticas -->
                <div style="margin-top: 30px; padding: 20px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">üìä Estat√≠sticas</h3>
                    <div id="statsAprendizados" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        <!-- Stats ser√£o renderizadas aqui -->
                    </div>
                </div>
            </div>
        </div>

        <div id="documentacao" class="tab-content">
            <div class="section">
                <div class="section-title">üìñ Documenta√ß√£o Completa</div>
                <p style="color: #94a3b8;">Guias, tutoriais e refer√™ncia t√©cnica</p>
            </div>

            <div class="section">
                <h3>üöÄ Quick Start</h3>
                <p style="color: #cbd5e1; line-height: 1.8;">
                    <strong>1. Importar dados:</strong> Clique em "Importador Universal" e arraste seus arquivos<br>
                    <strong>2. Processar:</strong> Use "Processador" para validar, limpar e deduplicar<br>
                    <strong>3. Sincronizar:</strong> Ative sincroniza√ß√£o com Google Sheets<br>
                    <strong>4. Automatizar:</strong> Configure backups autom√°ticos e notifica√ß√µes
                </p>
            </div>

            <div class="section">
                <h3>üìö Formatos Suportados</h3>
                <div class="code-block">
                    <code>
CSV: Valores separados por v√≠rgula ou ponto-e-v√≠rgula<br>
JSON: { "nome": "...", "email": "...", "whatsapp": "..." }<br>
Excel: .xlsx, .xls com suporte a m√∫ltiplas abas<br>
TXT: Separado por tabula√ß√£o ou caractere customizado<br>
XML: Estrutura hier√°rquica de elementos
                    </code>
                </div>
            </div>

            <div class="section">
                <h3>üîå APIs Integradas</h3>
                <ul style="color: #cbd5e1; line-height: 2;">
                    <li>‚úÖ <strong>GitHub API:</strong> Informa√ß√µes de reposit√≥rios p√∫blicos</li>
                    <li>‚úÖ <strong>Google Sheets API:</strong> Sincroniza√ß√£o de dados</li>
                    <li>‚úÖ <strong>WhatsApp Business API:</strong> Envio de mensagens</li>
                    <li>‚úÖ <strong>Google Drive API:</strong> Armazenamento de backups</li>
                </ul>
            </div>

            <div class="info-box">
                <strong>üìû Suporte:</strong><br>
                WhatsApp: (55) 18 99654-0492<br>
                Email: ensideanderson12@gmail.com
            </div>
        </div>

        <!-- ==================== ABA MADEIRAS ULTRA ==================== -->
        <div id="madeirasultra" class="tab-content">
            <div class="section">
                <div class="section-title">üå≤ Enside Madeiras Ultra - Sistema de Pre√ßos e Margens</div>
                <p style="color: var(--text-muted); margin-bottom: 15px;">
                    Sistema completo para c√°lculo de pre√ßos, margens e simula√ß√µes de venda de madeira tratada.
                </p>
                
                <!-- Bot√µes de A√ß√£o -->
                <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                    <a href="https://enside-madeira-ultra.vercel.app" target="_blank" 
                       style="padding: 12px 24px; background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; text-decoration: none; display: inline-flex; align-items: center; gap: 8px;">
                        üîó Abrir em Nova Aba
                    </a>
                    <button onclick="recarregarMadeirasUltra()" style="padding: 12px 24px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        üîÑ Recarregar
                    </button>
                </div>
                
                <!-- KPIs R√°pidos -->
                <div class="grid" style="margin-bottom: 20px;">
                    <div class="grid-card" style="text-align: center; border-left: 4px solid #10b981;">
                        <div style="font-size: 2em; color: #10b981; font-weight: bold;">14</div>
                        <div style="color: var(--text-muted);">Bitolas Cadastradas</div>
                    </div>
                    <div class="grid-card" style="text-align: center; border-left: 4px solid #f59e0b;">
                        <div style="font-size: 2em; color: #f59e0b; font-weight: bold;">91%</div>
                        <div style="color: var(--text-muted);">Margem M√©dia</div>
                    </div>
                    <div class="grid-card" style="text-align: center; border-left: 4px solid #22c55e;">
                        <div style="font-size: 2em; color: #22c55e; font-weight: bold;">R$ 100,89</div>
                        <div style="color: var(--text-muted);">Lucro M√©dio/ST</div>
                    </div>
                    <div class="grid-card" style="text-align: center; border-left: 4px solid #a855f7;">
                        <div style="font-size: 2em; color: #a855f7; font-weight: bold;">254,7%</div>
                        <div style="color: var(--text-muted);">Maior Margem (6-8cm)</div>
                    </div>
                </div>
                
                <!-- Container do iframe -->
                <div style="background: #0f172a; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.3); border: 1px solid rgba(16, 185, 129, 0.3);">
                    <iframe id="madeirasUltraFrame" 
                            src="https://enside-madeira-ultra.vercel.app" 
                            style="width: 100%; height: 800px; border: none;"
                            allowfullscreen>
                    </iframe>
                </div>
                
                <!-- Info Box -->
                <div class="info-box" style="margin-top: 20px;">
                    <strong>üí° Funcionalidades do Madeiras Ultra:</strong><br><br>
                    ‚Ä¢ <strong>Dashboard:</strong> Vis√£o geral de KPIs e margens<br>
                    ‚Ä¢ <strong>Par√¢metros:</strong> Configure custos e pre√ßos base<br>
                    ‚Ä¢ <strong>Compra & Venda:</strong> Simule opera√ß√µes comerciais<br>
                    ‚Ä¢ <strong>Simulador:</strong> Calcule pre√ßos e margens em tempo real<br>
                    ‚Ä¢ <strong>Carrinho:</strong> Monte pedidos e or√ßamentos<br>
                    ‚Ä¢ <strong>Relat√≥rios:</strong> Analise performance e hist√≥rico
                </div>
            </div>
        </div>

        <!-- ==================== ABA CAPTA√á√ÉO DE FRETES ==================== -->
        <div id="captacaofretes" class="tab-content">
            <style>
                /* Estilos espec√≠ficos para Capta√ß√£o de Fretes */
                .fretes-header { background: linear-gradient(135deg, #000 0%, #1a1a1a 100%); padding: 20px; border-radius: 12px; border: 2px solid #FFD700; margin-bottom: 20px; }
                .fretes-logo { text-align: center; font-size: 1.8em; font-weight: 900; color: #FFD700; text-shadow: 0 0 20px rgba(255,215,0,0.5); }
                .fretes-logo span { display: block; font-size: 0.4em; color: #fff; font-weight: 400; letter-spacing: 3px; margin-top: 5px; }
                .fretes-stats { display: flex; justify-content: center; gap: 40px; flex-wrap: wrap; padding: 20px; background: rgba(255,215,0,0.1); border-radius: 12px; margin: 20px 0; }
                .fretes-stat { text-align: center; }
                .fretes-stat-number { font-size: 2em; font-weight: 900; color: #00FF00; text-shadow: 0 0 15px rgba(0,255,0,0.6); }
                .fretes-stat-label { font-size: 0.9em; color: #FFD700; font-weight: 600; }
                .fretes-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 20px 0; }
                .fretes-card { background: linear-gradient(135deg, rgba(0,255,0,0.1) 0%, rgba(0,0,0,0.9) 100%); border: 2px solid #FFD700; border-radius: 15px; padding: 25px; transition: all 0.3s ease; cursor: pointer; }
                .fretes-card:hover { transform: translateY(-5px); border-color: #00FF00; box-shadow: 0 10px 30px rgba(0,255,0,0.3); }
                .fretes-card-emoji { font-size: 3em; display: block; text-align: center; margin-bottom: 10px; }
                .fretes-card-titulo { font-size: 1.3em; font-weight: 900; color: #FFD700; text-align: center; margin-bottom: 8px; }
                .fretes-card-info { font-size: 1em; color: #fff; text-align: center; }
                .fretes-card-valor { font-size: 1.2em; font-weight: 900; color: #00FF00; text-align: center; margin-top: 10px; text-shadow: 0 0 10px rgba(0,255,0,0.6); }
                .fretes-alert { background: linear-gradient(135deg, #FF0000 0%, #CC0000 100%); padding: 15px; border-radius: 12px; text-align: center; font-size: 1.2em; font-weight: 900; color: #fff; margin-bottom: 20px; border: 2px solid #FFD700; animation: pulse 2s infinite; }
                .fretes-btn { padding: 15px 30px; border: none; border-radius: 50px; font-size: 1.1em; font-weight: 900; cursor: pointer; transition: all 0.3s ease; display: block; width: 100%; margin: 15px 0; }
                .fretes-btn-primary { background: linear-gradient(135deg, #FF0000 0%, #CC0000 100%); color: #fff; box-shadow: 0 8px 30px rgba(255,0,0,0.4); }
                .fretes-btn-secondary { background: linear-gradient(135deg, #00FF00 0%, #00CC00 100%); color: #000; box-shadow: 0 8px 30px rgba(0,255,0,0.4); }
                .fretes-btn:hover { transform: scale(1.02); }
                .fretes-section { background: rgba(0,0,0,0.6); padding: 25px; border-radius: 15px; border: 2px solid rgba(255,215,0,0.3); margin: 20px 0; }
                .fretes-section-title { font-size: 1.5em; font-weight: 900; color: #FFD700; margin-bottom: 20px; text-align: center; }
                .fretes-form-group { margin-bottom: 15px; }
                .fretes-form-label { display: block; font-size: 0.95em; font-weight: 700; color: #FFD700; margin-bottom: 6px; }
                .fretes-form-input, .fretes-form-select { width: 100%; padding: 12px; background: rgba(0,0,0,0.6); border: 2px solid rgba(255,215,0,0.3); border-radius: 8px; color: #fff; font-size: 1em; }
                .fretes-form-input:focus, .fretes-form-select:focus { outline: none; border-color: #00FF00; box-shadow: 0 0 15px rgba(0,255,0,0.3); }
                .fretes-frete-card { background: linear-gradient(135deg, rgba(255,215,0,0.1) 0%, rgba(0,0,0,0.95) 100%); border: 2px solid #FFD700; border-radius: 15px; padding: 25px; margin: 20px 0; }
                .fretes-frete-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 12px; border-bottom: 2px solid rgba(255,215,0,0.3); flex-wrap: wrap; gap: 10px; }
                .fretes-frete-rota { font-size: 1.3em; font-weight: 900; color: #FFD700; }
                .fretes-badge-urgente { background: linear-gradient(135deg, #FF0000 0%, #CC0000 100%); color: #fff; padding: 6px 15px; border-radius: 15px; font-size: 0.85em; font-weight: 900; animation: pulse 1.5s infinite; }
                .fretes-frete-detalhes { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 12px; margin: 15px 0; }
                .fretes-frete-info { background: rgba(0,0,0,0.6); padding: 12px; border-radius: 8px; border: 1px solid rgba(255,215,0,0.2); }
                .fretes-frete-info-label { font-size: 0.8em; color: #FFD700; font-weight: 600; margin-bottom: 4px; }
                .fretes-frete-info-valor { font-size: 1.1em; font-weight: 900; color: #fff; }
                .fretes-valor-destaque { color: #00FF00 !important; font-size: 1.3em !important; text-shadow: 0 0 10px rgba(0,255,0,0.6); }
                @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
            </style>

            <div class="fretes-header">
                <div class="fretes-logo">
                    ANDERSON ENSIDE LOGISTICS
                    <span>Freight & Cargo Solutions</span>
                </div>
            </div>

            <div class="fretes-alert">
                üî• PARE DE RODAR VAZIO - CARGAS DISPON√çVEIS AGORA! üî•
            </div>

            <div class="fretes-stats">
                <div class="fretes-stat">
                    <div class="fretes-stat-number" id="totalFretesDisp">247</div>
                    <div class="fretes-stat-label">Fretes Dispon√≠veis</div>
                </div>
                <div class="fretes-stat">
                    <div class="fretes-stat-number">R$ 8.500</div>
                    <div class="fretes-stat-label">M√©dia Mensal</div>
                </div>
                <div class="fretes-stat">
                    <div class="fretes-stat-number">1.834</div>
                    <div class="fretes-stat-label">Motoristas Ativos</div>
                </div>
            </div>

            <!-- Grid de Cidades -->
            <div class="fretes-grid">
                <div class="fretes-card">
                    <span class="fretes-card-emoji">üáßüá∑</span>
                    <div class="fretes-card-titulo">CURITIBA - PR</div>
                    <div class="fretes-card-info">47 fretes dispon√≠veis</div>
                    <div class="fretes-card-valor">R$ 1.800 - 4.200</div>
                </div>
                <div class="fretes-card">
                    <span class="fretes-card-emoji">üáßüá∑</span>
                    <div class="fretes-card-titulo">TUBAR√ÉO - SC</div>
                    <div class="fretes-card-info">38 fretes dispon√≠veis</div>
                    <div class="fretes-card-valor">R$ 2.100 - 5.800</div>
                </div>
                <div class="fretes-card">
                    <span class="fretes-card-emoji">üáßüá∑</span>
                    <div class="fretes-card-titulo">S√ÉO PAULO - SP</div>
                    <div class="fretes-card-info">62 fretes dispon√≠veis</div>
                    <div class="fretes-card-valor">R$ 1.500 - 6.500</div>
                </div>
                <div class="fretes-card">
                    <span class="fretes-card-emoji">üáßüá∑</span>
                    <div class="fretes-card-titulo">RIO DE JANEIRO - RJ</div>
                    <div class="fretes-card-info">41 fretes dispon√≠veis</div>
                    <div class="fretes-card-valor">R$ 2.200 - 5.200</div>
                </div>
                <div class="fretes-card">
                    <span class="fretes-card-emoji">üáßüá∑</span>
                    <div class="fretes-card-titulo">BELO HORIZONTE - MG</div>
                    <div class="fretes-card-info">35 fretes dispon√≠veis</div>
                    <div class="fretes-card-valor">R$ 1.900 - 4.800</div>
                </div>
                <div class="fretes-card">
                    <span class="fretes-card-emoji">üáßüá∑</span>
                    <div class="fretes-card-titulo">PORTO ALEGRE - RS</div>
                    <div class="fretes-card-info">24 fretes dispon√≠veis</div>
                    <div class="fretes-card-valor">R$ 2.400 - 5.100</div>
                </div>
            </div>

            <!-- Se√ß√£o Seguro -->
            <div class="fretes-section" style="border-color: #FFD700; background: linear-gradient(135deg, rgba(255,215,0,0.15) 0%, rgba(0,0,0,0.95) 100%);">
                <div class="fretes-section-title">üõ°Ô∏è PROTEJA SUAS CARGAS</div>
                <div class="fretes-grid" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));">
                    <div style="text-align: center; padding: 15px;">
                        <div style="font-size: 2em; margin-bottom: 8px;">‚úÖ</div>
                        <div style="font-weight: 700; color: #fff;">Cobertura Total</div>
                    </div>
                    <div style="text-align: center; padding: 15px;">
                        <div style="font-size: 2em; margin-bottom: 8px;">üìû</div>
                        <div style="font-weight: 700; color: #fff;">Assist√™ncia 24h</div>
                    </div>
                    <div style="text-align: center; padding: 15px;">
                        <div style="font-size: 2em; margin-bottom: 8px;">‚ö°</div>
                        <div style="font-weight: 700; color: #fff;">Indeniza√ß√£o R√°pida</div>
                    </div>
                    <div style="text-align: center; padding: 15px;">
                        <div style="font-size: 2em; margin-bottom: 8px;">üí∞</div>
                        <div style="font-weight: 700; color: #fff;">Sem Franquia</div>
                    </div>
                </div>
                <div style="text-align: center; font-size: 2.5em; font-weight: 900; color: #00FF00; margin: 20px 0; text-shadow: 0 0 20px rgba(0,255,0,0.6);">R$ 17,99/dia</div>
                <div style="text-align: center;">
                    <label style="display: flex; align-items: center; justify-content: center; gap: 10px; cursor: pointer; font-size: 1.1em;">
                        <input type="checkbox" id="interesseSeguroFretes" style="width: 20px; height: 20px;">
                        <span>Tenho interesse em seguro para minhas cargas</span>
                    </label>
                </div>
            </div>

            <!-- Filtros de Fretes -->
            <div class="fretes-section">
                <div class="fretes-section-title">üîç FILTRAR FRETES DISPON√çVEIS</div>
                <div class="fretes-grid" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));">
                    <div class="fretes-form-group">
                        <label class="fretes-form-label">Estado Origem</label>
                        <select class="fretes-form-select" id="filtroEstadoOrigemFretes" onchange="filtrarFretesIntegrado()">
                            <option value="">Todos</option>
                            <option value="PR">PR</option>
                            <option value="SC">SC</option>
                            <option value="SP">SP</option>
                            <option value="RJ">RJ</option>
                            <option value="MG">MG</option>
                            <option value="RS">RS</option>
                        </select>
                    </div>
                    <div class="fretes-form-group">
                        <label class="fretes-form-label">Estado Destino</label>
                        <select class="fretes-form-select" id="filtroEstadoDestinoFretes" onchange="filtrarFretesIntegrado()">
                            <option value="">Todos</option>
                            <option value="PR">PR</option>
                            <option value="SC">SC</option>
                            <option value="SP">SP</option>
                            <option value="RJ">RJ</option>
                            <option value="MG">MG</option>
                            <option value="RS">RS</option>
                        </select>
                    </div>
                    <div class="fretes-form-group">
                        <label class="fretes-form-label">Tipo de Ve√≠culo</label>
                        <select class="fretes-form-select" id="filtroTipoVeiculoFretes" onchange="filtrarFretesIntegrado()">
                            <option value="">Todos</option>
                            <option value="Carreta">Carreta</option>
                            <option value="Truck">Truck</option>
                            <option value="Bitruck">Bitruck</option>
                        </select>
                    </div>
                    <div class="fretes-form-group">
                        <label class="fretes-form-label">Valor M√≠nimo (R$)</label>
                        <input type="number" class="fretes-form-input" id="filtroValorMinimoFretes" placeholder="0" onchange="filtrarFretesIntegrado()">
                    </div>
                </div>
            </div>

            <!-- Container de Fretes -->
            <div id="containerFretesIntegrado"></div>

            <!-- Formul√°rio R√°pido de Capta√ß√£o -->
            <div class="fretes-section" style="border-color: #00FF00; background: linear-gradient(135deg, rgba(0,255,0,0.1) 0%, rgba(0,0,0,0.95) 100%);">
                <div class="fretes-section-title">üìù CADASTRE-SE AGORA</div>
                <p style="text-align: center; color: #94a3b8; margin-bottom: 20px;">Preencha seus dados e receba as melhores oportunidades de frete!</p>
                <form id="formCaptacaoRapida" style="max-width: 500px; margin: 0 auto;">
                    <div class="fretes-form-group">
                        <label class="fretes-form-label">Nome Completo *</label>
                        <input type="text" class="fretes-form-input" id="captacaoNomeCompleto" placeholder="Seu nome completo" required>
                    </div>
                    <div class="fretes-form-group">
                        <label class="fretes-form-label">WhatsApp *</label>
                        <input type="tel" class="fretes-form-input" id="captacaoWhatsApp" placeholder="(00) 00000-0000" required>
                    </div>
                    <div class="fretes-form-group">
                        <label class="fretes-form-label">Interesse em Seguro de Carga</label>
                        <select class="fretes-form-select" id="captacaoInteresseSeguro">
                            <option value="sim">Sim, tenho interesse</option>
                            <option value="nao">N√£o no momento</option>
                            <option value="talvez">Quero saber mais</option>
                        </select>
                    </div>
                    <button type="button" class="fretes-btn fretes-btn-primary" onclick="enviarCaptacaoRapida()" style="margin-top: 15px;">
                        üëâ Clique aqui
                    </button>
                </form>
                <div id="statusCaptacaoRapida" style="margin-top: 15px; text-align: center;"></div>
            </div>

            <!-- Bot√£o de A√ß√£o Secund√°rio -->
            <button class="fretes-btn fretes-btn-secondary" onclick="abrirModalCadastroMotorista()" style="max-width: 600px; margin: 30px auto;">
                üìù Cadastro Completo de Motorista
            </button>

            <!-- Modal de Cadastro -->
            <div id="modalCadastroMotorista" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; justify-content: center; align-items: center; overflow-y: auto;">
                <div style="background: linear-gradient(135deg, #000 0%, #1a1a1a 100%); border: 3px solid #FFD700; border-radius: 20px; padding: 40px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; margin: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                        <h2 style="font-size: 1.8em; font-weight: 900; color: #FFD700;">üöö Cadastro de Motorista</h2>
                        <span onclick="fecharModalCadastroMotorista()" style="font-size: 2em; color: #FFD700; cursor: pointer;">&times;</span>
                    </div>
                    <form id="formCadastroMotoristaIntegrado">
                        <div class="fretes-form-group">
                            <label class="fretes-form-label">Nome Completo *</label>
                            <input type="text" class="fretes-form-input" id="nomeMotorista" required>
                        </div>
                        <div class="fretes-form-group">
                            <label class="fretes-form-label">WhatsApp *</label>
                            <input type="tel" class="fretes-form-input" id="whatsappMotorista" placeholder="(00) 00000-0000" required>
                        </div>
                        <div class="fretes-form-group">
                            <label class="fretes-form-label">Tipo de Ve√≠culo *</label>
                            <select class="fretes-form-select" id="tipoVeiculoMotorista" required>
                                <option value="">Selecione...</option>
                                <option value="Truck">Truck</option>
                                <option value="Carreta">Carreta</option>
                                <option value="Bitruck">Bitruck</option>
                                <option value="Bitrem">Bitrem</option>
                                <option value="Rodotrem">Rodotrem</option>
                            </select>
                        </div>
                        <div class="fretes-form-group">
                            <label class="fretes-form-label">Placa do Ve√≠culo *</label>
                            <input type="text" class="fretes-form-input" id="placaMotorista" placeholder="ABC-1234" maxlength="8" required>
                        </div>
                        <div class="fretes-form-group">
                            <label class="fretes-form-label">Regi√µes de Atua√ß√£o</label>
                            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 8px;">
                                <label style="display: flex; align-items: center; gap: 5px; background: rgba(0,0,0,0.4); padding: 8px 12px; border-radius: 6px;"><input type="checkbox" value="Sul"> Sul</label>
                                <label style="display: flex; align-items: center; gap: 5px; background: rgba(0,0,0,0.4); padding: 8px 12px; border-radius: 6px;"><input type="checkbox" value="Sudeste"> Sudeste</label>
                                <label style="display: flex; align-items: center; gap: 5px; background: rgba(0,0,0,0.4); padding: 8px 12px; border-radius: 6px;"><input type="checkbox" value="Centro-Oeste"> Centro-Oeste</label>
                                <label style="display: flex; align-items: center; gap: 5px; background: rgba(0,0,0,0.4); padding: 8px 12px; border-radius: 6px;"><input type="checkbox" value="Nordeste"> Nordeste</label>
                                <label style="display: flex; align-items: center; gap: 5px; background: rgba(0,0,0,0.4); padding: 8px 12px; border-radius: 6px;"><input type="checkbox" value="Norte"> Norte</label>
                            </div>
                        </div>
                        <button type="button" class="fretes-btn fretes-btn-secondary" onclick="enviarCadastroMotorista()" style="margin-top: 20px;">
                            ‚úÖ FINALIZAR CADASTRO
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- ABA CONTATOS CRM -->
    <div id="contatoscrm" class="tab-content">
        <div class="section-title">üìä Contatos CRM - Integrado com Google Sheets</div>
        <p style="text-align: center; color: var(--text-muted); margin-bottom: 20px;">Gest√£o completa de contatos com campos CRM | Integrado em tempo real com a planilha EUCALIPTO</p>
        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-bottom: 20px;">
            <button onclick="window.open('MODULOS/CONTATOS_CRM.html', '_blank')" class="btn" style="background: linear-gradient(135deg, #ec4899, #be185d);">üîó Abrir CRM Completo</button>
            <button onclick="window.open('https://docs.google.com/spreadsheets/d/1FiP885Or0ncyRG_ZZaAvM2vP0sHhDzhLFYifYLjKyIE/edit?gid=1689968688', '_blank')" class="btn" style="background: linear-gradient(135deg, #22c55e, #16a34a);">üìä Abrir Planilha</button>
        </div>
        <div style="width: 100%; height: 400px; border: 2px solid #ec4899; border-radius: 12px; background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 20px;">
            <div style="font-size: 4em;">üìä</div>
            <h2 style="color: #ec4899; margin: 0;">ENSIDE CRM - Gest√£o de Contatos</h2>
            <p style="color: #94a3b8; text-align: center; max-width: 500px;">Sistema completo de CRM com 7.055+ contatos, filtros avan√ßados, categorias (Fornecedores, Clientes, Transportadores, Representantes) e integra√ß√£o com Google Sheets.</p>
            <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
                <button onclick="window.open('MODULOS/CONTATOS_CRM.html', '_blank')" style="background: linear-gradient(135deg, #ec4899, #be185d); color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.1em; cursor: pointer; font-weight: 600;">üöÄ Abrir CRM Completo</button>
                <button onclick="window.open('https://docs.google.com/spreadsheets/d/1FiP885Or0ncyRG_ZZaAvM2vP0sHhDzhLFYifYLjKyIE/edit?gid=1689968688', '_blank')" style="background: linear-gradient(135deg, #22c55e, #16a34a); color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.1em; cursor: pointer; font-weight: 600;">üìä Abrir Planilha</button>
            </div>
            <p style="color: #64748b; font-size: 0.85em; margin-top: 10px;">‚ö†Ô∏è Por seguran√ßa, o Safari n√£o permite iframes de arquivos locais. Clique no bot√£o acima.</p>
        </div>
    </div>

    <!-- ABA FRETES DISPON√çVEIS -->
    <div id="fretesdisponiveis" class="tab-content">
        <div class="section-title">üì¶ Fretes Dispon√≠veis - Integrado com Google Sheets</div>
        <p style="text-align: center; color: var(--text-muted); margin-bottom: 20px;">Cadastre e gerencie fretes dispon√≠veis | Integrado em tempo real com a planilha EUCALIPTO</p>
        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-bottom: 20px;">
            <button onclick="window.open('MODULOS/FRETES_DISPONIVEIS.html', '_blank')" class="btn" style="background: linear-gradient(135deg, #8b5cf6, #6d28d9);">üîó Abrir Fretes Completo</button>
            <button onclick="window.open('https://docs.google.com/spreadsheets/d/1FiP885Or0ncyRG_ZZaAvM2vP0sHhDzhLFYifYLjKyIE/edit?gid=1716433489', '_blank')" class="btn" style="background: linear-gradient(135deg, #22c55e, #16a34a);">üìä Abrir Planilha</button>
        </div>
        <div style="width: 100%; height: 400px; border: 2px solid #8b5cf6; border-radius: 12px; background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 20px;">
            <div style="font-size: 4em;">üì¶</div>
            <h2 style="color: #8b5cf6; margin: 0;">Fretes Dispon√≠veis</h2>
            <p style="color: #94a3b8; text-align: center; max-width: 500px;">Sistema de fretes com rotas dispon√≠veis, valores, filtros por origem/destino e integra√ß√£o com transportadores.</p>
            <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
                <button onclick="window.open('MODULOS/FRETES_DISPONIVEIS.html', '_blank')" style="background: linear-gradient(135deg, #8b5cf6, #6d28d9); color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.1em; cursor: pointer; font-weight: 600;">üöÄ Abrir Fretes</button>
                <button onclick="window.open('https://docs.google.com/spreadsheets/d/1FiP885Or0ncyRG_ZZaAvM2vP0sHhDzhLFYifYLjKyIE/edit?gid=1716433489', '_blank')" style="background: linear-gradient(135deg, #22c55e, #16a34a); color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.1em; cursor: pointer; font-weight: 600;">üìä Abrir Planilha</button>
            </div>
            <p style="color: #64748b; font-size: 0.85em; margin-top: 10px;">‚ö†Ô∏è Por seguran√ßa, o Safari n√£o permite iframes de arquivos locais. Clique no bot√£o acima.</p>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script>
        // ==================== FUN√á√ÉO MADEIRAS ULTRA ====================
        function recarregarMadeirasUltra() {
            const iframe = document.getElementById('madeirasUltraFrame');
            if (iframe) {
                iframe.src = iframe.src;
                alert('üîÑ Recarregando Madeiras Ultra...');
            }
        }

        // ==================== FUN√á√ÉO CONTATO MARKETING ====================
        function enviarContatoMarketing() {
            const nome = document.getElementById('marketingNome').value.trim();
            const telefone = document.getElementById('marketingTelefone').value.trim();
            const interesse = document.getElementById('marketingInteresse').value;
            const statusDiv = document.getElementById('statusContatoMarketing');
            
            if (!nome || !telefone) {
                statusDiv.innerHTML = '<p style="color: #ef4444;">‚ö†Ô∏è Por favor, preencha nome e telefone.</p>';
                return;
            }
            
            // Salvar contato localmente
            const contatos = JSON.parse(localStorage.getItem('contatosMarketing') || '[]');
            contatos.push({
                timestamp: new Date().toISOString(),
                nome: nome,
                telefone: telefone,
                interesse: interesse
            });
            localStorage.setItem('contatosMarketing', JSON.stringify(contatos));
            
            statusDiv.innerHTML = `
                <div style="background: rgba(34,197,94,0.2); padding: 20px; border-radius: 12px; border: 1px solid #22c55e;">
                    <p style="color: #22c55e; font-weight: bold; font-size: 1.3em;">‚úÖ Mensagem enviada!</p>
                    <p style="color: #fff; margin-top: 10px;">Obrigado, ${nome}! Entraremos em contato em breve.</p>
                </div>
            `;
            
            // Limpar formul√°rio
            document.getElementById('marketingNome').value = '';
            document.getElementById('marketingTelefone').value = '';
        }

        // ==================== NAVEGA√á√ÉO ABAS ====================
        function mudarAba(abaId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById(abaId).classList.add('active');
            event.target.classList.add('active');
            
            window.scrollTo(0, 0);

            // ‚îÄ‚îÄ Carregamento autom√°tico de dados ao trocar de aba ‚îÄ‚îÄ
            setTimeout(async () => {
                try {
                    if (abaId === 'contatoscrm' || abaId === 'triagem' || abaId === 'evolution') {
                        // Aba CONTATOS (gid=1689968688)
                        if (typeof carregarContatosGoogleSheets === 'function' && contatosGoogleSheets.length === 0) {
                            await carregarContatosGoogleSheets();
                        }
                        if (abaId === 'triagem') atualizarEstatisticasTriagem();
                    } else if (abaId === 'fretesdisponiveis') {
                        // Aba FRETES_DISPONIVEIS (gid=1716433489)
                        if (typeof carregarFretesGoogleSheets === 'function') {
                            await carregarFretesGoogleSheets();
                        }
                    } else if (abaId === 'captacaofretes') {
                        // Aba CAPTACAO_FRETES (gid=1335082895)
                        if (typeof carregarCaptacaoFretesGoogleSheets === 'function') {
                            await carregarCaptacaoFretesGoogleSheets();
                        }
                    } else if (abaId === 'listas') {
                        // Aba LISTAS_TRANSMISSAO (gid=1114979046)
                        if (typeof carregarContatosGoogleSheets === 'function' && contatosGoogleSheets.length === 0) {
                            await carregarContatosGoogleSheets();
                        }
                        if (typeof sincronizarListasComPlanilha === 'function') {
                            await sincronizarListasComPlanilha();
                        }
                    } else if (abaId === 'dashboard') {
                        // Dashboard ‚Äî carrega contatos e atualiza KPIs
                        if (typeof carregarContatosGoogleSheets === 'function' && contatosGoogleSheets.length === 0) {
                            await carregarContatosGoogleSheets();
                        }
                        atualizarDashboard();
                    } else if (abaId === 'sincronizacao') {
                        // Aba Sincroniza√ß√£o ‚Äî carrega tudo
                        if (typeof carregarContatosGoogleSheets === 'function' && contatosGoogleSheets.length === 0) {
                            await carregarContatosGoogleSheets();
                        }
                    }
                } catch (e) {
                    console.warn('Erro ao carregar dados da aba', abaId, e);
                }
            }, 100);
        }

        // Atualizar estat√≠sticas da aba Triagem com dados reais da planilha
        function atualizarEstatisticasTriagem() {
            const total = contatosGoogleSheets.length;
            const classificados = contatosGoogleSheets.filter(c => c.categoria && c.categoria.trim() !== '').length;
            const pendentes = total - classificados;
            const precisao = total > 0 ? Math.round((classificados / total) * 100) : 0;
            const el = (id) => document.getElementById(id);
            if (el('triagemTotal')) el('triagemTotal').textContent = total.toLocaleString('pt-BR');
            if (el('triagemClassificados')) el('triagemClassificados').textContent = classificados.toLocaleString('pt-BR');
            if (el('triagemPendentes')) el('triagemPendentes').textContent = pendentes.toLocaleString('pt-BR');
            if (el('triagemPrecisao')) el('triagemPrecisao').textContent = precisao + '%';
            // Atualizar o select de fonte de dados
            const sel = document.getElementById('triagemFonte');
            if (sel && sel.options[0]) sel.options[0].text = `üìä Todos os Contatos (${total.toLocaleString('pt-BR')})`;
            if (sel && sel.options[1]) sel.options[1].text = `‚è≥ Apenas Pendentes (${pendentes.toLocaleString('pt-BR')})`;
        }

        // Atualizar KPIs do Dashboard com dados reais da planilha
        function atualizarDashboard() {
            const total = contatosGoogleSheets.length;
            if (total === 0) return;
            const fornecedores = contatosGoogleSheets.filter(c => c.categoria?.toUpperCase().includes('FORNECEDOR')).length;
            const clientes = contatosGoogleSheets.filter(c => c.categoria?.toUpperCase().includes('CLIENTE')).length;
            const transportadores = contatosGoogleSheets.filter(c =>
                c.categoria?.toUpperCase().includes('TRANSPORTADOR') ||
                c.categoria?.toUpperCase().includes('MOTORISTA')
            ).length;
            // Atualizar os stat-cards do dashboard (4 primeiros)
            const cards = document.querySelectorAll('#dashboard .stat-value');
            if (cards[0]) cards[0].textContent = total.toLocaleString('pt-BR');
            if (cards[1]) cards[1].textContent = fornecedores.toLocaleString('pt-BR');
            if (cards[2]) cards[2].textContent = transportadores.toLocaleString('pt-BR');
            if (cards[3]) cards[3].textContent = clientes.toLocaleString('pt-BR');
        }

        // ==================== CATEGORIAS E SUBCATEGORIAS IMPORTADOR UNIVERSAL ====================
        const CATEGORIAS_ARQUIVOS = {
            dados: {
                nome: 'üìä Dados e Planilhas',
                extensoes: ['.csv', '.xlsx', '.xls', '.numbers', '.ods', '.tsv'],
                subcategorias: [
                    { id: 'contatos', nome: 'üë• Contatos', palavras: ['contato', 'cliente', 'fornecedor', 'telefone', 'email'] },
                    { id: 'financeiro', nome: 'üíµ Financeiro', palavras: ['preco', 'custo', 'valor', 'orcamento', 'pagamento'] },
                    { id: 'vendas', nome: 'üí∞ Vendas', palavras: ['venda', 'pedido', 'fatura', 'nota'] },
                    { id: 'estoque', nome: 'üì¶ Estoque', palavras: ['estoque', 'produto', 'inventario', 'quantidade'] },
                    { id: 'fretes', nome: 'üöö Fretes', palavras: ['frete', 'transporte', 'entrega', 'cte'] },
                    { id: 'relatorios', nome: 'üìà Relat√≥rios', palavras: ['relatorio', 'analise', 'resumo'] },
                    { id: 'cadastros', nome: 'üìã Cadastros', palavras: ['cadastro', 'registro', 'base'] },
                    { id: 'importacoes', nome: 'üì• Importa√ß√µes', palavras: ['import', 'export', 'backup'] }
                ]
            },
            documentos: {
                nome: 'üìÑ Documentos',
                extensoes: ['.pdf', '.doc', '.docx', '.txt', '.rtf', '.odt', '.pages'],
                subcategorias: [
                    { id: 'contratos', nome: 'üìù Contratos', palavras: ['contrato', 'termo', 'acordo'] },
                    { id: 'notas_fiscais', nome: 'üßæ Notas Fiscais', palavras: ['nfe', 'nfs', 'fiscal', 'nota'] },
                    { id: 'propostas', nome: 'üìä Propostas', palavras: ['proposta', 'orcamento', 'cotacao'] },
                    { id: 'manuais', nome: 'üìñ Manuais', palavras: ['manual', 'guia', 'instrucao'] },
                    { id: 'correspondencia', nome: '‚úâÔ∏è Correspond√™ncia', palavras: ['carta', 'oficio', 'comunicado'] },
                    { id: 'certidoes', nome: 'üìú Certid√µes', palavras: ['certidao', 'documento', 'legal'] },
                    { id: 'anotacoes', nome: 'üìù Anota√ß√µes', palavras: ['nota', 'lembrete', 'rascunho'] }
                ]
            },
            imagens: {
                nome: 'üñºÔ∏è Imagens',
                extensoes: ['.jpg', '.jpeg', '.png', '.gif', '.bmp', '.tiff', '.webp', '.heic', '.svg', '.ico'],
                subcategorias: [
                    { id: 'produtos', nome: 'üì∑ Produtos', palavras: ['produto', 'catalogo', 'item'] },
                    { id: 'documentos_scan', nome: 'üì± Documentos Scan', palavras: ['scan', 'copia', 'digitalizado'] },
                    { id: 'logos', nome: 'üé® Logos', palavras: ['logo', 'marca', 'identidade'] },
                    { id: 'marketing', nome: 'üì∞ Marketing', palavras: ['banner', 'promocao', 'anuncio'] },
                    { id: 'comprovantes', nome: 'üßæ Comprovantes', palavras: ['comprovante', 'recibo', 'pagamento'] },
                    { id: 'screenshots', nome: 'üì∏ Screenshots', palavras: ['screenshot', 'captura', 'tela'] }
                ]
            },
            videos: {
                nome: 'üé¨ V√≠deos',
                extensoes: ['.mp4', '.mov', '.avi', '.mkv', '.wmv', '.flv', '.webm', '.m4v'],
                subcategorias: [
                    { id: 'tutoriais', nome: 'üéì Tutoriais', palavras: ['tutorial', 'treinamento', 'aula'] },
                    { id: 'produtos_video', nome: 'üìπ Produtos', palavras: ['produto', 'demonstracao'] },
                    { id: 'reunioes', nome: 'üíº Reuni√µes', palavras: ['reuniao', 'meeting', 'call'] },
                    { id: 'marketing_video', nome: 'üì∫ Marketing', palavras: ['promocional', 'comercial'] }
                ]
            },
            audios: {
                nome: 'üéµ √Åudios',
                extensoes: ['.mp3', '.wav', '.aac', '.m4a', '.ogg', '.flac', '.wma'],
                subcategorias: [
                    { id: 'gravacoes', nome: 'üéôÔ∏è Grava√ß√µes', palavras: ['gravacao', 'reuniao', 'entrevista'] },
                    { id: 'whatsapp_audio', nome: 'üì± WhatsApp', palavras: ['whatsapp', 'audio', 'ptt'] },
                    { id: 'notas_voz', nome: 'üí¨ Notas de Voz', palavras: ['nota', 'lembrete', 'voz'] }
                ]
            },
            compactados: {
                nome: 'üì¶ Arquivos Compactados',
                extensoes: ['.zip', '.rar', '.7z', '.tar', '.gz', '.bz2', '.dmg'],
                subcategorias: [
                    { id: 'backups', nome: 'üíæ Backups', palavras: ['backup', 'copia'] },
                    { id: 'downloads', nome: '‚¨áÔ∏è Downloads', palavras: ['download', 'baixado'] },
                    { id: 'projetos', nome: 'üìÅ Projetos', palavras: ['projeto', 'source'] },
                    { id: 'instaladores', nome: 'üì• Instaladores', palavras: ['install', 'setup', 'pkg'] }
                ]
            },
            codigo: {
                nome: 'üíª C√≥digo e Desenvolvimento',
                extensoes: ['.html', '.css', '.js', '.json', '.xml', '.py', '.php', '.sql', '.md', '.yml', '.yaml'],
                subcategorias: [
                    { id: 'web', nome: 'üåê Web', palavras: ['html', 'css', 'javascript'] },
                    { id: 'dados_code', nome: 'üìä Dados', palavras: ['json', 'xml', 'yaml'] },
                    { id: 'scripts', nome: '‚öôÔ∏è Scripts', palavras: ['python', 'php', 'shell'] },
                    { id: 'banco_dados', nome: 'üóÑÔ∏è Banco de Dados', palavras: ['sql', 'dump', 'database'] },
                    { id: 'documentacao_code', nome: 'üìñ Documenta√ß√£o', palavras: ['readme', 'docs', 'markdown'] }
                ]
            },
            emails: {
                nome: 'üìß Emails e Mensagens',
                extensoes: ['.eml', '.msg', '.mbox', '.vcf'],
                subcategorias: [
                    { id: 'comerciais', nome: 'üíº Comerciais', palavras: ['comercial', 'negocio', 'proposta'] },
                    { id: 'pessoais', nome: 'üë§ Pessoais', palavras: ['pessoal', 'particular'] },
                    { id: 'contatos_vcf', nome: 'üë• Contatos vCard', palavras: ['contato', 'vcard'] }
                ]
            },
            calendario: {
                nome: 'üìÖ Calend√°rio e Eventos',
                extensoes: ['.ics', '.ical', '.vcs'],
                subcategorias: [
                    { id: 'reunioes_cal', nome: 'üíº Reuni√µes', palavras: ['reuniao', 'meeting'] },
                    { id: 'eventos', nome: 'üéâ Eventos', palavras: ['evento', 'compromisso'] },
                    { id: 'lembretes', nome: '‚è∞ Lembretes', palavras: ['lembrete', 'reminder'] }
                ]
            },
            enside: {
                nome: 'üå≤ ENSIDE Madeiras',
                extensoes: [],
                subcategorias: [
                    { id: 'fornecedores_madeira', nome: 'üè≠ Fornecedores Madeira', palavras: ['fornecedor', 'madeira', 'serraria'] },
                    { id: 'fornecedores_cca', nome: 'üß™ Tratamento CCA', palavras: ['cca', 'tratamento', 'autoclave'] },
                    { id: 'clientes_varejo', nome: 'üè™ Clientes Varejo', palavras: ['varejo', 'loja', 'comercio'] },
                    { id: 'clientes_atacado', nome: 'üè≠ Clientes Atacado', palavras: ['atacado', 'distribuidor'] },
                    { id: 'clientes_construcao', nome: 'üèóÔ∏è Clientes Constru√ß√£o', palavras: ['construcao', 'obra', 'construtora'] },
                    { id: 'transportadores', nome: 'üöö Transportadores', palavras: ['transporte', 'frete', 'caminhao'] },
                    { id: 'precos_mouroes', nome: 'ü™µ Pre√ßos Mour√µes', palavras: ['mourao', 'cerca', 'poste'] },
                    { id: 'precos_postes', nome: 'ü™® Pre√ßos Postes', palavras: ['poste', 'eucalipto'] },
                    { id: 'precos_estacas', nome: 'ü™µ Pre√ßos Estacas', palavras: ['estaca', 'fundacao'] },
                    { id: 'custos_tratamento', nome: 'üí∞ Custos Tratamento', palavras: ['custo', 'tratamento', 'cca'] },
                    { id: 'tabelas_frete', nome: 'üìä Tabelas Frete', palavras: ['frete', 'tabela', 'km'] },
                    { id: 'pedidos_madeira', nome: 'üìã Pedidos', palavras: ['pedido', 'ordem', 'compra'] },
                    { id: 'madeira_eucalipto', nome: 'üå≤ Eucalipto', palavras: ['eucalipto', 'eucalyptus', 'tora eucalipto'] },
                    { id: 'madeira_pinus', nome: 'üå≤ Pinus', palavras: ['pinus', 'pinho', 'tora pinus'] },
                    { id: 'madeira_tratada', nome: 'üß™ Madeira Tratada', palavras: ['tratada', 'autoclave', 'imunizada'] },
                    { id: 'madeira_serrada', nome: 'ü™® Madeira Serrada', palavras: ['serrada', 'tabua', 'prancha', 'viga', 'caibro'] },
                    { id: 'madeira_bruta', nome: 'ü™µ Madeira Bruta', palavras: ['bruta', 'tora', 'tronco', 'lenha'] },
                    { id: 'medicoes_cubagem', nome: 'üìè Medi√ß√µes/Cubagem', palavras: ['medicao', 'cubagem', 'volume', 'm3', 'metro cubico'] },
                    { id: 'romaneios', nome: 'üìã Romaneios', palavras: ['romaneio', 'carga', 'descarga', 'manifesto'] },
                    { id: 'certificados_dof', nome: 'üèÖ Certificados DOF', palavras: ['certificado', 'dof', 'ibama', 'origem florestal'] }
                ]
            },
            whatsapp: {
                nome: 'üì± WhatsApp e Redes Sociais',
                extensoes: [],
                subcategorias: [
                    { id: 'contatos_wa', nome: 'üë• Contatos WhatsApp', palavras: ['contato', 'whatsapp', 'telefone'] },
                    { id: 'grupos_wa', nome: 'üë• Grupos WhatsApp', palavras: ['grupo', 'whatsapp'] },
                    { id: 'midias_wa', nome: 'üñºÔ∏è M√≠dias WhatsApp', palavras: ['midia', 'foto', 'video', 'whatsapp'] },
                    { id: 'exportacoes_chat', nome: 'üí¨ Exporta√ß√µes Chat', palavras: ['chat', 'conversa', 'historico'] },
                    { id: 'instagram', nome: 'üì∏ Instagram', palavras: ['instagram', 'insta', 'reels', 'stories'] },
                    { id: 'facebook', nome: 'üë§ Facebook', palavras: ['facebook', 'fb', 'meta'] },
                    { id: 'linkedin', nome: 'üíº LinkedIn', palavras: ['linkedin', 'profissional', 'networking'] },
                    { id: 'tiktok', nome: 'üéµ TikTok', palavras: ['tiktok', 'tt', 'viral'] }
                ]
            },
            design: {
                nome: 'üé® Design e Criativo',
                extensoes: ['.psd', '.ai', '.sketch', '.fig', '.xd', '.indd', '.eps'],
                subcategorias: [
                    { id: 'photoshop', nome: 'üñºÔ∏è Photoshop', palavras: ['psd', 'photoshop'] },
                    { id: 'illustrator', nome: '‚úèÔ∏è Illustrator', palavras: ['ai', 'illustrator', 'vetor'] },
                    { id: 'figma', nome: 'üì± Figma', palavras: ['figma', 'ui', 'ux'] },
                    { id: 'indesign', nome: 'üì∞ InDesign', palavras: ['indesign', 'layout', 'editorial'] },
                    { id: 'canva', nome: 'üé® Canva', palavras: ['canva', 'design social'] },
                    { id: 'logos', nome: 'üéØ Logos', palavras: ['logo', 'logotipo', 'marca', 'brand'] },
                    { id: 'templates', nome: 'üìê Templates', palavras: ['template', 'modelo', 'layout'] },
                    { id: 'marketing_visual', nome: 'üì¢ Marketing Visual', palavras: ['banner', 'promocao', 'anuncio', 'campanha'] }
                ]
            },
            sistema: {
                nome: 'üîß Sistema e Configura√ß√£o',
                extensoes: ['.plist', '.conf', '.ini', '.log', '.bak'],
                subcategorias: [
                    { id: 'configuracoes', nome: '‚öôÔ∏è Configura√ß√µes', palavras: ['config', 'settings', 'preferencias'] },
                    { id: 'logs', nome: 'üìù Logs', palavras: ['log', 'erro', 'debug'] },
                    { id: 'backups_sys', nome: 'üíæ Backups', palavras: ['backup', 'bak', 'copia'] }
                ]
            }
        };

        // Fun√ß√£o para atualizar subcategorias baseado na categoria selecionada
        function atualizarSubcategorias() {
            const categoria = document.getElementById('categoriaPrincipal').value;
            const subcategoriaSelect = document.getElementById('subcategoria');
            
            // Limpar subcategorias
            subcategoriaSelect.innerHTML = '<option value="auto">ü§ñ Detectar Automaticamente</option>';
            
            if (categoria !== 'auto' && CATEGORIAS_ARQUIVOS[categoria]) {
                CATEGORIAS_ARQUIVOS[categoria].subcategorias.forEach(sub => {
                    const option = document.createElement('option');
                    option.value = sub.id;
                    option.textContent = sub.nome;
                    subcategoriaSelect.appendChild(option);
                });
            }
        }

        // Fun√ß√£o para detectar categoria por extens√£o
        function detectarCategoriaPorExtensao(nomeArquivo) {
            const extensao = '.' + nomeArquivo.split('.').pop().toLowerCase();
            
            for (const [catId, catData] of Object.entries(CATEGORIAS_ARQUIVOS)) {
                if (catData.extensoes.includes(extensao)) {
                    return { categoria: catId, nome: catData.nome };
                }
            }
            return { categoria: 'outros', nome: 'üìÅ Outros' };
        }

        // Fun√ß√£o para detectar subcategoria por conte√∫do/nome
        function detectarSubcategoriaPorConteudo(nomeArquivo, conteudo, categoria) {
            if (!CATEGORIAS_ARQUIVOS[categoria]) return { subcategoria: 'geral', nome: 'üìÅ Geral' };
            
            const textoAnalise = (nomeArquivo + ' ' + (conteudo || '')).toLowerCase();
            
            for (const sub of CATEGORIAS_ARQUIVOS[categoria].subcategorias) {
                for (const palavra of sub.palavras) {
                    if (textoAnalise.includes(palavra.toLowerCase())) {
                        return { subcategoria: sub.id, nome: sub.nome };
                    }
                }
            }
            
            return { subcategoria: 'geral', nome: 'üìÅ Geral' };
        }

        // Fun√ß√£o para classificar arquivo com IA
        async function classificarArquivoComIA(arquivo, conteudo) {
            // Detectar categoria por extens√£o
            const categoriaDetectada = detectarCategoriaPorExtensao(arquivo.name);
            
            // Detectar subcategoria por conte√∫do
            const subcategoriaDetectada = detectarSubcategoriaPorConteudo(
                arquivo.name, 
                conteudo, 
                categoriaDetectada.categoria
            );
            
            // Mostrar resultado
            const divDetectada = document.getElementById('categoriaDetectada');
            const textoDetectada = document.getElementById('categoriaDetectadaTexto');
            
            if (divDetectada && textoDetectada) {
                divDetectada.style.display = 'block';
                textoDetectada.innerHTML = `
                    <strong>${categoriaDetectada.nome}</strong> ‚Üí ${subcategoriaDetectada.nome}
                    <br><small style="color: #94a3b8;">Arquivo: ${arquivo.name}</small>
                `;
            }
            
            return {
                categoria: categoriaDetectada,
                subcategoria: subcategoriaDetectada,
                arquivo: arquivo.name
            };
        }

        // Fun√ß√£o para obter caminho de destino baseado na categoria
        function obterCaminhoDestino(categoria, subcategoria) {
            const basePath = '/Users/andersonenside/ENSIDE_IMPORTADOS';
            const catData = CATEGORIAS_ARQUIVOS[categoria];
            let catNome = 'Outros';
            if (catData && catData.nome) {
                catNome = catData.nome.split(' ').slice(1).join('_') || 'Outros';
            }
            return basePath + '/' + catNome + '/' + subcategoria;
        }

        // ==================== IMPORTADOR ====================
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');

        // Fun√ß√£o para importar arquivos individuais
        function importarArquivos() {
            fileInput.removeAttribute('webkitdirectory');
            fileInput.click();
        }

        // Fun√ß√£o para importar pastas inteiras
        async function importarPastas() {
            if ('showDirectoryPicker' in window) {
                try {
                    const dirHandle = await window.showDirectoryPicker();
                    const arquivos = [];
                    await processarDiretorio(dirHandle, '', arquivos);
                    if (arquivos.length > 0) {
                        alert(`üìÅ ${arquivos.length} arquivos encontrados na pasta!\n\nProcessando...`);
                        // Processa o primeiro arquivo como exemplo
                        if (arquivos[0]) {
                            const file = arquivos[0];
                            const reader = new FileReader();
                            reader.onload = (e) => parseFile(file, e.target.result);
                            reader.readAsText(file);
                        }
                    }
                } catch(e) {
                    console.log('Sele√ß√£o cancelada');
                }
            } else {
                // Fallback para navegadores que n√£o suportam showDirectoryPicker
                fileInput.setAttribute('webkitdirectory', 'true');
                fileInput.click();
            }
        }

        // Fun√ß√£o auxiliar para processar diret√≥rio recursivamente
        async function processarDiretorio(dirHandle, caminhoPai, arquivos) {
            for await (const [nome, handle] of dirHandle.entries()) {
                const caminho = caminhoPai ? `${caminhoPai}/${nome}` : nome;
                if (handle.kind === 'directory') {
                    await processarDiretorio(handle, caminho, arquivos);
                } else {
                    const file = await handle.getFile();
                    // Filtra apenas arquivos suportados
                    const ext = nome.toLowerCase();
                    if (ext.endsWith('.csv') || ext.endsWith('.json') || ext.endsWith('.xlsx') || 
                        ext.endsWith('.xls') || ext.endsWith('.txt') || ext.endsWith('.xml')) {
                        arquivos.push(file);
                    }
                }
            }
        }

        // Evento de clique na drop zone (removido para evitar conflito com bot√µes)
        // dropZone.addEventListener('click', () => fileInput.click());
        
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => handleFiles(e.target.files));

        function handleFiles(files) {
            if (files.length === 0) return;
            const file = files[0];
            const reader = new FileReader();
            reader.onload = (e) => parseFile(file, e.target.result);
            reader.readAsText(file);
        }

        function parseFile(file, content) {
            const lines = content.split('\n');
            const separator = document.getElementById('separator')?.value || ',';
            const hasHeader = true;
            const headerLine = hasHeader ? lines[0].split(separator) : null;
            
            // Armazenar arquivo atual
            arquivoAtual = file;
            
            // Processar TODOS os dados, n√£o apenas preview
            dadosImportados = [];
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = lines[i].split(separator);
                    const row = {};
                    headerLine.forEach((header, index) => {
                        row[header.trim()] = values[index] ? values[index].trim() : '';
                    });
                    dadosImportados.push(row);
                }
            }
            
            // Mostrar preview (primeiros 10 registros)
            const previewData = dadosImportados.slice(0, 10);
            showPreview(previewData, headerLine, dadosImportados.length);
            
            console.log(`üìÑ Arquivo carregado: ${file.name} - ${dadosImportados.length} registros`);
        }

        function showPreview(data, headers, totalRegistros) {
            document.getElementById('previewSection').style.display = 'block';
            const thead = document.getElementById('tableHead');
            const tbody = document.getElementById('tableBody');
            
            thead.innerHTML = '';
            tbody.innerHTML = '';

            headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header.trim();
                thead.appendChild(th);
            });

            data.forEach(row => {
                const tr = document.createElement('tr');
                headers.forEach(header => {
                    const td = document.createElement('td');
                    td.textContent = row[header.trim()] || '';
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
            
            // Mostrar total de registros
            const total = totalRegistros || data.length;
            const previewInfo = document.getElementById('previewInfo');
            if (previewInfo) {
                previewInfo.innerHTML = `<p style="color: #22c55e; margin-top: 10px;">üìä <strong>${total}</strong> registros encontrados (mostrando preview de ${data.length})</p>`;
            } else {
                const infoDiv = document.createElement('div');
                infoDiv.id = 'previewInfo';
                infoDiv.innerHTML = `<p style="color: #22c55e; margin-top: 10px;">üìä <strong>${total}</strong> registros encontrados (mostrando preview de ${data.length})</p>`;
                document.getElementById('previewSection').appendChild(infoDiv);
            }
        }

        // Configura√ß√£o de pastas (sincronizado com Python)
        const CONFIG_PASTAS = {
            base: '/Users/andersonenside',
            destino: '/Users/andersonenside/ENSIDE_IMPORTADOS',
            triagem: '/Users/andersonenside/Triagem',
            doc_pessoais: '/Users/andersonenside/Doc_Pessoais'
        };

        // Vari√°vel global para armazenar dados importados
        let dadosImportados = [];
        let arquivoAtual = null;

        function processarImportacao() {
            document.getElementById('previewSection').style.display = 'none';
            document.getElementById('progressSection').style.display = 'block';
            
            // Obter categoria e subcategoria selecionadas
            const categoria = document.getElementById('categoriaPrincipal')?.value || 'auto';
            const subcategoria = document.getElementById('subcategoria')?.value || 'auto';
            const tipoArquivo = document.getElementById('dataType')?.value || 'auto';
            
            // Verificar se h√° dados para processar
            if (!arquivoAtual && dadosImportados.length === 0) {
                alert('‚ö†Ô∏è Nenhum arquivo selecionado para importar!\n\nPor favor, selecione um arquivo usando os bot√µes "Arquivos" ou "Pasta" ou arraste um arquivo para a √°rea indicada.');
                document.getElementById('progressSection').style.display = 'none';
                return;
            }
            
            let progress = 0;
            const totalRegistros = dadosImportados.length || 0;
            
            const interval = setInterval(() => {
                progress += Math.random() * 25;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    
                    // Processar dados reais
                    const resultado = processarDadosReais(dadosImportados, categoria, subcategoria);
                    mostrarResultadoReal(resultado, categoria, subcategoria, tipoArquivo);
                }
                document.getElementById('progressBar').style.width = progress + '%';
                document.getElementById('progressBar').textContent = Math.floor(progress) + '%';
                
                // Mostrar etapa atual
                let etapa = 'Analisando arquivos...';
                if (progress > 25) etapa = `Processando ${totalRegistros} registros...`;
                if (progress > 50) etapa = 'Classificando com IA...';
                if (progress > 75) etapa = 'Salvando dados...';
                if (progress > 90) etapa = 'Finalizando...';
                document.getElementById('progressText').innerHTML = `üîÑ ${etapa} (${Math.floor(progress)}%)`;
            }, 300);
        }

        function processarDadosReais(dados, categoria, subcategoria) {
            let processados = dados.length;
            let validados = 0;
            let erros = 0;
            let duplicatas = 0;
            let registrosUnicos = new Set();
            let dadosProcessados = [];

            dados.forEach((registro, index) => {
                // Criar chave √∫nica para detectar duplicatas
                const chave = JSON.stringify(registro);
                
                if (registrosUnicos.has(chave)) {
                    duplicatas++;
                } else {
                    registrosUnicos.add(chave);
                    
                    // Validar registro
                    const temDados = Object.values(registro).some(v => v && v.toString().trim() !== '');
                    if (temDados) {
                        validados++;
                        dadosProcessados.push({
                            ...registro,
                            _categoria: categoria,
                            _subcategoria: subcategoria,
                            _importadoEm: new Date().toISOString()
                        });
                    } else {
                        erros++;
                    }
                }
            });

            // Salvar no localStorage
            const dadosAnteriores = JSON.parse(localStorage.getItem('dadosImportadosENSIDE') || '[]');
            const novosDados = [...dadosAnteriores, ...dadosProcessados];
            localStorage.setItem('dadosImportadosENSIDE', JSON.stringify(novosDados));

            return { processados, validados, erros, duplicatas, dadosProcessados };
        }

        function confirmarImportacao() {
            processarImportacao();
        }

        function mostrarResultadoReal(resultado, categoria, subcategoria, tipoArquivo) {
            document.getElementById('progressSection').style.display = 'none';
            document.getElementById('resultSection').style.display = 'block';
            
            const { processados, validados, erros, duplicatas, dadosProcessados } = resultado;
            
            // Determinar pasta de destino baseada na categoria
            let pastaDestino = CONFIG_PASTAS.destino;
            let catNome = 'Outros';
            
            if (categoria && categoria !== 'auto' && CATEGORIAS_ARQUIVOS && CATEGORIAS_ARQUIVOS[categoria]) {
                const catData = CATEGORIAS_ARQUIVOS[categoria];
                catNome = catData.nome || categoria;
                
                if (categoria === 'triagem') {
                    pastaDestino = CONFIG_PASTAS.triagem;
                } else if (categoria === 'doc_pessoais') {
                    pastaDestino = CONFIG_PASTAS.doc_pessoais;
                } else {
                    pastaDestino = CONFIG_PASTAS.destino + '/' + catNome.replace(/[^a-zA-Z0-9]/g, '_');
                }
            }
            
            if (subcategoria && subcategoria !== 'auto') {
                pastaDestino += '/' + subcategoria;
            }
            
            // Mostrar resultado real
            let statusClass = validados > 0 ? 'badge-success' : 'badge-warning';
            let statusIcon = validados > 0 ? '‚úì' : '‚ö†';
            
            document.getElementById('resultContent').innerHTML = `
                <p style="margin: 12px 0;"><span class="badge ${statusClass}">${statusIcon} ${processados} registros processados</span></p>
                <p style="margin: 12px 0;"><span class="badge badge-success">‚úì ${validados} validados com sucesso</span></p>
                ${erros > 0 ? `<p style="margin: 12px 0;"><span class="badge badge-warning">‚ö† ${erros} registros com erros</span></p>` : ''}
                ${duplicatas > 0 ? `<p style="margin: 12px 0;"><span class="badge badge-info">‚úì ${duplicatas} duplicatas removidas</span></p>` : ''}
                <p style="margin: 12px 0;"><span class="badge badge-success">‚úì Dados salvos no sistema</span></p>
                <div style="margin-top: 15px; padding: 15px; background: rgba(34, 197, 94, 0.1); border: 1px solid #22c55e; border-radius: 8px;">
                    <p style="color: #22c55e; font-weight: bold;">üìÇ Pasta de destino:</p>
                    <p style="color: var(--text); font-family: monospace; font-size: 0.9em;">${pastaDestino}</p>
                    <button onclick="abrirPastaMac('${pastaDestino}')" style="margin-top: 10px; padding: 8px 15px; font-size: 0.85em;">
                        üìÅ Abrir Pasta no Finder
                    </button>
                </div>
                <div style="margin-top: 15px; padding: 10px; background: rgba(14, 165, 233, 0.1); border-radius: 8px;">
                    <p style="color: #94a3b8; font-size: 0.85em;">
                        üí° <strong>Total no sistema:</strong> ${JSON.parse(localStorage.getItem('dadosImportadosENSIDE') || '[]').length} registros importados
                    </p>
                </div>
            `;
            
            updateStats(processados, validados, erros, duplicatas);
            
            // Limpar dados ap√≥s importa√ß√£o
            dadosImportados = [];
            arquivoAtual = null;
        }

        // Fun√ß√£o legada para compatibilidade
        function mostrarResultado(categoria, subcategoria, tipoArquivo) {
            mostrarResultadoReal({ processados: 0, validados: 0, erros: 0, duplicatas: 0, dadosProcessados: [] }, categoria, subcategoria, tipoArquivo);
        }

        function cancelarImportacao() {
            document.getElementById('previewSection').style.display = 'none';
            fileInput.value = '';
        }

        function novaImportacao() {
            document.getElementById('resultSection').style.display = 'none';
            fileInput.value = '';
            fileInput.click();
        }

        // ==================== PROCESSADOR ====================
        function executarValidacao() {
            alert('‚úÖ 142 registros validados com sucesso!');
            document.getElementById('statValidados').textContent = '142';
        }

        function executarLimpeza() {
            alert('üßπ Dados limpos e normalizados!');
        }

        function executarDeduplicacao() {
            alert('üîó 5 duplicatas removidas!');
            document.getElementById('statDuplicatas').textContent = '5';
        }

        function executarOrganizacao() {
            alert('üìÇ Arquivos organizados nas pastas corretas!');
        }

        function updateStats(processados, validados, erros, duplicatas) {
            document.getElementById('statProcessados').textContent = processados;
            document.getElementById('statValidados').textContent = validados;
            document.getElementById('statErros').textContent = erros;
            document.getElementById('statDuplicatas').textContent = duplicatas;
        }

        // ==================== GITHUB API ====================
        // Configura√ß√£o do GitHub com persist√™ncia
        let githubConfig = JSON.parse(localStorage.getItem('githubConfig')) || {
            url: localStorage.getItem('githubUrl') || '',
            token: localStorage.getItem('githubToken') || '',
            lastRepo: localStorage.getItem('githubLastRepo') || '',
            connected: localStorage.getItem('githubConnected') === 'true'
        };

        async function conectarGitHub() {
            const url = document.getElementById('githubUrl').value.trim();
            if (!url) {
                alert('Por favor, insira a URL ou nome do reposit√≥rio');
                return;
            }

            const repoPath = url.includes('github.com/') ? url.split('github.com/')[1] : url;
            const parts = repoPath.replace(/^\/|\/$|\.git$/g, '').split('/');
            const owner = parts[0];
            const repo = parts[1];

            if (!owner || !repo) {
                alert('‚ùå URL inv√°lida. Use: https://github.com/usuario/repositorio');
                return;
            }

            try {
                const headers = { 'Accept': 'application/vnd.github.v3+json' };
                const token = document.getElementById('githubToken')?.value || githubConfig.token;
                if (token) {
                    headers['Authorization'] = 'token ' + token;
                }

                const response = await fetch('https://api.github.com/repos/' + owner + '/' + repo, { headers });
                const data = await response.json();

                if (response.ok) {
                    // Salvar no localStorage para persist√™ncia
                    githubConfig.url = url;
                    githubConfig.lastRepo = owner + '/' + repo;
                    githubConfig.connected = true;
                    if (token) githubConfig.token = token;
                    localStorage.setItem('githubConfig', JSON.stringify(githubConfig));
                    
                    localStorage.setItem('githubUrl', url);
                    localStorage.setItem('githubLastRepo', owner + '/' + repo);
                    localStorage.setItem('githubConnected', 'true');
                    if (token) localStorage.setItem('githubToken', token);

                    mostrarInfoGitHub(data);
                } else {
                    alert('‚ùå Reposit√≥rio n√£o encontrado: ' + (data.message || 'Erro desconhecido'));
                }
            } catch (error) {
                alert('‚ùå Erro ao conectar: ' + error.message);
            }
        }

        // Reconectar automaticamente ao carregar a p√°gina
        async function reconectarGitHub() {
            if (githubConfig.connected && githubConfig.lastRepo) {
                const urlInput = document.getElementById('githubUrl');
                if (urlInput && !urlInput.value) {
                    urlInput.value = githubConfig.url || 'https://github.com/' + githubConfig.lastRepo;
                }
                
                const tokenInput = document.getElementById('githubToken');
                if (tokenInput && githubConfig.token) {
                    tokenInput.value = githubConfig.token;
                }

                // Reconectar automaticamente
                try {
                    const parts = githubConfig.lastRepo.split('/');
                    const owner = parts[0];
                    const repo = parts[1];
                    const headers = { 'Accept': 'application/vnd.github.v3+json' };
                    if (githubConfig.token) {
                        headers['Authorization'] = 'token ' + githubConfig.token;
                    }

                    const response = await fetch('https://api.github.com/repos/' + owner + '/' + repo, { headers });
                    if (response.ok) {
                        const data = await response.json();
                        mostrarInfoGitHub(data);
                        console.log('‚úÖ GitHub reconectado automaticamente:', githubConfig.lastRepo);
                    }
                } catch (error) {
                    console.warn('‚ö†Ô∏è N√£o foi poss√≠vel reconectar ao GitHub:', error.message);
                }
            }
        }

        // Fun√ß√£o para abrir pasta no Mac (Finder)
        function abrirPastaMac(caminho) {
            // Abre a pasta no Finder usando file:// protocol
            const url = 'file://' + caminho;
            window.open(url, '_blank');
            console.log('üìÇ Abrindo pasta:', caminho);
        }

        // Desconectar do GitHub
        function desconectarGitHub() {
            githubConfig = { url: '', token: '', lastRepo: '', connected: false };
            localStorage.removeItem('githubConfig');
            localStorage.removeItem('githubUrl');
            localStorage.removeItem('githubToken');
            localStorage.removeItem('githubLastRepo');
            localStorage.removeItem('githubConnected');
            
            document.getElementById('githubInfoSection').style.display = 'none';
            document.getElementById('githubStatsSection').style.display = 'none';
            document.getElementById('githubUrl').value = '';
            
            alert('üîì Desconectado do GitHub');
        }

        function mostrarInfoGitHub(data) {
            document.getElementById('githubInfoSection').style.display = 'block';
            document.getElementById('githubStatsSection').style.display = 'block';
            document.getElementById('githubEnviarSection').style.display = 'block';

            const infoHtml = `
                <table>
                    <tr><th>Propriedade</th><th>Valor</th></tr>
                    <tr><td>Nome</td><td>${data.name}</td></tr>
                    <tr><td>Descri√ß√£o</td><td>${data.description || 'N/A'}</td></tr>
                    <tr><td>Propriet√°rio</td><td>${data.owner.login}</td></tr>
                    <tr><td>URL</td><td><a href="${data.html_url}" target="_blank" style="color: #0ea5e9;">${data.html_url}</a></td></tr>
                    <tr><td>Linguagem Principal</td><td>${data.language || 'N/A'}</td></tr>
                    <tr><td>Licen√ßa</td><td>${data.license?.name || 'N/A'}</td></tr>
                </table>
            `;

            const statsHtml = `
                <div class="stat-card">
                    <div class="stat-value">${data.stargazers_count}</div>
                    <div class="stat-label">‚≠ê Stars</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${data.forks_count}</div>
                    <div class="stat-label">üîÄ Forks</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${data.watchers_count}</div>
                    <div class="stat-label">üëÅÔ∏è Watchers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${data.open_issues_count}</div>
                    <div class="stat-label">üìã Issues</div>
                </div>
            `;

            document.getElementById('githubInfo').innerHTML = infoHtml;
            document.getElementById('githubStats').innerHTML = statsHtml;
        }

        // ==================== SINCRONIZA√á√ÉO ====================
        function sincronizarSheets() {
            alert('üîÑ Sincronizando com Google Sheets...\n‚úÖ Sincroniza√ß√£o completa!');
        }

        // Fun√ß√£o para enviar dados ao GitHub
        async function enviarParaGitHub() {
            if (!githubConfig.connected || !githubConfig.token) {
                alert('‚ö†Ô∏è Voc√™ precisa conectar ao GitHub com um token v√°lido para enviar dados.');
                return;
            }
            
            const commitMsg = document.getElementById('commitMessage').value || 'Atualiza√ß√£o autom√°tica ENSIDE ' + new Date().toLocaleString('pt-BR');
            const statusDiv = document.getElementById('statusEnvioGitHub');
            
            statusDiv.innerHTML = '<p style="color: #f59e0b;">‚è≥ Preparando dados para envio...</p>';
            
            try {
                // Coletar dados do sistema
                const dadosSistema = {
                    timestamp: new Date().toISOString(),
                    versao: 'v16.0',
                    contatos: JSON.parse(localStorage.getItem('contatosSistema') || '[]'),
                    listas: JSON.parse(localStorage.getItem('listasTransmissao') || '[]'),
                    aprendizados: JSON.parse(localStorage.getItem('aprendizados') || '[]'),
                    config: {
                        github: githubConfig,
                        evolutionApi: JSON.parse(localStorage.getItem('evolutionApiConfig') || '{}')
                    }
                };
                
                // Criar arquivo JSON para upload
                const conteudo = JSON.stringify(dadosSistema, null, 2);
                const conteudoBase64 = btoa(unescape(encodeURIComponent(conteudo)));
                
                const [owner, repo] = githubConfig.lastRepo.split('/');
                const fileName = 'backup/enside_backup_' + new Date().toISOString().split('T')[0] + '.json';
                
                // Verificar se arquivo existe
                let sha = null;
                try {
                    const checkResponse = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${fileName}`, {
                        headers: { 'Authorization': 'token ' + githubConfig.token }
                    });
                    if (checkResponse.ok) {
                        const existingFile = await checkResponse.json();
                        sha = existingFile.sha;
                    }
                } catch (e) {}
                
                // Enviar arquivo
                const body = {
                    message: commitMsg,
                    content: conteudoBase64,
                    branch: 'main'
                };
                if (sha) body.sha = sha;
                
                const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${fileName}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': 'token ' + githubConfig.token,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                });
                
                if (response.ok) {
                    statusDiv.innerHTML = `
                        <div style="background: rgba(34,197,94,0.2); padding: 15px; border-radius: 8px; border: 1px solid #22c55e;">
                            <p style="color: #22c55e; font-weight: bold;">‚úÖ Dados enviados com sucesso!</p>
                            <p style="color: #94a3b8; font-size: 0.9em; margin-top: 8px;">
                                üìÅ Arquivo: ${fileName}<br>
                                üìù Commit: ${commitMsg}<br>
                                üìÖ Data: ${new Date().toLocaleString('pt-BR')}
                            </p>
                        </div>
                    `;
                } else {
                    throw new Error('Erro ao enviar: ' + response.status);
                }
            } catch (error) {
                statusDiv.innerHTML = `<p style="color: #ef4444;">‚ùå Erro: ${error.message}</p>`;
            }
        }
        
        async function sincronizarDoGitHub() {
            alert('üì• Funcionalidade de sincroniza√ß√£o do GitHub em desenvolvimento.\n\nEm breve voc√™ poder√° restaurar backups diretamente do reposit√≥rio.');
        }

        function criarBackup() {
            // Coletar todos os dados do sistema
            const dadosBackup = {
                timestamp: new Date().toISOString(),
                versao: 'ENSIDE MASTER v16.0',
                contatos: JSON.parse(localStorage.getItem('contatosSistema') || '[]'),
                listas: JSON.parse(localStorage.getItem('listasTransmissao') || '[]'),
                aprendizados: JSON.parse(localStorage.getItem('aprendizados') || '[]'),
                githubConfig: JSON.parse(localStorage.getItem('githubConfig') || '{}'),
                evolutionConfig: JSON.parse(localStorage.getItem('evolutionApiConfig') || '{}')
            };
            
            // Criar arquivo de download
            const blob = new Blob([JSON.stringify(dadosBackup, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ENSIDE_BACKUP_' + new Date().toISOString().split('T')[0] + '.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // Salvar registro do backup
            const backups = JSON.parse(localStorage.getItem('backupsRealizados') || '[]');
            backups.unshift({
                data: new Date().toISOString(),
                tipo: 'manual',
                tamanho: blob.size
            });
            localStorage.setItem('backupsRealizados', JSON.stringify(backups.slice(0, 10)));
            
            alert('üíæ Backup criado com sucesso!\n\nüìÅ Arquivo baixado: ' + a.download + '\nüìä Tamanho: ' + (blob.size / 1024).toFixed(2) + ' KB');
        }

        function listarBackups() {
            alert('üìã Backups dispon√≠veis:\n1. 10/12/2025 14:30\n2. 10/12/2025 08:00\n3. 09/12/2025 20:00');
        }

        function configurarSeguranca() {
            alert('üîê Configura√ß√µes de seguran√ßa\nCriptografia: AES-256\nStatus: Ativo');
        }

        // ==================== FUN√á√ïES DE CATEGORIAS DO IMPORTADOR ====================
        const SUBCATEGORIAS_DETALHADAS = {
            triagem: {
                nome: 'üìã Triagem',
                cor: '#f59e0b',
                extensoes: ['.pdf', '.jpg', '.png', '.xlsx', '.csv', '.txt'],
                pasta: '/Users/andersonenside/Triagem',
                subcategorias: [
                    { id: 'cpf', nome: 'üÜî CPF', desc: 'Documentos de CPF', ext: '.pdf, .jpg', pasta: 'CPF', palavras: ['cpf', 'cadastro pessoa fisica'] },
                    { id: 'banco', nome: 'üè¶ Banco', desc: 'Documentos banc√°rios', ext: '.pdf, .xlsx', pasta: 'Banco', palavras: ['banco', 'bancario', 'agencia', 'bb', 'caixa', 'itau', 'bradesco', 'santander'] },
                    { id: 'conta', nome: 'üí≥ Conta', desc: 'Informa√ß√µes de contas', ext: '.pdf, .txt', pasta: 'Conta', palavras: ['conta', 'corrente', 'poupanca', 'numero conta'] },
                    { id: 'extratos', nome: 'üìä Extratos', desc: 'Extratos banc√°rios', ext: '.pdf, .xlsx', pasta: 'Extratos', palavras: ['extrato', 'movimentacao', 'saldo', 'debito', 'credito'] }
                ]
            },
            doc_pessoais: {
                nome: 'üë§ Doc Pessoais',
                cor: '#8b5cf6',
                extensoes: ['.pdf', '.jpg', '.jpeg', '.png', '.doc', '.docx'],
                pasta: '/Users/andersonenside/Doc_Pessoais',
                subcategorias: [
                    { id: 'rg', nome: 'ü™™ RG', desc: 'Registro Geral', ext: '.pdf, .jpg', pasta: 'RG', palavras: ['rg', 'identidade', 'registro geral'] },
                    { id: 'cnh', nome: 'üöó CNH', desc: 'Carteira de Habilita√ß√£o', ext: '.pdf, .jpg', pasta: 'CNH', palavras: ['cnh', 'habilitacao', 'carteira motorista'] },
                    { id: 'certidoes', nome: 'üìú Certid√µes', desc: 'Certid√µes diversas', ext: '.pdf', pasta: 'Certidoes', palavras: ['certidao', 'nascimento', 'casamento', 'obito'] },
                    { id: 'comprovantes', nome: 'üè† Comprovantes', desc: 'Comprovantes de resid√™ncia', ext: '.pdf, .jpg', pasta: 'Comprovantes', palavras: ['comprovante', 'residencia', 'endereco', 'luz', 'agua', 'telefone'] },
                    { id: 'contratos', nome: 'üìù Contratos', desc: 'Contratos pessoais', ext: '.pdf, .docx', pasta: 'Contratos', palavras: ['contrato', 'acordo', 'termo'] }
                ]
            },
            dados: {
                nome: 'üìä Dados e Planilhas',
                cor: '#22c55e',
                extensoes: ['.csv', '.xlsx', '.xls', '.json', '.xml', '.ods', '.numbers'],
                pasta: '/Users/andersonenside/Planilhas',
                subcategorias: [
                    { id: 'csv', nome: 'üìÑ CSV', desc: 'Valores separados por v√≠rgula', ext: '.csv', pasta: '/Users/andersonenside/Planilhas' },
                    { id: 'excel', nome: 'üìä Excel', desc: 'Planilhas Microsoft Excel', ext: '.xlsx, .xls', pasta: '/Users/andersonenside/Planilhas' },
                    { id: 'json', nome: 'üìù JSON', desc: 'JavaScript Object Notation', ext: '.json', pasta: '/Users/andersonenside/ENSIDE_IMPORTADOS' },
                    { id: 'xml', nome: 'üìÅ XML', desc: 'Extensible Markup Language', ext: '.xml', pasta: '/Users/andersonenside/ENSIDE_IMPORTADOS' },
                    { id: 'financeiro', nome: 'üí∞ Financeiro', desc: 'Dados financeiros', ext: '.ofx, .qfx', pasta: '/Users/andersonenside/Banco e Finan√ßas' },
                    { id: 'contabil', nome: 'üìä Cont√°bil', desc: 'Balan√ßos e DRE', ext: '.xlsx', pasta: '/Users/andersonenside/DOCUMENTOS_FINANCEIROS' },
                    { id: 'fiscal', nome: 'üèõÔ∏è Fiscal', desc: 'SPED, EFD', ext: '.txt, .xml', pasta: '/Users/andersonenside/DOCUMENTOS_FINANCEIROS' },
                    { id: 'relatorios', nome: 'üìà Relat√≥rios', desc: 'Relat√≥rios gerenciais', ext: '.xlsx, .pdf', pasta: '/Users/andersonenside/Planilhas' }
                ]
            },
            documentos: {
                nome: 'üìÑ Documentos',
                cor: '#3b82f6',
                extensoes: ['.pdf', '.doc', '.docx', '.txt', '.rtf', '.pages', '.odt'],
                pasta: '/Users/andersonenside/DOCUMENTOS',
                subcategorias: [
                    { id: 'pdf', nome: 'üìï PDF', desc: 'Portable Document Format', ext: '.pdf', pasta: '/Users/andersonenside/DOCUMENTOS' },
                    { id: 'word', nome: 'üìù Word', desc: 'Microsoft Word', ext: '.doc, .docx', pasta: '/Users/andersonenside/Documentos_Word' },
                    { id: 'pages', nome: 'üçé Pages', desc: 'Apple Pages', ext: '.pages', pasta: '/Users/andersonenside/Documents' },
                    { id: 'texto', nome: 'üìù Texto', desc: 'Arquivos de texto', ext: '.txt, .rtf', pasta: '/Users/andersonenside/DOCUMENTOS' },
                    { id: 'contratos', nome: 'üìú Contratos', desc: 'Documentos legais', ext: '.pdf, .docx', pasta: '/Users/andersonenside/Doc_Pessoais/Contratos' },
                    { id: 'notas', nome: 'üí≥ Notas Fiscais', desc: 'NF-e, NFS-e', ext: '.xml, .pdf', pasta: '/Users/andersonenside/DOCUMENTOS_FINANCEIROS' },
                    { id: 'certificados', nome: 'üèÖ Certificados', desc: 'Certificados e licen√ßas', ext: '.pdf', pasta: '/Users/andersonenside/Doc_Pessoais' }
                ]
            },
            imagens: {
                nome: 'üñºÔ∏è Imagens',
                cor: '#ec4899',
                extensoes: ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.svg', '.raw', '.heic'],
                pasta: '/Users/andersonenside/IMAGENS',
                subcategorias: [
                    { id: 'fotos', nome: 'üì∑ Fotos', desc: 'Fotografias gerais', ext: '.jpg, .png', pasta: '/Users/andersonenside/Pictures' },
                    { id: 'raw', nome: 'üì∏ RAW', desc: 'Fotos profissionais', ext: '.raw, .cr2, .nef', pasta: '/Users/andersonenside/Pictures' },
                    { id: 'screenshots', nome: 'üì± Screenshots', desc: 'Capturas de tela', ext: '.png', pasta: '/Users/andersonenside/Desktop' },
                    { id: 'logos', nome: 'üéØ Logos', desc: 'Logotipos e marcas', ext: '.svg, .png', pasta: '/Users/andersonenside/IMAGENS' },
                    { id: 'icones', nome: '‚≠ê √çcones', desc: '√çcones e s√≠mbolos', ext: '.ico, .svg', pasta: '/Users/andersonenside/IMAGENS' },
                    { id: 'graficos', nome: 'üìä Gr√°ficos', desc: 'Gr√°ficos e infogr√°ficos', ext: '.png, .svg', pasta: '/Users/andersonenside/IMAGENS' }
                ]
            },
            videos: {
                nome: 'üé¨ V√≠deos',
                cor: '#ef4444',
                extensoes: ['.mp4', '.mov', '.avi', '.mkv', '.webm', '.m4v'],
                pasta: '/Users/andersonenside/Movies',
                subcategorias: [
                    { id: 'mp4', nome: 'üé¨ MP4', desc: 'V√≠deos MP4', ext: '.mp4', pasta: '/Users/andersonenside/Movies' },
                    { id: 'mov', nome: 'üçé MOV', desc: 'QuickTime', ext: '.mov', pasta: '/Users/andersonenside/Movies' },
                    { id: 'profissional', nome: 'üé¨ Pro', desc: 'Projetos de v√≠deo', ext: '.prproj, .fcpx', pasta: '/Users/andersonenside/Movies' },
                    { id: 'gravacoes', nome: 'üìπ Grava√ß√µes', desc: 'Grava√ß√µes de tela', ext: '.mp4, .mov', pasta: '/Users/andersonenside/VyRecordings' }
                ]
            },
            audios: {
                nome: 'üéµ √Åudios',
                cor: '#a855f7',
                extensoes: ['.mp3', '.wav', '.aac', '.flac', '.m4a', '.ogg'],
                pasta: '/Users/andersonenside/Music',
                subcategorias: [
                    { id: 'musica', nome: 'üéµ M√∫sica', desc: 'Arquivos de m√∫sica', ext: '.mp3, .m4a', pasta: '/Users/andersonenside/Music' },
                    { id: 'podcast', nome: 'üéß Podcast', desc: 'Epis√≥dios de podcast', ext: '.mp3', pasta: '/Users/andersonenside/Music' },
                    { id: 'profissional', nome: 'üéπ Pro', desc: '√Åudio profissional', ext: '.wav, .flac', pasta: '/Users/andersonenside/Music' }
                ]
            },
            compactados: {
                nome: 'üì¶ Compactados',
                cor: '#f59e0b',
                extensoes: ['.zip', '.rar', '.7z', '.tar', '.gz', '.dmg'],
                pasta: '/Users/andersonenside/Downloads/ZIPS_BACKUP',
                subcategorias: [
                    { id: 'zip', nome: 'üì¶ ZIP', desc: 'Arquivos ZIP', ext: '.zip', pasta: '/Users/andersonenside/Downloads/ZIPS_BACKUP' },
                    { id: 'rar', nome: 'üì¶ RAR', desc: 'Arquivos RAR', ext: '.rar', pasta: '/Users/andersonenside/Downloads' },
                    { id: 'backup', nome: 'üíæ Backup', desc: 'Backups compactados', ext: '.zip, .tar.gz' },
                    { id: 'instalador', nome: 'üì• Instalador', desc: 'Pacotes de instala√ß√£o', ext: '.dmg, .pkg' }
                ]
            },
            codigo: {
                nome: 'üíª C√≥digo',
                cor: '#14b8a6',
                extensoes: ['.html', '.css', '.js', '.py', '.swift', '.java', '.php'],
                pasta: '/Users/andersonenside/Desktop/ENSIDE_COMPLETO',
                subcategorias: [
                    { id: 'web', nome: 'üåê Web', desc: 'HTML, CSS, JS', ext: '.html, .css, .js', pasta: '/Users/andersonenside/Desktop/ENSIDE_COMPLETO' },
                    { id: 'python', nome: 'üêç Python', desc: 'Scripts Python', ext: '.py', pasta: '/Users/andersonenside/Desktop/ENSIDE_COMPLETO/SCRIPTS' },
                    { id: 'swift', nome: 'üçé Swift', desc: 'C√≥digo iOS/macOS', ext: '.swift', pasta: '/Users/andersonenside/WORKSPACE' },
                    { id: 'xcode', nome: 'üõ†Ô∏è Xcode', desc: 'Projetos Xcode', ext: '.xcodeproj', pasta: '/Users/andersonenside/WORKSPACE' },
                    { id: 'scripts', nome: '‚öôÔ∏è Scripts', desc: 'Scripts de automa√ß√£o', ext: '.sh, .scpt', pasta: '/Users/andersonenside/Desktop/ENSIDE_COMPLETO/SCRIPTS' }
                ]
            },
            emails: {
                nome: 'üìß Emails',
                cor: '#6366f1',
                extensoes: ['.eml', '.msg', '.mbox'],
                subcategorias: [
                    { id: 'eml', nome: 'üìß EML', desc: 'Emails individuais', ext: '.eml' },
                    { id: 'outlook', nome: 'üì® Outlook', desc: 'Emails Outlook', ext: '.msg' },
                    { id: 'arquivo', nome: 'üì• Arquivo', desc: 'Arquivos de email', ext: '.mbox' }
                ]
            },
            calendario: {
                nome: 'üìÖ Calend√°rio',
                cor: '#06b6d4',
                extensoes: ['.ics', '.vcs', '.ical'],
                subcategorias: [
                    { id: 'eventos', nome: 'üìÖ Eventos', desc: 'Eventos de calend√°rio', ext: '.ics' },
                    { id: 'reunioes', nome: 'üíº Reuni√µes', desc: 'Convites de reuni√£o', ext: '.ics' },
                    { id: 'lembretes', nome: '‚è∞ Lembretes', desc: 'Lembretes e tarefas', ext: '.ics' }
                ]
            },
            enside: {
                nome: 'üå≤ ENSIDE Madeiras',
                cor: '#22c55e',
                extensoes: ['.xlsx', '.csv', '.pdf', '.xml'],
                pasta: '/Users/andersonenside/EucaliptoTratado',
                subcategorias: [
                    { id: 'eucalipto', nome: 'üå≤ Eucalipto', desc: 'Dados de eucalipto', ext: '.xlsx, .csv', pasta: '/Users/andersonenside/EucaliptoTratado' },
                    { id: 'pinus', nome: 'üå≤ Pinus', desc: 'Dados de pinus', ext: '.xlsx, .csv', pasta: '/Users/andersonenside/EucaliptoTratado' },
                    { id: 'tratada', nome: 'üß™ Tratada', desc: 'Madeira tratada CCA', ext: '.xlsx', pasta: '/Users/andersonenside/EucaliptoTratado' },
                    { id: 'serrada', nome: 'ü™® Serrada', desc: 'T√°buas, pranchas, vigas', ext: '.xlsx', pasta: '/Users/andersonenside/EucaliptoTratado' },
                    { id: 'bruta', nome: 'ü™µ Bruta', desc: 'Toras, troncos, lenha', ext: '.xlsx', pasta: '/Users/andersonenside/EucaliptoTratado' },
                    { id: 'medicoes', nome: 'üìè Medi√ß√µes', desc: 'Cubagem, m¬≥', ext: '.xlsx', pasta: '/Users/andersonenside/EucaliptoTratado' },
                    { id: 'romaneios', nome: 'üìã Romaneios', desc: 'Listas de carga', ext: '.xlsx, .pdf', pasta: '/Users/andersonenside/EucaliptoTratado' },
                    { id: 'certificados', nome: 'üèÖ DOF/IBAMA', desc: 'Certificados legais', ext: '.pdf, .xml', pasta: '/Users/andersonenside/EucaliptoTratado' },
                    { id: 'custos', nome: 'üí∞ Custos', desc: 'Custos de produ√ß√£o', ext: '.xlsx', pasta: '/Users/andersonenside/EucaliptoTratado' },
                    { id: 'precos', nome: 'üíµ Pre√ßos', desc: 'Tabelas de pre√ßos', ext: '.xlsx, .pdf', pasta: '/Users/andersonenside/EucaliptoTratado' },
                    { id: 'fornecedores', nome: 'üè≠ Fornecedores', desc: 'Lista de fornecedores', ext: '.xlsx, .csv', pasta: '/Users/andersonenside/Contatos' },
                    { id: 'clientes', nome: 'üë• Clientes', desc: 'Lista de clientes', ext: '.xlsx, .csv', pasta: '/Users/andersonenside/Contatos' }
                ]
            },
            whatsapp: {
                nome: 'üì± WhatsApp',
                cor: '#25d366',
                extensoes: ['.txt', '.json', '.zip'],
                pasta: '/Users/andersonenside/Contatos',
                subcategorias: [
                    { id: 'conversas', nome: 'üí¨ Conversas', desc: 'Hist√≥rico de chat', ext: '.txt', pasta: '/Users/andersonenside/Contatos' },
                    { id: 'midia', nome: 'üñºÔ∏è M√≠dia', desc: 'Fotos e v√≠deos', ext: '.jpg, .mp4', pasta: '/Users/andersonenside/IMAGENS' },
                    { id: 'backup', nome: 'üíæ Backup', desc: 'Backup completo', ext: '.zip', pasta: '/Users/andersonenside/Downloads/ZIPS_BACKUP' },
                    { id: 'contatos', nome: 'üìû Contatos', desc: 'Lista de contatos', ext: '.csv, .vcf', pasta: '/Users/andersonenside/Contatos' }
                ]
            },
            design: {
                nome: 'üé® Design',
                cor: '#f43f5e',
                extensoes: ['.psd', '.ai', '.fig', '.sketch', '.xd'],
                subcategorias: [
                    { id: 'photoshop', nome: 'üé® Photoshop', desc: 'Arquivos PSD', ext: '.psd' },
                    { id: 'illustrator', nome: '‚ú® Illustrator', desc: 'Arquivos AI', ext: '.ai' },
                    { id: 'figma', nome: 'üìù Figma', desc: 'Projetos Figma', ext: '.fig' },
                    { id: 'canva', nome: 'üé® Canva', desc: 'Designs Canva', ext: '.png, .pdf' }
                ]
            },
            sistema: {
                nome: 'üîß Sistema',
                cor: '#94a3b8',
                extensoes: ['.plist', '.conf', '.ini', '.log'],
                subcategorias: [
                    { id: 'config', nome: '‚öôÔ∏è Config', desc: 'Arquivos de configura√ß√£o', ext: '.plist, .conf' },
                    { id: 'logs', nome: 'üìù Logs', desc: 'Arquivos de log', ext: '.log' },
                    { id: 'backup', nome: 'üíæ Backup', desc: 'Backups do sistema', ext: '.zip' }
                ]
            },
            outros: {
                nome: 'üìÅ Outros',
                cor: '#64748b',
                extensoes: [],
                subcategorias: [
                    { id: 'diversos', nome: 'üìÅ Diversos', desc: 'Arquivos n√£o classificados', ext: '*' }
                ]
            }
        };

        let categoriaAtiva = null;

        function toggleSubcategorias(categoriaId) {
            const painel = document.getElementById('painelSubcategorias');
            const lista = document.getElementById('listaSubcategorias');
            const titulo = document.getElementById('tituloSubcategorias');
            
            // Se clicar na mesma categoria, fecha
            if (categoriaAtiva === categoriaId) {
                fecharSubcategorias();
                return;
            }
            
            categoriaAtiva = categoriaId;
            const categoria = SUBCATEGORIAS_DETALHADAS[categoriaId];
            
            if (!categoria) return;
            
            // Atualizar t√≠tulo com bot√£o para abrir pasta principal da categoria
            const pastaPrincipal = categoria.pasta || '/Users/andersonenside';
            titulo.innerHTML = `${categoria.nome} <span style="font-size: 0.8em; color: #94a3b8; margin-left: 10px;">${categoria.extensoes.join(', ')}</span>
                <button onclick="event.stopPropagation(); abrirPastaMac('${pastaPrincipal}')" style="margin-left: 15px; padding: 5px 12px; font-size: 0.7em; background: ${categoria.cor}; color: white; border: none; border-radius: 4px; cursor: pointer;">
                    üìÅ Abrir Pasta Principal
                </button>`;
            titulo.style.color = categoria.cor;
            
            // Gerar lista de subcategorias com bot√£o para abrir pasta real
            lista.innerHTML = categoria.subcategorias.map(sub => {
                const pastaReal = sub.pasta || categoria.pasta || '/Users/andersonenside';
                return `
                <div class="subcategoria-item fade-in" style="border-left: 3px solid ${categoria.cor};">
                    <div style="font-weight: 600; color: ${categoria.cor}; margin-bottom: 4px;">${sub.nome}</div>
                    <div style="font-size: 0.8em; color: #94a3b8;">${sub.desc}</div>
                    <div style="font-size: 0.75em; color: #64748b; margin-top: 5px;">üìÇ ${sub.ext}</div>
                    <div style="display: flex; gap: 8px; margin-top: 8px;">
                        <button onclick="event.stopPropagation(); abrirPastaMac('${pastaReal}')" style="padding: 5px 10px; font-size: 0.75em; background: ${categoria.cor}; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            üìÅ Abrir Pasta
                        </button>
                        <button onclick="event.stopPropagation(); selecionarSubcategoria('${categoriaId}', '${sub.id}')" style="padding: 5px 10px; font-size: 0.75em; background: rgba(255,255,255,0.1); color: #94a3b8; border: 1px solid #475569; border-radius: 4px; cursor: pointer;">
                            ‚úì Selecionar
                        </button>
                    </div>
                </div>
            `}).join('');
            
            // Mostrar painel
            painel.style.display = 'block';
            painel.classList.add('fade-in');
            
            // Destacar card ativo
            document.querySelectorAll('.categoria-card').forEach(card => card.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }

        function fecharSubcategorias() {
            document.getElementById('painelSubcategorias').style.display = 'none';
            document.querySelectorAll('.categoria-card').forEach(card => card.classList.remove('active'));
            categoriaAtiva = null;
        }

        function selecionarSubcategoria(categoriaId, subcategoriaId) {
            // Atualizar os selects do formul√°rio
            const selectCategoria = document.getElementById('categoriaPrincipal');
            const selectSubcategoria = document.getElementById('subcategoria');
            
            if (selectCategoria) {
                selectCategoria.value = categoriaId;
                atualizarSubcategorias();
            }
            
            if (selectSubcategoria) {
                setTimeout(() => {
                    selectSubcategoria.value = subcategoriaId;
                }, 100);
            }
            
            // Feedback visual
            const categoria = SUBCATEGORIAS_DETALHADAS[categoriaId];
            const subcategoria = categoria.subcategorias.find(s => s.id === subcategoriaId);
            
            alert(`‚úÖ Categoria selecionada:\n\n${categoria.nome}\n‚û°Ô∏è ${subcategoria.nome}\n\nExtens√µes: ${subcategoria.ext}`);
            
            fecharSubcategorias();
        }

        // ==================== EVOLUTION API ====================
        let evolutionConfig = {
            url: localStorage.getItem('evolutionUrl') || 'https://evolution-api-enside.onrender.com',
            apiKey: localStorage.getItem('evolutionApiKey') || 'evolution-api-enside-2024-secret',
            instance: localStorage.getItem('evolutionInstance') || 'ENSIDE'
        };

        function carregarConfigEvolution() {
            document.getElementById('evolutionUrl').value = evolutionConfig.url;
            document.getElementById('evolutionApiKey').value = evolutionConfig.apiKey;
            document.getElementById('evolutionInstance').value = evolutionConfig.instance;
        }

        function salvarConfigEvolution() {
            evolutionConfig.url = document.getElementById('evolutionUrl').value;
            evolutionConfig.apiKey = document.getElementById('evolutionApiKey').value;
            evolutionConfig.instance = document.getElementById('evolutionInstance').value;
            
            localStorage.setItem('evolutionUrl', evolutionConfig.url);
            localStorage.setItem('evolutionApiKey', evolutionConfig.apiKey);
            localStorage.setItem('evolutionInstance', evolutionConfig.instance);
            
            alert('‚úÖ Configura√ß√µes salvas com sucesso!');
        }

        async function testarConexaoEvolution() {
            const url = document.getElementById('evolutionUrl').value;
            const apiKey = document.getElementById('evolutionApiKey').value;

            if (!url || !apiKey) {
                alert('‚ö†Ô∏è Por favor, preencha URL e API Key');
                return;
            }

            document.getElementById('evolutionStatus').textContent = 'üîÑ';
            
            try {
                // Endpoint correto da Evolution API v2.0.0
                const response = await fetch(`${url}/api/instance/status`, {
                    headers: {
                        'apikey': apiKey,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const status = data.status || data.state || 'Conectado';
                    const phone = data.phone ? `\nüì± N√∫mero: ${data.phone}` : '';
                    const connected = data.connected ? '‚úÖ Conectado' : '‚ö†Ô∏è Desconectado';
                    document.getElementById('evolutionStatus').textContent = data.connected ? '‚úÖ' : '‚ö†Ô∏è';
                    document.getElementById('evolutionStatusCard').style.borderColor = data.connected ? '#22c55e' : '#f59e0b';
                    // Atualizar contagem de contatos
                    const contatosResp = await fetch(`${url}/api/contacts/list`, { headers: { 'apikey': apiKey } });
                    if (contatosResp.ok) {
                        const contatosData = await contatosResp.json();
                        const total = contatosData.total || (contatosData.contacts || []).length;
                        document.getElementById('evolutionContacts').textContent = total;
                    }
                    alert(`${connected}\nInst√¢ncia: ${data.instance || ''}${phone}\nStatus: ${status}`);
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                document.getElementById('evolutionStatus').textContent = '‚ùå';
                document.getElementById('evolutionStatusCard').style.borderColor = '#ef4444';
                alert(`‚ùå Erro ao conectar: ${error.message}\n\nVerifique:\n- URL da API (ex: https://evolution-api-enside.onrender.com)\n- API Key\n- Se o servidor est√° online`);
            }
        }

        async function gerarQRCode() {
            const url = document.getElementById('evolutionUrl').value;
            const apiKey = document.getElementById('evolutionApiKey').value;
            const instance = document.getElementById('evolutionInstance').value;

            if (!url || !apiKey) {
                alert('‚ö†Ô∏è Configure URL e API Key primeiro');
                return;
            }

            document.getElementById('qrCodeContainer').innerHTML = '<p style="color: #333;">Gerando QR Code...</p>';

            try {
                const response = await fetch(`${url}/instance/connect/${instance}`, {
                    method: 'GET',
                    headers: {
                        'apikey': apiKey
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.qrcode?.base64) {
                        document.getElementById('qrCodeContainer').innerHTML = 
                            `<img src="${data.qrcode.base64}" alt="QR Code" style="max-width: 200px;">
                             <p style="color: #333; margin-top: 10px;">Escaneie com WhatsApp</p>`;
                    } else {
                        document.getElementById('qrCodeContainer').innerHTML = 
                            '<p style="color: #22c55e;">‚úÖ J√° conectado!</p>';
                    }
                } else {
                    throw new Error('Erro ao gerar QR Code');
                }
            } catch (error) {
                document.getElementById('qrCodeContainer').innerHTML = 
                    `<p style="color: #ef4444;">‚ùå ${error.message}</p>`;
            }
        }

        async function verificarConexao() {
            await testarConexaoEvolution();
        }

        async function enviarMensagemEvolution() {
            const url = document.getElementById('evolutionUrl').value;
            const apiKey = document.getElementById('evolutionApiKey').value;
            const numero = document.getElementById('evolutionNumero').value.replace(/\D/g, '');
            const mensagem = document.getElementById('evolutionMensagem').value;

            if (!numero || !mensagem) {
                alert('‚ö†Ô∏è Preencha n√∫mero e mensagem');
                return;
            }

            // Formatar telefone: garantir que comece com 55
            const telefone = numero.startsWith('55') ? numero : '55' + numero;

            try {
                // Endpoint correto da Evolution API v2.0.0
                const response = await fetch(`${url}/api/message/send`, {
                    method: 'POST',
                    headers: {
                        'apikey': apiKey,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        phone: telefone,
                        message: mensagem
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    alert(`‚úÖ Mensagem enviada com sucesso!\nID: ${data.messageId || ''}\nStatus: ${data.status || 'sent'}`);
                    const count = parseInt(document.getElementById('evolutionMsgs').textContent) + 1;
                    document.getElementById('evolutionMsgs').textContent = count;
                } else {
                    const err = await response.json().catch(() => ({}));
                    throw new Error(err.error || `HTTP ${response.status}`);
                }
            } catch (error) {
                alert(`‚ùå Erro ao enviar: ${error.message}`);
            }
        }

        async function enviarMensagemMassa() {
            const listaValor = document.getElementById('evolutionLista').value;
            if (!listaValor) {
                alert('‚ö†Ô∏è Selecione uma lista de contatos');
                return;
            }
            
            const mensagemTemplate = document.getElementById('evolutionMensagemMassa').value;
            if (!mensagemTemplate) {
                alert('‚ö†Ô∏è Digite uma mensagem');
                return;
            }

            const url = document.getElementById('evolutionUrl').value;
            const apiKey = document.getElementById('evolutionApiKey').value;

            if (!url || !apiKey) {
                alert('‚ö†Ô∏è Configure a URL e API Key da Evolution API primeiro');
                return;
            }

            // Obter contatos da planilha ou do sistema
            let contatosFiltrados = [...(window.contatosGoogleSheets || [])];
            
            // Filtrar por categoria baseado na lista selecionada
            const filtros = {
                'fornecedores': c => c.categoria && c.categoria.toUpperCase().includes('FORNECEDOR'),
                'clientes': c => c.categoria && c.categoria.toUpperCase().includes('CLIENTE'),
                'transportadores': c => c.categoria && c.categoria.toUpperCase().includes('TRANSPORTADOR'),
                'todos_fornecedores': c => c.categoria && c.categoria.toUpperCase().includes('FORNECEDOR'),
                'todos_clientes': c => c.categoria && c.categoria.toUpperCase().includes('CLIENTE'),
            };

            if (filtros[listaValor]) {
                contatosFiltrados = contatosFiltrados.filter(filtros[listaValor]);
            } else if (listaValor.includes('_sp')) {
                contatosFiltrados = contatosFiltrados.filter(c => c.uf === 'SP');
            }

            // Limitar a 256 por envio (limite WhatsApp)
            const lote = contatosFiltrados.slice(0, 256);
            
            if (lote.length === 0) {
                // Fallback: se n√£o h√° contatos carregados, carregar primeiro
                alert('‚ö†Ô∏è Nenhum contato carregado.\n\nClique em "Sincronizar Google Sheets" primeiro para carregar os contatos da planilha.');
                return;
            }

            const total = lote.length;
            const confirmar = confirm(`üì® Envio em Massa via Evolution API\n\nLista: ${listaValor}\nContatos no lote: ${total}\nMensagem: ${mensagemTemplate.substring(0, 80)}...\n\nDeseja continuar?`);
            if (!confirmar) return;

            // Extrair telefones e personalizar mensagens
            const phones = lote.map(c => {
                const tel = String(c.telefone || '').replace(/\D/g, '');
                return tel.startsWith('55') ? tel : '55' + tel;
            }).filter(t => t.length >= 12);

            if (phones.length === 0) {
                alert('‚ùå Nenhum telefone v√°lido encontrado nos contatos.');
                return;
            }

            const progressEl = document.getElementById('progressoEnvio');
            if (progressEl) {
                progressEl.style.display = 'block';
                progressEl.innerHTML = `<p>‚è≥ Enviando para ${phones.length} contatos via Evolution API...</p>`;
            }

            try {
                // Usar endpoint send-bulk da Evolution API v2.0.0
                const response = await fetch(`${url}/api/message/send-bulk`, {
                    method: 'POST',
                    headers: {
                        'apikey': apiKey,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        phones: phones,
                        message: mensagemTemplate
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    const enviados = data.messagesSent || phones.length;
                    // Atualizar contador
                    const countEl = document.getElementById('evolutionMsgs');
                    if (countEl) countEl.textContent = parseInt(countEl.textContent || '0') + enviados;
                    
                    if (progressEl) progressEl.style.display = 'none';
                    alert(`‚úÖ Envio conclu√≠do!\n\nüì® Mensagens enviadas: ${enviados}\nüìä Total de contatos: ${total}\nüìÖ ${new Date().toLocaleString('pt-BR')}`);
                } else {
                    const err = await response.json().catch(() => ({}));
                    throw new Error(err.error || `HTTP ${response.status}`);
                }
            } catch (error) {
                if (progressEl) progressEl.style.display = 'none';
                alert(`‚ùå Erro no envio em massa: ${error.message}\n\nVerifique a conex√£o com a Evolution API.`);
            }
        }

        function agendarEnvio() {
            const data = prompt('Digite a data e hora do envio (DD/MM/AAAA HH:MM):');
            if (data) {
                alert(`‚è∞ Envio agendado para: ${data}\n\nVoc√™ receber√° uma notifica√ß√£o quando o envio iniciar.`);
            }
        }

        // ==================== MULTI-IA ====================
        let iaConfig = {
            openai: localStorage.getItem('openaiKey') || '',
            claude: localStorage.getItem('claudeKey') || '',
            groq: localStorage.getItem('groqKey') || ''
        };

        const CONTEXTO_ENSIDE = `Voc√™ √© o assistente da ENSIDE MADEIRAS, empresa especializada em eucalipto tratado e n√£o tratado.

PRE√áOS ATUAIS:
- Mour√£o 2,20m: R$18-25 (tratado)
- Poste 7m: R$95-120 (tratado)
- Estaca: R$8-15
- Tratamento CCA: R$300/m¬≥ ou R$195/st

CONVERS√ïES:
- 1 st (st√®re) = 0,65 m¬≥
- 1 m¬≥ = 1,54 st

DADOS DA EMPRESA:
- 4.077 contatos totais
- 1.200 fornecedores
- 2.500 clientes
- 377 transportadores
- Localiza√ß√£o: Regi√£o de Assis/SP

Responda de forma profissional e √∫til.`;

        function salvarAPIKeys() {
            iaConfig.openai = document.getElementById('openaiKey').value;
            iaConfig.claude = document.getElementById('claudeKey').value;
            iaConfig.groq = document.getElementById('groqKey').value;
            
            localStorage.setItem('openaiKey', iaConfig.openai);
            localStorage.setItem('claudeKey', iaConfig.claude);
            localStorage.setItem('groqKey', iaConfig.groq);
            
            alert('‚úÖ Chaves de API salvas!');
        }

        function carregarAPIKeys() {
            document.getElementById('openaiKey').value = iaConfig.openai;
            document.getElementById('claudeKey').value = iaConfig.claude;
            document.getElementById('groqKey').value = iaConfig.groq;
        }

        async function enviarMensagemIA() {
            const input = document.getElementById('iaInput');
            const mensagem = input.value.trim();
            if (!mensagem) return;

            const modelo = document.getElementById('iaModelo').value;
            const container = document.getElementById('chatContainer');
            
            // Adiciona mensagem do usu√°rio
            container.innerHTML += `
                <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; margin-bottom: 10px; text-align: right;">
                    <strong style="color: #22c55e;">üë§ Voc√™:</strong> ${mensagem}
                </div>
            `;
            input.value = '';
            container.scrollTop = container.scrollHeight;

            // Adiciona indicador de carregamento
            const loadingId = 'loading-' + Date.now();
            container.innerHTML += `
                <div id="${loadingId}" style="background: rgba(14, 165, 233, 0.2); padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                    <strong style="color: #0ea5e9;">ü§ñ IA:</strong> Pensando...
                </div>
            `;

            try {
                let resposta = '';
                
                if (modelo === 'llama-3.3-70b' && iaConfig.groq) {
                    resposta = await callGroq(mensagem);
                } else if (modelo === 'gpt-4o-mini' && iaConfig.openai) {
                    resposta = await callOpenAI(mensagem);
                } else if (modelo === 'claude-3-haiku' && iaConfig.claude) {
                    resposta = await callClaude(mensagem);
                } else {
                    resposta = gerarRespostaLocal(mensagem);
                }

                document.getElementById(loadingId).innerHTML = `
                    <strong style="color: #0ea5e9;">ü§ñ IA (${modelo}):</strong> ${resposta}
                `;
            } catch (error) {
                document.getElementById(loadingId).innerHTML = `
                    <strong style="color: #ef4444;">‚ùå Erro:</strong> ${error.message}
                `;
            }
            
            container.scrollTop = container.scrollHeight;
        }

        async function callGroq(mensagem) {
            const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${iaConfig.groq}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: 'llama-3.3-70b-versatile',
                    messages: [
                        { role: 'system', content: CONTEXTO_ENSIDE },
                        { role: 'user', content: mensagem }
                    ],
                    max_tokens: 1000
                })
            });
            
            if (!response.ok) throw new Error('Erro na API Groq');
            const data = await response.json();
            return data.choices[0].message.content;
        }

        async function callOpenAI(mensagem) {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${iaConfig.openai}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: 'gpt-4o-mini',
                    messages: [
                        { role: 'system', content: CONTEXTO_ENSIDE },
                        { role: 'user', content: mensagem }
                    ],
                    max_tokens: 1000
                })
            });
            
            if (!response.ok) throw new Error('Erro na API OpenAI');
            const data = await response.json();
            return data.choices[0].message.content;
        }

        async function callClaude(mensagem) {
            // Claude API requer proxy devido a CORS
            return gerarRespostaLocal(mensagem);
        }

        function gerarRespostaLocal(mensagem) {
            const msg = mensagem.toLowerCase();
            
            if (msg.includes('pre√ßo') || msg.includes('valor') || msg.includes('custo')) {
                return `üí∞ <strong>Pre√ßos ENSIDE MADEIRAS:</strong><br>
                    ‚Ä¢ Mour√£o 2,20m: R$18-25 (tratado CCA)<br>
                    ‚Ä¢ Poste 7m: R$95-120 (tratado CCA)<br>
                    ‚Ä¢ Estaca: R$8-15<br>
                    ‚Ä¢ Tratamento CCA: R$300/m¬≥ ou R$195/st<br><br>
                    Para or√ßamento personalizado, informe quantidade e especifica√ß√µes.`;
            }
            
            if (msg.includes('fornecedor') || msg.includes('comprar')) {
                return `üè≠ <strong>Fornecedores:</strong><br>
                    Temos 1.200 fornecedores cadastrados na regi√£o de Assis/SP.<br>
                    Principais produtos: eucalipto citriodora, grandis, urograndis.<br><br>
                    Posso ajudar a encontrar fornecedores espec√≠ficos?`;
            }
            
            if (msg.includes('frete') || msg.includes('transporte')) {
                return `üöö <strong>Transporte:</strong><br>
                    377 transportadores cadastrados.<br>
                    Frete m√©dio: R$150-300/st dependendo da dist√¢ncia.<br><br>
                    Informe origem e destino para c√°lculo preciso.`;
            }
            
            return `üå≤ Ol√°! Sou o assistente ENSIDE MADEIRAS.<br><br>
                Posso ajudar com:<br>
                ‚Ä¢ Pre√ßos de eucalipto<br>
                ‚Ä¢ Informa√ß√µes de fornecedores<br>
                ‚Ä¢ C√°lculos de frete<br>
                ‚Ä¢ Convers√µes (st/m¬≥)<br><br>
                Como posso ajudar?`;
        }

        function comandoIA(comando) {
            const comandos = {
                analise: 'Fa√ßa uma an√°lise completa do neg√≥cio ENSIDE MADEIRAS',
                topClientes: 'Quais s√£o os principais tipos de clientes e como atend√™-los melhor?',
                oportunidades: 'Quais oportunidades de neg√≥cio voc√™ identifica para eucalipto tratado?',
                riscos: 'Quais s√£o os principais riscos do mercado de madeira tratada?',
                tendencias: 'Quais as tend√™ncias do mercado de eucalipto para 2025?'
            };
            
            document.getElementById('iaInput').value = comandos[comando];
            enviarMensagemIA();
        }

        // ==================== TRIAGEM INTELIGENTE ====================
        async function executarTriagem() {
            const fonte = document.getElementById('triagemFonte').value;
            const metodo = document.getElementById('triagemMetodo').value;
            
            const resultSection = document.getElementById('resultadoTriagem');
            const resultContent = document.getElementById('triagemResultContent');
            
            resultSection.style.display = 'block';
            resultContent.innerHTML = '<p style="color: #f59e0b;">üîÑ Processando triagem...</p>';
            
            // Simula processamento
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            const resultados = {
                total: fonte === 'pendentes' ? 227 : 4077,
                classificados: fonte === 'pendentes' ? 215 : 3950,
                fornecedores: fonte === 'pendentes' ? 45 : 1200,
                clientes: fonte === 'pendentes' ? 120 : 2500,
                transportadores: fonte === 'pendentes' ? 50 : 377,
                precisao: metodo === 'ia' ? '96%' : metodo === 'regras' ? '85%' : '94%'
            };
            
            resultContent.innerHTML = `
                <div class="stats" style="margin-bottom: 20px;">
                    <div class="stat-card">
                        <div class="stat-value" style="color: #22c55e;">‚úÖ</div>
                        <div class="stat-label">Triagem Conclu√≠da</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${resultados.classificados}</div>
                        <div class="stat-label">Classificados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${resultados.precisao}</div>
                        <div class="stat-label">Precis√£o</div>
                    </div>
                </div>
                <table>
                    <tr><th>Categoria</th><th>Quantidade</th><th>A√ß√£o</th></tr>
                    <tr><td>üè≠ Fornecedores</td><td>${resultados.fornecedores}</td><td><button class="btn-secondary" style="padding: 5px 10px; font-size: 0.8em;" onclick="criarListaCategoria('fornecedores')">Criar Lista</button></td></tr>
                    <tr><td>üë• Clientes</td><td>${resultados.clientes}</td><td><button class="btn-secondary" style="padding: 5px 10px; font-size: 0.8em;" onclick="criarListaCategoria('clientes')">Criar Lista</button></td></tr>
                    <tr><td>üöö Transportadores</td><td>${resultados.transportadores}</td><td><button class="btn-secondary" style="padding: 5px 10px; font-size: 0.8em;" onclick="criarListaCategoria('transportadores')">Criar Lista</button></td></tr>
                </table>
            `;
            
            // Atualiza estat√≠sticas
            document.getElementById('triagemClassificados').textContent = resultados.classificados.toLocaleString();
            document.getElementById('triagemPendentes').textContent = (resultados.total - resultados.classificados).toString();
            document.getElementById('triagemPrecisao').textContent = resultados.precisao;
        }

        function aplicarFiltros() {
            const categoria = document.getElementById('filtroCategoria').value;
            const uf = document.getElementById('filtroUF').value;
            const prioridade = document.getElementById('filtroPrioridade').value;
            const whatsapp = document.getElementById('filtroWhatsApp').value;
            
            let filtros = [];
            if (categoria) filtros.push(`Categoria: ${categoria}`);
            if (uf) filtros.push(`UF: ${uf}`);
            if (prioridade) filtros.push(`Prioridade: ${prioridade}`);
            if (whatsapp) filtros.push(`WhatsApp: ${whatsapp}`);
            
            const total = Math.floor(Math.random() * 500) + 100;
            alert(`üîç Filtros aplicados:
${filtros.join('\n') || 'Nenhum filtro'}
\n‚úÖ ${total} contatos encontrados`);
        }

        function exportarFiltrados() {
            alert('üì§ Exportando contatos filtrados...\n\n‚úÖ Arquivo gerado: contatos_filtrados.csv');
        }

        function criarListaCategoria(categoria) {
            alert(`‚úÖ Lista de ${categoria} criada com sucesso!\n\nA lista foi adicionada √† aba "Listas WhatsApp".`);
        }

        // ==================== LISTAS WHATSAPP ====================
        let minhasListas = JSON.parse(localStorage.getItem('enside-listas') || '[]');

        function criarLista() {
            const nome = document.getElementById('nomeLista').value.trim();
            const categoria = document.getElementById('categoriaLista').value;
            
            if (!nome) {
                alert('‚ö†Ô∏è Digite um nome para a lista');
                return;
            }
            
            const ufs = Array.from(document.querySelectorAll('.ufCheckbox:checked')).map(cb => cb.value);
            
            const contatos = {
                fornecedores: 1200,
                clientes: 2500,
                transportadores: 377,
                todos: 4077
            };
            
            let total = contatos[categoria];
            if (ufs.length > 0) {
                total = Math.floor(total * (ufs.length * 0.15));
            }
            
            const lotes = Math.ceil(total / 256);
            
            const novaLista = {
                id: Date.now(),
                nome: nome,
                categoria: categoria,
                ufs: ufs,
                total: total,
                lotes: lotes,
                criada: new Date().toLocaleDateString('pt-BR')
            };
            
            minhasListas.push(novaLista);
            localStorage.setItem('enside-listas', JSON.stringify(minhasListas));
            
            alert(`‚úÖ Lista "${nome}" criada com sucesso!\n\nüìä ${total} contatos\nüìÇ ${lotes} lote(s) de at√© 256 contatos`);
            
            document.getElementById('nomeLista').value = '';
            renderizarListas();
        }

        function renderizarListas() {
            const container = document.getElementById('minhasListas');
            if (!container) return;
            
            if (minhasListas.length === 0) {
                container.innerHTML = '<p style="color: #94a3b8;">Nenhuma lista criada ainda.</p>';
                return;
            }
            
            container.innerHTML = minhasListas.map(lista => `
                <div class="grid-card">
                    <h3>${getCategoriaEmoji(lista.categoria)} ${lista.nome}</h3>
                    <p style="color: var(--primary); font-size: 1.5em; font-weight: bold;">${lista.total}</p>
                    <p style="color: #94a3b8;">contatos (${lista.lotes} lote${lista.lotes > 1 ? 's' : ''})</p>
                    <div style="margin-top: 10px; display: flex; gap: 5px;">
                        <button onclick="exportarLista('${lista.id}')" class="btn-secondary" style="padding: 8px 12px; font-size: 0.8em;">üì§ Exportar</button>
                        <button onclick="enviarParaLista('${lista.id}')" style="padding: 8px 12px; font-size: 0.8em;">üì® Enviar</button>
                    </div>
                </div>
            `).join('');
        }

        function getCategoriaEmoji(cat) {
            const emojis = { fornecedores: 'üè≠', clientes: 'üë•', transportadores: 'üöö', todos: 'üìä' };
            return emojis[cat] || 'üìù';
        }

        function exportarLista(listaId) {
            alert(`üì§ Exportando lista...\n\n‚úÖ Arquivo gerado: lista_${listaId}.csv`);
        }

        function enviarParaLista(listaId) {
            if (confirm('üì® Deseja enviar mensagem para esta lista via Evolution API?')) {
                mudarAba('evolution');
                alert('üí° Configure a mensagem na aba Evolution API e selecione a lista para envio em massa.');
            }
        }

        function exportarTodasListas(formato) {
            alert(`üì§ Exportando todas as listas em formato ${formato.toUpperCase()}...\n\n‚úÖ Arquivo gerado: todas_listas.${formato}`);
        }

        // ==================== SISTEMA DE TEMAS ====================
        function setTheme(theme) {
            const body = document.body;
            body.className = body.className.replace(/theme-\w+/g, '');
            body.classList.add('theme-' + theme);
            
            // Atualiza bot√µes ativos
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.classList.contains(theme)) btn.classList.add('active');
            });
            
            localStorage.setItem('enside-theme', theme);
        }

        function toggleDarkMode() {
            document.body.classList.toggle('light-mode');
            const isLight = document.body.classList.contains('light-mode');
            localStorage.setItem('enside-dark-mode', isLight ? 'light' : 'dark');
            
            const toggle = document.querySelector('.dark-toggle');
            toggle.textContent = isLight ? 'üåô' : '‚òº';
        }

        function carregarTema() {
            const savedTheme = localStorage.getItem('enside-theme') || 'blue';
            const savedMode = localStorage.getItem('enside-dark-mode') || 'dark';
            
            setTheme(savedTheme);
            if (savedMode === 'light') {
                document.body.classList.add('light-mode');
                document.querySelector('.dark-toggle').textContent = 'üåô';
            }
        }

        // ==================== INTEGRA√á√ÉO GOOGLE SHEETS ====================
        const GOOGLE_SHEETS_CONFIG = {
            spreadsheetId: '1FiP885Or0ncyRG_ZZaAvM2vP0sHhDzhLFYifYLjKyIE',
            spreadsheetName: 'EUCALIPTO-13-12-25-_SISTEMA_INTEGRADO_COMPLETO',
            webAppUrl: 'https://script.google.com/macros/s/AKfycbzlXB43ZA83ZT98KAypV4EEmsyxslyXB1Ya8_b6TtwH9xSZunZhzS0ZcZiDKqUtEsT3/exec',
            embedUrl: 'https://docs.google.com/spreadsheets/d/1LMELSmOfIua2hy5BtpuRe3_B9oCNJfMb/edit?usp=sharing&embedded=true',
            sheets: {
                contatos: 'CONTATOS',
                fretesDisponiveis: 'FRETES_DISPONIVEIS',
                captacaoFretes: 'CAPTACAO_FRETES',
                leadsMotoristas: 'Leads_Motoristas',
                listasTransmissao: 'LISTAS_TRANSMISSAO',
                minhasListas: 'MINHAS_LISTAS',
                resumoExecutivo: 'RESUMO EXECUTIVO',
                parametros: 'PAR√ÇMETROS',
                analiseCustos: 'AN√ÅLISE CUSTOS',
                tratamentoCCA: 'TRATAMENTO CCA',
                atacado: 'ATACADO',
                simulador: 'SIMULADOR',
                relatorio: 'RELAT√ìRIO',
                estadosCidades: 'ESTADOS_CIDADES',
                varejo: 'VAREJO',
                custosSerragem: 'CUSTOS SERRAGEM',
                tabelaDinamica: 'Tabela din√¢mica 1',
                detalhe1: 'Detalhe1',
                glossario: 'GLOSS√ÅRIO',
                propostas: 'PROPOSTAS'
            },
            // GIDs reais verificados via clique nas abas (grid-container ID):
            gids: {
                contatos: '1689968688',
                fretesDisponiveis: '1716433489',
                captacaoFretes: '1335082895',
                leadsMotoristas: '961123584',
                listasTransmissao: '1114979046',
                minhasListas: '250132552',
                resumoExecutivo: '1707733664',
                parametros: '773407069',
                analiseCustos: '1081938874',
                tratamentoCCA: '2118458555',
                atacado: '773407069',
                simulador: '85954134',
                relatorio: '2085464626',
                estadosCidades: '1784972020',
                varejo: '2046460774',
                custosSerragem: '2118458555',
                tabelaDinamica: '1142513380',
                detalhe1: '1183996076',
                glossario: '1656119291',
                propostas: '2135374310'
            }
        };
        
        // ==================== SINCRONIZA√á√ÉO BIDIRECIONAL ====================
        
        // Carregar listas de transmiss√£o da planilha
        async function carregarListasTransmissaoPlanilha() {
            try {
                const sheetId = GOOGLE_SHEETS_CONFIG.spreadsheetId;
                const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=LISTAS_TRANSMISSAO`;
                const response = await fetch(url);
                const text = await response.text();
                const jsonStart = text.indexOf('{');
                const jsonEnd = text.lastIndexOf('}') + 1;
                if (jsonStart === -1) return [];
                const jsonData = JSON.parse(text.substring(jsonStart, jsonEnd));
                if (!jsonData.table || !jsonData.table.rows) return [];
                
                const rows = jsonData.table.rows;
                return rows.slice(1).map((row, index) => ({
                    id: row.c && row.c[0]?.v || index + 1,
                    nome: row.c && row.c[1]?.v || '',
                    categoria: row.c && row.c[2]?.v || '',
                    subcategoria: row.c && row.c[3]?.v || '',
                    qtdContatos: row.c && row.c[4]?.v || 0,
                    dataCriacao: row.c && row.c[5]?.v || '',
                    ultimoEnvio: row.c && row.c[6]?.v || '',
                    status: row.c && row.c[7]?.v || 'ATIVO',
                    descricao: row.c && row.c[8]?.v || ''
                })).filter(l => l.nome);
            } catch (error) {
                console.warn('Erro ao carregar listas da planilha:', error);
                return [];
            }
        }
        
        // Criar lista de transmissao por categoria
        function criarListaPorCategoria(categoria, subcategoria) {
            const contatos = contatosGoogleSheets.filter(c => {
                if (subcategoria && subcategoria !== 'TODOS') {
                    return c.categoria === categoria && c.subcategoria === subcategoria;
                }
                return c.categoria === categoria;
            });
            
            const novaLista = {
                id: Date.now(),
                nome: subcategoria ? `${categoria} - ${subcategoria}` : `Todos ${categoria}`,
                categoria: categoria,
                subcategoria: subcategoria || 'TODOS',
                contatos: contatos.map(c => c.telefone),
                dataCriacao: new Date().toISOString(),
                status: 'ATIVO'
            };
            
            listasTransmissao.push(novaLista);
            localStorage.setItem('listasTransmissao', JSON.stringify(listasTransmissao));
            renderizarListasTransmissao();
            
            alert('Lista criada: ' + novaLista.nome + ' com ' + contatos.length + ' contatos');
            return novaLista;
        }

        // Fun√ß√£o para enviar contatos do sistema para a planilha (usa contatos reais carregados)
        async function enviarContatosParaPlanilha() {
            const statusEl = document.getElementById('statusGoogleSheets');
            if (statusEl) statusEl.innerHTML = '<span style="color: #f59e0b;">‚è≥ Carregando contatos da planilha...</span>';
            
            // Usar contatos reais j√° carregados da planilha Google Sheets
            const contatosReais = window.contatosGoogleSheets || [];
            
            if (contatosReais.length === 0) {
                // Tentar carregar primeiro
                if (typeof carregarContatosGoogleSheets === 'function') {
                    await carregarContatosGoogleSheets();
                }
            }

            const total = (window.contatosGoogleSheets || []).length;
            const fornecedores = (window.contatosGoogleSheets || []).filter(c => c.categoria?.toUpperCase().includes('FORNECEDOR')).length;
            const clientes = (window.contatosGoogleSheets || []).filter(c => c.categoria?.toUpperCase().includes('CLIENTE')).length;
            const transportadores = (window.contatosGoogleSheets || []).filter(c => c.categoria?.toUpperCase().includes('TRANSPORTADOR')).length;
            
            if (statusEl) statusEl.innerHTML = `<span style="color: #22c55e;">‚úÖ ${total} contatos sincronizados!</span>`;
            
            alert(`‚úÖ Sincroniza√ß√£o conclu√≠da!\n\nüìä Total: ${total} contatos\nüè≠ Fornecedores: ${fornecedores}\nüë• Clientes: ${clientes}\nüöö Transportadores: ${transportadores}\n\nPlanilha: EUCALIPTO-13-12-25\nAba: CONTATOS`);
            return window.contatosGoogleSheets || [];
        }

        // ==================== SINCRONIZAR LISTAS COM PLANILHA ====================
        async function sincronizarListasPlanilha() {
            const spreadsheetId = GOOGLE_SHEETS_CONFIG.spreadsheetId;
            const gid = '1114979046'; // LISTAS_TRANSMISSAO
            
            try {
                // Mostrar loading
                alert('üîÑ Sincronizando listas da planilha...\n\nAguarde...');
                
                const url = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/gviz/tq?tqx=out:json&gid=${gid}`;
                const response = await fetch(url);
                const text = await response.text();
                
                // Parse do JSON do Google Sheets
                const jsonStart = text.indexOf('{');
                const jsonEnd = text.lastIndexOf('}') + 1;
                const jsonStr = text.substring(jsonStart, jsonEnd);
                const data = JSON.parse(jsonStr);
                
                if (data.table && data.table.rows) {
                    const listas = [];
                    data.table.rows.forEach((row, index) => {
                        if (index === 0) return; // Pular cabe√ßalho
                        if (row.c && row.c[1] && row.c[1].v) {
                            listas.push({
                                id: row.c[0]?.v || index,
                                nome: row.c[1]?.v || '',
                                categoria: row.c[2]?.v || '',
                                subcategoria: row.c[3]?.v || '',
                                totalContatos: row.c[4]?.v || 0,
                                dataCriacao: row.c[5]?.v || '',
                                ultimaAtualizacao: row.c[6]?.v || '',
                                status: row.c[7]?.v || 'ATIVO'
                            });
                        }
                    });
                    
                    // Salvar no localStorage
                    localStorage.setItem('listasTransmissaoPlanilha', JSON.stringify(listas));
                    
                    // Atualizar o select com as listas
                    const select = document.getElementById('evolutionLista');
                    if (select) {
                        // Remover optgroup antigo se existir
                        const oldOptgroup = select.querySelector('optgroup[label*="Planilha"]');
                        if (oldOptgroup) oldOptgroup.remove();
                        
                        // Criar novo optgroup
                        const optgroup = document.createElement('optgroup');
                        optgroup.label = 'üìä Listas da Planilha (Sincronizadas)';
                        
                        listas.forEach(lista => {
                            const option = document.createElement('option');
                            option.value = lista.nome.toLowerCase().replace(/\s+/g, '_');
                            option.textContent = `üìã ${lista.nome} (${lista.totalContatos})`;
                            optgroup.appendChild(option);
                        });
                        
                        select.appendChild(optgroup);
                    }
                    
                    alert(`‚úÖ Sincroniza√ß√£o conclu√≠da!\n\nüìä ${listas.length} listas importadas da planilha:\n\n${listas.map(l => `‚Ä¢ ${l.nome}: ${l.totalContatos} contatos`).join('\n')}`);
                    return listas;
                } else {
                    throw new Error('Formato de dados inv√°lido');
                }
            } catch (error) {
                console.error('Erro ao sincronizar:', error);
                alert(`‚ùå Erro ao sincronizar listas:\n${error.message}\n\nVerifique se a planilha est√° publicada na web.`);
                return [];
            }
        }

        // ==================== ESTRUTURA DE CATEGORIAS E SUBCATEGORIAS ====================
        // Sistema expandido para reconhecimento autom√°tico por IA
        const CATEGORIAS_SISTEMA = {
            FORNECEDOR: {
                emoji: 'üè≠',
                cor: '#22c55e',
                quantidade: 1200,
                palavrasChave: ['fornece', 'vende', 'produtor', 'fabrica', 'madeireira', 'serraria', 'florestal', 'reflorestamento', 'plantio'],
                subcategorias: [
                    { nome: 'Madeira Bruta', qtd: 180, descricao: 'Fornecedores de madeira sem tratamento', palavras: ['bruta', 'natural', 'sem tratamento'] },
                    { nome: 'Tratamento CCA', qtd: 150, descricao: 'Empresas de tratamento qu√≠mico', palavras: ['cca', 'tratamento', 'autoclave', 'imunizada'] },
                    { nome: 'Eucalipto Verde', qtd: 200, descricao: 'Produtores de eucalipto rec√©m-cortado', palavras: ['verde', 'fresco', 'rec√©m', 'cortado'] },
                    { nome: 'Postes', qtd: 120, descricao: 'Fabricantes de postes de madeira', palavras: ['poste', 'energia', 'ilumina√ß√£o', 'rede'] },
                    { nome: 'Mour√µes', qtd: 180, descricao: 'Produtores de mour√µes para cerca', palavras: ['mour√£o', 'cerca', 'cercamento', 'piquete'] },
                    { nome: 'Estacas', qtd: 100, descricao: 'Fornecedores de estacas', palavras: ['estaca', 'funda√ß√£o', 'constru√ß√£o'] },
                    { nome: 'Lenha', qtd: 80, descricao: 'Produtores de lenha', palavras: ['lenha', 'combust√≠vel', 'queima', 'forno'] },
                    { nome: 'Toras', qtd: 90, descricao: 'Fornecedores de toras brutas', palavras: ['tora', 'tronco', 'rolo'] },
                    { nome: 'Cavacos', qtd: 50, descricao: 'Produtores de cavacos de madeira', palavras: ['cavaco', 'chip', 'biomassa'] },
                    { nome: 'Briquetes', qtd: 30, descricao: 'Fabricantes de briquetes', palavras: ['briquete', 'pellet', 'compactado'] },
                    { nome: 'Palanques', qtd: 20, descricao: 'Fornecedores de palanques', palavras: ['palanque', 'suporte', 'apoio'] }
                ]
            },
            CLIENTE: {
                emoji: 'üë•',
                cor: '#0ea5e9',
                quantidade: 2500,
                palavrasChave: ['compra', 'cliente', 'consumidor', 'pedido', 'encomenda', 'quer', 'precisa', 'necessita'],
                subcategorias: [
                    { nome: 'Varejo', qtd: 400, descricao: 'Clientes de pequenas quantidades', palavras: ['varejo', 'pequeno', 'unidade', 'pouco'] },
                    { nome: 'Atacado', qtd: 350, descricao: 'Compradores em grande escala', palavras: ['atacado', 'grande', 'volume', 'quantidade'] },
                    { nome: 'Constru√ß√£o Civil', qtd: 450, descricao: 'Construtoras e empreiteiras', palavras: ['constru√ß√£o', 'obra', 'construtora', 'empreiteira', 'engenharia'] },
                    { nome: 'Rural', qtd: 380, descricao: 'Fazendas e propriedades rurais', palavras: ['fazenda', 's√≠tio', 'ch√°cara', 'rural', 'campo'] },
                    { nome: 'Industrial', qtd: 250, descricao: 'Ind√∫strias diversas', palavras: ['ind√∫stria', 'f√°brica', 'industrial', 'manufatura'] },
                    { nome: 'Agropecu√°ria', qtd: 280, descricao: 'Empresas do agroneg√≥cio', palavras: ['agro', 'pecu√°ria', 'agricultura', 'planta√ß√£o'] },
                    { nome: 'Mobili√°rio', qtd: 120, descricao: 'F√°bricas de m√≥veis', palavras: ['m√≥vel', 'mob√≠lia', 'marcenaria', 'carpintaria'] },
                    { nome: 'Cer√¢mica', qtd: 100, descricao: 'Ind√∫strias cer√¢micas', palavras: ['cer√¢mica', 'olaria', 'tijolo', 'telha'] },
                    { nome: 'Exporta√ß√£o', qtd: 90, descricao: 'Exportadores de madeira', palavras: ['exporta', 'exterior', 'internacional', 'porto'] },
                    { nome: 'Pecu√°ria', qtd: 80, descricao: 'Criadores de gado', palavras: ['gado', 'boi', 'vaca', 'pecu√°ria', 'criador'] }
                ]
            },
            TRANSPORTADOR: {
                emoji: 'üöö',
                cor: '#f59e0b',
                quantidade: 377,
                palavrasChave: ['frete', 'transporte', 'caminh√£o', 'carreta', 'entrega', 'motorista', 'log√≠stica'],
                subcategorias: [
                    { nome: 'Frete Longo', qtd: 100, descricao: 'Transporte interestadual', palavras: ['interestadual', 'longo', 'dist√¢ncia', 'viagem'] },
                    { nome: 'Frete Curto', qtd: 120, descricao: 'Transporte regional', palavras: ['regional', 'curto', 'local', 'cidade'] },
                    { nome: 'Mudan√ßa', qtd: 40, descricao: 'Servi√ßos de mudan√ßa', palavras: ['mudan√ßa', 'residencial', 'comercial'] },
                    { nome: 'Bitrem', qtd: 50, descricao: 'Caminh√µes bitrem', palavras: ['bitrem', 'bi-trem', 'rodotrem'] },
                    { nome: 'Carreta', qtd: 45, descricao: 'Carretas convencionais', palavras: ['carreta', 'semi-reboque', 'cavalo'] },
                    { nome: 'Truck', qtd: 22, descricao: 'Caminh√µes truck', palavras: ['truck', 'toco', '3/4'] }
                ]
            },
            PARCEIRO: {
                emoji: 'ü§ù',
                cor: '#a855f7',
                quantidade: 0,
                palavrasChave: ['parceiro', 'parceria', 'revenda', 'distribui√ß√£o', 'representa√ß√£o'],
                subcategorias: [
                    { nome: 'Revendedor', qtd: 0, descricao: 'Revendedores autorizados', palavras: ['revenda', 'revendedor', 'loja'] },
                    { nome: 'Distribuidor', qtd: 0, descricao: 'Distribuidores regionais', palavras: ['distribuidor', 'distribui', 'atacadista'] },
                    { nome: 'Representante', qtd: 0, descricao: 'Representantes comerciais', palavras: ['representante', 'rep', 'comercial'] }
                ]
            },
            PROSPECT: {
                emoji: 'üéØ',
                cor: '#ec4899',
                quantidade: 0,
                palavrasChave: ['interessado', 'cota√ß√£o', 'or√ßamento', 'informa√ß√£o', 'conhecer', 'saber'],
                subcategorias: [
                    { nome: 'Potencial Grande', qtd: 0, descricao: 'Prospects de alto valor', palavras: ['grande', 'muito', 'alto', 'volume'] },
                    { nome: 'Potencial M√©dio', qtd: 0, descricao: 'Prospects de m√©dio valor', palavras: ['m√©dio', 'regular', 'moderado'] },
                    { nome: 'Potencial Pequeno', qtd: 0, descricao: 'Prospects iniciais', palavras: ['pequeno', 'inicial', 'teste'] }
                ]
            },
            AGENTE: {
                emoji: 'üíº',
                cor: '#14b8a6',
                quantidade: 0,
                palavrasChave: ['agente', 'vendedor', 'corretor', 'intermedi√°rio'],
                subcategorias: [
                    { nome: 'Comiss√£o', qtd: 0, descricao: 'Agentes por comiss√£o', palavras: ['comiss√£o', 'percentual', '%'] },
                    { nome: 'Vendas', qtd: 0, descricao: 'Agentes de vendas', palavras: ['vendas', 'comercial', 'neg√≥cio'] },
                    { nome: 'Capta√ß√£o', qtd: 0, descricao: 'Agentes de capta√ß√£o', palavras: ['capta√ß√£o', 'prospec√ß√£o', 'busca'] }
                ]
            },
            // ========== NOVAS CATEGORIAS PARA IA ==========
            CONCORRENTE: {
                emoji: '‚öîÔ∏è',
                cor: '#ef4444',
                quantidade: 0,
                palavrasChave: ['concorrente', 'concorr√™ncia', 'competidor', 'rival', 'mesmo ramo'],
                subcategorias: [
                    { nome: 'Direto', qtd: 0, descricao: 'Concorrentes diretos no mesmo segmento', palavras: ['direto', 'mesmo', 'igual'] },
                    { nome: 'Indireto', qtd: 0, descricao: 'Concorrentes em segmentos relacionados', palavras: ['indireto', 'similar', 'parecido'] },
                    { nome: 'Regional', qtd: 0, descricao: 'Concorrentes da mesma regi√£o', palavras: ['regional', 'local', 'cidade'] }
                ]
            },
            GOVERNO: {
                emoji: 'üèõÔ∏è',
                cor: '#6366f1',
                quantidade: 0,
                palavrasChave: ['prefeitura', 'governo', 'secretaria', '√≥rg√£o', 'p√∫blico', 'licita√ß√£o', 'edital'],
                subcategorias: [
                    { nome: 'Municipal', qtd: 0, descricao: 'Prefeituras e √≥rg√£os municipais', palavras: ['prefeitura', 'municipal', 'cidade'] },
                    { nome: 'Estadual', qtd: 0, descricao: 'Governo estadual e secretarias', palavras: ['estado', 'estadual', 'secretaria'] },
                    { nome: 'Federal', qtd: 0, descricao: '√ìrg√£os federais', palavras: ['federal', 'minist√©rio', 'ibama'] },
                    { nome: 'Licita√ß√£o', qtd: 0, descricao: 'Processos licitat√≥rios', palavras: ['licita√ß√£o', 'edital', 'preg√£o', 'concorr√™ncia'] }
                ]
            },
            SERVICO: {
                emoji: 'üîß',
                cor: '#84cc16',
                quantidade: 0,
                palavrasChave: ['servi√ßo', 'manuten√ß√£o', 'reparo', 'instala√ß√£o', 't√©cnico'],
                subcategorias: [
                    { nome: 'Manuten√ß√£o', qtd: 0, descricao: 'Servi√ßos de manuten√ß√£o', palavras: ['manuten√ß√£o', 'conserto', 'reparo'] },
                    { nome: 'Instala√ß√£o', qtd: 0, descricao: 'Servi√ßos de instala√ß√£o', palavras: ['instala√ß√£o', 'montagem', 'coloca√ß√£o'] },
                    { nome: 'Consultoria', qtd: 0, descricao: 'Consultoria t√©cnica', palavras: ['consultoria', 'assessoria', 'orienta√ß√£o'] },
                    { nome: 'Terceirizado', qtd: 0, descricao: 'Servi√ßos terceirizados', palavras: ['terceirizado', 'terceiro', 'contratado'] }
                ]
            },
            FINANCEIRO: {
                emoji: 'üí∞',
                cor: '#eab308',
                quantidade: 0,
                palavrasChave: ['banco', 'financeira', 'cr√©dito', 'empr√©stimo', 'financiamento', 'seguro'],
                subcategorias: [
                    { nome: 'Banco', qtd: 0, descricao: 'Institui√ß√µes banc√°rias', palavras: ['banco', 'ag√™ncia', 'conta'] },
                    { nome: 'Financeira', qtd: 0, descricao: 'Empresas de cr√©dito', palavras: ['financeira', 'cr√©dito', 'empr√©stimo'] },
                    { nome: 'Seguradora', qtd: 0, descricao: 'Seguradoras', palavras: ['seguro', 'seguradora', 'ap√≥lice'] },
                    { nome: 'Contador', qtd: 0, descricao: 'Contadores e escrit√≥rios', palavras: ['contador', 'cont√°bil', 'escrit√≥rio'] }
                ]
            },
            JURIDICO: {
                emoji: '‚öñÔ∏è',
                cor: '#78716c',
                quantidade: 0,
                palavrasChave: ['advogado', 'jur√≠dico', 'processo', 'contrato', 'legal'],
                subcategorias: [
                    { nome: 'Advogado', qtd: 0, descricao: 'Advogados e escrit√≥rios', palavras: ['advogado', 'advocacia', 'oab'] },
                    { nome: 'Cart√≥rio', qtd: 0, descricao: 'Cart√≥rios e registros', palavras: ['cart√≥rio', 'registro', 'tabeli√£o'] },
                    { nome: 'Despachante', qtd: 0, descricao: 'Despachantes', palavras: ['despachante', 'documenta√ß√£o', 'licen√ßa'] }
                ]
            },
            MIDIA: {
                emoji: 'üì∫',
                cor: '#06b6d4',
                quantidade: 0,
                palavrasChave: ['m√≠dia', 'marketing', 'publicidade', 'propaganda', 'redes sociais', 'influencer'],
                subcategorias: [
                    { nome: 'Marketing Digital', qtd: 0, descricao: 'Ag√™ncias de marketing digital', palavras: ['digital', 'online', 'internet', 'google', 'facebook'] },
                    { nome: 'Publicidade', qtd: 0, descricao: 'Ag√™ncias de publicidade', palavras: ['publicidade', 'propaganda', 'an√∫ncio'] },
                    { nome: 'Influencer', qtd: 0, descricao: 'Influenciadores digitais', palavras: ['influencer', 'youtuber', 'instagram', 'tiktok'] },
                    { nome: 'Imprensa', qtd: 0, descricao: 'Jornais e revistas', palavras: ['jornal', 'revista', 'not√≠cia', 'imprensa'] }
                ]
            },
            INATIVO: {
                emoji: 'üí§',
                cor: '#9ca3af',
                quantidade: 0,
                palavrasChave: ['inativo', 'parado', 'sem contato', 'antigo', 'desatualizado'],
                subcategorias: [
                    { nome: 'Sem Resposta', qtd: 0, descricao: 'N√£o responde h√° muito tempo', palavras: ['sem resposta', 'n√£o responde', 'ignorado'] },
                    { nome: 'Encerrado', qtd: 0, descricao: 'Empresa encerrada', palavras: ['fechou', 'encerrou', 'faliu'] },
                    { nome: 'Bloqueado', qtd: 0, descricao: 'Contato bloqueado', palavras: ['bloqueado', 'bloqueio', 'inadimplente'] }
                ]
            },
            VIP: {
                emoji: '‚≠ê',
                cor: '#fbbf24',
                quantidade: 0,
                palavrasChave: ['vip', 'especial', 'premium', 'priorit√°rio', 'importante', 'grande cliente'],
                subcategorias: [
                    { nome: 'Cliente VIP', qtd: 0, descricao: 'Clientes de alto valor', palavras: ['cliente vip', 'grande cliente', 'fiel'] },
                    { nome: 'Fornecedor VIP', qtd: 0, descricao: 'Fornecedores estrat√©gicos', palavras: ['fornecedor vip', 'estrat√©gico', 'principal'] },
                    { nome: 'Parceiro VIP', qtd: 0, descricao: 'Parceiros especiais', palavras: ['parceiro vip', 'especial', 'exclusivo'] }
                ]
            },
            LEAD: {
                emoji: 'üì•',
                cor: '#8b5cf6',
                quantidade: 0,
                palavrasChave: ['lead', 'contato novo', 'primeiro contato', 'site', 'formul√°rio', 'whatsapp'],
                subcategorias: [
                    { nome: 'Site', qtd: 0, descricao: 'Leads do site', palavras: ['site', 'formul√°rio', 'landing'] },
                    { nome: 'WhatsApp', qtd: 0, descricao: 'Leads do WhatsApp', palavras: ['whatsapp', 'zap', 'mensagem'] },
                    { nome: 'Indica√ß√£o', qtd: 0, descricao: 'Leads por indica√ß√£o', palavras: ['indica√ß√£o', 'indicou', 'refer√™ncia'] },
                    { nome: 'Redes Sociais', qtd: 0, descricao: 'Leads das redes sociais', palavras: ['instagram', 'facebook', 'rede social'] },
                    { nome: 'Feira/Evento', qtd: 0, descricao: 'Leads de feiras e eventos', palavras: ['feira', 'evento', 'exposi√ß√£o'] }
                ]
            },
            FUNCIONARIO: {
                emoji: 'üëî',
                cor: '#0891b2',
                quantidade: 0,
                palavrasChave: ['funcion√°rio', 'colaborador', 'empregado', 'equipe', 'time'],
                subcategorias: [
                    { nome: 'Administrativo', qtd: 0, descricao: 'Equipe administrativa', palavras: ['administrativo', 'escrit√≥rio', 'admin'] },
                    { nome: 'Operacional', qtd: 0, descricao: 'Equipe operacional', palavras: ['operacional', 'produ√ß√£o', 'campo'] },
                    { nome: 'Vendas', qtd: 0, descricao: 'Equipe de vendas', palavras: ['vendas', 'comercial', 'vendedor'] },
                    { nome: 'Ger√™ncia', qtd: 0, descricao: 'Gerentes e supervisores', palavras: ['gerente', 'supervisor', 'coordenador'] }
                ]
            }
        };
        
        // ==================== FUN√á√ÉO DE CLASSIFICA√á√ÉO AUTOM√ÅTICA POR IA ====================
        function classificarContatoIA(contato) {
            const texto = `${contato.nome || ''} ${contato.empresa || ''} ${contato.observacao || ''} ${contato.cidade || ''}`.toLowerCase();
            
            let melhorCategoria = 'LEAD';
            let melhorPontuacao = 0;
            let melhorSubcategoria = null;
            
            for (const [categoria, dados] of Object.entries(CATEGORIAS_SISTEMA)) {
                let pontuacao = 0;
                
                // Verificar palavras-chave da categoria
                if (dados.palavrasChave) {
                    for (const palavra of dados.palavrasChave) {
                        if (texto.includes(palavra.toLowerCase())) {
                            pontuacao += 10;
                        }
                    }
                }
                
                // Verificar subcategorias
                let subEncontrada = null;
                for (const sub of dados.subcategorias) {
                    if (sub.palavras) {
                        for (const palavra of sub.palavras) {
                            if (texto.includes(palavra.toLowerCase())) {
                                pontuacao += 5;
                                subEncontrada = sub.nome;
                            }
                        }
                    }
                }
                
                if (pontuacao > melhorPontuacao) {
                    melhorPontuacao = pontuacao;
                    melhorCategoria = categoria;
                    melhorSubcategoria = subEncontrada || dados.subcategorias[0]?.nome;
                }
            }
            
            return {
                categoria: melhorCategoria,
                subcategoria: melhorSubcategoria,
                confianca: Math.min(100, melhorPontuacao * 5),
                emoji: CATEGORIAS_SISTEMA[melhorCategoria]?.emoji || 'üìå'
            };
        }

        // Cidades por UF
        const CIDADES_POR_UF = {
            SP: ['Assis', 'Mar√≠lia', 'Ourinhos', 'Tup√£', 'Pres. Prudente', 'C√¢ndido Mota', 'Rancharia', 'Ribeir√£o Preto', 'Campinas', 'Sorocaba', 'Piracicaba', 'Limeira', 'Santos'],
            PR: ['Londrina', 'Maring√°', 'Curitiba', 'Cascavel', 'Ponta Grossa', 'Foz do Igua√ßu'],
            MS: ['Campo Grande', 'Dourados', 'Tr√™s Lagoas', 'Corumb√°'],
            GO: ['Goi√¢nia', 'An√°polis', 'Aparecida de Goi√¢nia', 'Rio Verde'],
            MG: ['Uberl√¢ndia', 'Uberaba', 'Belo Horizonte', 'Juiz de Fora', 'Montes Claros']
        };

        // Nomes brasileiros para gerar contatos
        const NOMES = ['Jo√£o', 'Maria', 'Pedro', 'Ana', 'Carlos', 'Fernanda', 'Roberto', 'Luciana', 'Marcelo', 'Patr√≠cia', 'Ricardo', 'Juliana', 'Andr√©', 'Camila', 'Felipe', 'Bruna', 'Lucas', 'Amanda', 'Thiago', 'Vanessa', 'Rafael', 'Daniela', 'Bruno', 'Carla', 'Marcos', 'Sandra', 'Fabio', 'Cristina', 'Rodrigo', 'Renata', 'Eduardo', 'Aline', 'Gustavo', 'Fernanda', 'Leandro'];
        const SOBRENOMES = ['Silva', 'Santos', 'Oliveira', 'Costa', 'Souza', 'Lima', 'Pereira', 'Carvalho', 'Ribeiro', 'Moreira', 'Alves', 'Ferreira', 'Barbosa', 'Pinto', 'Cunha', 'Lopes', 'Cardoso', 'Teixeira', 'Vieira', 'Nascimento', 'Azevedo', 'Melo', 'Freitas', 'Reis', 'Castro', 'Duarte', 'Machado', 'Monteiro', 'Martins', 'Dias', 'Nunes', 'Gomes', 'Rocha', 'Mendes'];

        // Gerar todos os 4.077 contatos
        let TODOS_CONTATOS = [];

        function gerarTodosContatos() {
            TODOS_CONTATOS = [];
            let idGlobal = 1;
            
            for (const [categoria, dados] of Object.entries(CATEGORIAS_SISTEMA)) {
                if (dados.quantidade === 0) continue;
                
                for (const sub of dados.subcategorias) {
                    for (let i = 0; i < sub.qtd; i++) {
                        const uf = Object.keys(CIDADES_POR_UF)[Math.floor(Math.random() * Object.keys(CIDADES_POR_UF).length)];
                        const cidades = CIDADES_POR_UF[uf];
                        const cidade = cidades[Math.floor(Math.random() * cidades.length)];
                        const nome = NOMES[Math.floor(Math.random() * NOMES.length)];
                        const sobrenome = SOBRENOMES[Math.floor(Math.random() * SOBRENOMES.length)];
                        
                        TODOS_CONTATOS.push({
                            id: idGlobal++,
                            nome: `${nome} ${sobrenome}`,
                            telefone: `5518${String(900000000 + Math.floor(Math.random() * 99999999)).substring(0, 9)}`,
                            categoria: categoria,
                            subcategoria: sub.nome,
                            cidade: cidade,
                            uf: uf,
                            email: `${nome.toLowerCase()}.${sobrenome.toLowerCase()}${idGlobal}@email.com`,
                            empresa: `${sub.nome} ${sobrenome}`,
                            status: ['ATIVO', 'ATIVO', 'ATIVO', 'VIP', 'NOVO'][Math.floor(Math.random() * 5)],
                            ultimaCompra: new Date(2025, Math.floor(Math.random() * 12), Math.floor(Math.random() * 28) + 1).toISOString().split('T')[0]
                        });
                    }
                }
            }
            
            console.log(`‚úÖ ${TODOS_CONTATOS.length} contatos gerados!`);
            return TODOS_CONTATOS;
        }

        // Renderizar categorias e subcategorias
        function renderizarCategorias() {
            const container = document.getElementById('categoriasContainer');
            if (!container) return;
            
            let html = '';
            for (const [cat, dados] of Object.entries(CATEGORIAS_SISTEMA)) {
                if (dados.quantidade === 0) continue;
                
                html += `
                    <div class="grid-card" style="border-left: 4px solid ${dados.cor};">
                        <h3>${dados.emoji} ${cat}</h3>
                        <p style="color: ${dados.cor}; font-size: 1.8em; font-weight: bold;">${dados.quantidade.toLocaleString()}</p>
                        <p style="color: #94a3b8; margin-bottom: 10px;">${dados.subcategorias.length} subcategorias</p>
                        <details style="margin-top: 10px;">
                            <summary style="cursor: pointer; color: var(--primary);">Ver subcategorias</summary>
                            <ul style="margin-top: 10px; padding-left: 20px; font-size: 0.85em;">
                                ${dados.subcategorias.map(s => `<li>${s.nome}: <strong>${s.qtd}</strong></li>`).join('')}
                            </ul>
                        </details>
                        <button onclick="criarListaPorCategoria('${cat}')" style="margin-top: 10px; padding: 8px 15px; font-size: 0.85em;">üì® Criar Lista</button>
                    </div>
                `;
            }
            container.innerHTML = html;
        }

        function criarListaPorCategoria(categoria) {
            const dados = CATEGORIAS_SISTEMA[categoria];
            const lotes = Math.ceil(dados.quantidade / 256);
            alert(`‚úÖ Lista de ${categoria} criada!\n\n${dados.emoji} ${dados.quantidade} contatos\nüìÇ ${lotes} lotes de at√© 256 contatos\n\nA lista foi adicionada √† aba "Listas WhatsApp".`);
        }

        function gerarContatosCategoria(categoria, subcategorias, quantidade) {
            const cidades = ['Assis', 'Mar√≠lia', 'Ourinhos', 'Tup√£', 'Pres. Prudente', 'C√¢ndido Mota', 'Rancharia', 'Ribeir√£o Preto', 'Campinas', 'Sorocaba'];
            const ufs = ['SP', 'PR', 'MS', 'GO', 'MG'];
            const status = ['ATIVO', 'ATIVO', 'ATIVO', 'VIP', 'NOVO'];
            
            return Array.from({length: quantidade}, (_, i) => ({
                id: i + 1,
                nome: `${categoria.charAt(0)}${categoria.slice(1).toLowerCase()} ${i + 1}`,
                telefone: `55189${String(90000000 + i).padStart(8, '0')}`,
                categoria: categoria,
                subcategoria: subcategorias[i % subcategorias.length],
                cidade: cidades[i % cidades.length],
                uf: ufs[i % ufs.length],
                email: `contato${i + 1}@email.com`,
                empresa: `Empresa ${i + 1}`,
                status: status[i % status.length],
                ultimaCompra: new Date(2025, Math.floor(Math.random() * 12), Math.floor(Math.random() * 28) + 1).toISOString().split('T')[0]
            }));
        }

        // Dados da planilha (cache local)
        const TABELA_PRECOS = {
            '6 a 8': { comp: 2.20, diam: 7.0, minPc: 6.50, maxPc: 7.32, medPc: 6.91, pcM3: 118, rentab: 815.38 },
            '8 a 10': { comp: 2.20, diam: 9.0, minPc: 6.50, maxPc: 9.00, medPc: 7.75, pcM3: 71, rentab: 550.25 },
            '10 a 12': { comp: 2.20, diam: 10.5, minPc: 6.50, maxPc: 9.00, medPc: 7.75, pcM3: 52, rentab: 403.00 },
            '12 a 14': { comp: 2.20, diam: 13.0, minPc: 12.06, maxPc: 16.00, medPc: 14.03, pcM3: 34, rentab: 477.02 },
            '13 a 16': { comp: 2.20, diam: 14.5, minPc: 12.06, maxPc: 17.00, medPc: 14.53, pcM3: 28, rentab: 406.84 },
            '17 a 22': { comp: 2.50, diam: 19.5, minPc: 18.00, maxPc: 22.00, medPc: 20.00, pcM3: 13, rentab: 260.00 },
            '22 a 25': { comp: 2.50, diam: 23.5, minPc: 33.00, maxPc: 43.00, medPc: 38.00, pcM3: 9, rentab: 342.00 },
            '25 a 30': { comp: 2.50, diam: 27.5, minPc: 46.00, maxPc: 56.00, medPc: 51.00, pcM3: 7, rentab: 357.00 },
            '30 a 40': { comp: 2.50, diam: 35.0, minPc: 253.85, maxPc: 253.85, medPc: 253.85, pcM3: 4, rentab: 1015.38 },
            '40 a 50': { comp: 2.50, diam: 45.0, minPc: 170.00, maxPc: 230.00, medPc: 200.00, pcM3: 3, rentab: 600.00 }
        };

        const PARAMETROS_SISTEMA = {
            conversaoStM3: 0.65,
            conversaoM3St: 1.54,
            custoTratamentoCCA: 300.00,
            custoTratamentoSt: 195.00
        };

        function abrirPlanilha() {
            window.open('https://docs.google.com/spreadsheets/d/' + GOOGLE_SHEETS_CONFIG.spreadsheetId, '_blank');
        }

        function consultarPreco(bitola) {
            const preco = TABELA_PRECOS[bitola];
            if (preco) {
                return `Bitola ${bitola}cm: R$ ${preco.minPc.toFixed(2)} - R$ ${preco.maxPc.toFixed(2)}/pc`;
            }
            return 'Bitola nao encontrada';
        }

        // ==================== LISTA DE TRANSMISS√ÉO EVOLUTION API ====================
        let listasTransmissao = JSON.parse(localStorage.getItem('listasTransmissao') || '[]');
        let contatosGoogleSheets = [];

        // Carregar contatos do Google Sheets
        async function carregarContatosGoogleSheets() {
            const statusEl = document.getElementById('statusGoogleSheets');
            if (statusEl) statusEl.innerHTML = '<span style="color: #f59e0b;">‚è≥ Carregando...</span>';
            
            try {
                // URL p√∫blica da planilha via gviz/tq
                // Usar gid=1689968688 (aba CONTATOS, 7.056 linhas) - GID real verificado
                const sheetId = GOOGLE_SHEETS_CONFIG.spreadsheetId;
                const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&gid=1689968688`;
                
                const response = await fetch(url);
                const text = await response.text();
                
                // Parse do JSON do Google Sheets
                const jsonStart = text.indexOf('{');
                const jsonEnd = text.lastIndexOf('}') + 1;
                
                if (jsonStart === -1 || jsonEnd === 0) {
                    throw new Error('Resposta inv√°lida da planilha');
                }
                
                const jsonData = JSON.parse(text.substring(jsonStart, jsonEnd));
                
                if (!jsonData.table || !jsonData.table.rows) {
                    throw new Error('Estrutura de dados inv√°lida');
                }
                
                const rows = jsonData.table.rows;
                // Mapeamento completo das 32 colunas reais da aba CONTATOS:
                // [0]=checkbox [1]=NOME [2]=TELEFONE [3]=CATEGORIA [4]=SUBCATEGORIA
                // [5]=CIDADE [6]=UF [7]=EMAIL [8]=EMPRESA [9]=STATUS
                // [10]=ULTIMA_COMPRA [11]=ORIGEM_LEAD [12]=DATA_CADASTRO [13]=RESPONSAVEL
                // [14]=PRIORIDADE [15]=VALOR_POTENCIAL [16]=ETAPA_FUNIL [17]=PROXIMO_CONTATO
                // [18]=OBSERVACOES [19]=TAGS [20]=TELEFONE_2 [21]=WHATSAPP [22]=LINKEDIN
                // [23]=INSTAGRAM [24]=CARGO [25]=(vazio) [26]=CEP [27]=ID_CONTATO
                // [28]=LEAD_SCORE [29]=RESPONSAVEL [30]=DATA_CADASTRO [31]=DATA_ULTIMA_INTERACAO
                contatosGoogleSheets = rows.map((row, index) => {
                    const c = row.c || [];
                    const telRaw = c[2]?.v || '';
                    // Telefone vem como n√∫mero float (ex: 5514918265659.0) ‚Äî converter para string
                    const telStr = telRaw ? String(Math.round(Number(telRaw))) : '';
                    const whatsapp = c[21]?.v || telStr;
                    return {
                        id: c[27]?.v || index + 1,
                        nome: c[1]?.v || '',
                        telefone: formatarTelefone(telStr),
                        telefone2: c[20]?.v || '',
                        whatsapp: formatarTelefone(String(whatsapp)),
                        categoria: c[3]?.v || '',
                        subcategoria: c[4]?.v || '',
                        cidade: c[5]?.v || '',
                        uf: c[6]?.v || '',
                        email: c[7]?.v || '',
                        empresa: c[8]?.v || '',
                        status: c[9]?.v || 'ATIVO',
                        ultimaCompra: c[10]?.v || '',
                        origemLead: c[11]?.v || '',
                        dataCadastro: c[12]?.v || '',
                        responsavel: c[13]?.v || c[29]?.v || '',
                        prioridade: c[14]?.v || '',
                        valorPotencial: c[15]?.v || '',
                        etapaFunil: c[16]?.v || '',
                        proximoContato: c[17]?.v || '',
                        observacoes: c[18]?.v || '',
                        tags: c[19]?.v || '',
                        linkedin: c[22]?.v || '',
                        instagram: c[23]?.v || '',
                        cargo: c[24]?.v || '',
                        cep: c[26]?.v || '',
                        leadScore: c[28]?.v || '',
                        dataUltimaInteracao: c[31]?.v || ''
                    };
                }).filter(c => c.nome && c.telefone);

                // Expor globalmente para fun√ß√µes que usam window.contatosGoogleSheets
                window.contatosGoogleSheets = contatosGoogleSheets;
                
                if (statusEl) statusEl.innerHTML = `<span style="color: #22c55e;">‚úÖ ${contatosGoogleSheets.length} contatos carregados</span>`;
                atualizarSelectContatos();
                console.log('‚úÖ Contatos carregados do Google Sheets:', contatosGoogleSheets.length);
                return contatosGoogleSheets;
            } catch (error) {
                console.warn('‚ö†Ô∏è Usando contatos locais (planilha n√£o dispon√≠vel):', error.message);
                if (statusEl) statusEl.innerHTML = '<span style="color: #f59e0b;">‚ö†Ô∏è Usando dados locais</span>';
                // Usar dados gerados localmente como fallback
                contatosGoogleSheets = gerarTodosContatosSistema();
                window.contatosGoogleSheets = contatosGoogleSheets;
                atualizarSelectContatos();
                return contatosGoogleSheets;
            }
        }
        
        // ==================== FUN√á√ïES DE GERA√á√ÉO DE CONTATOS ====================
        
        // Gerar todos os 4.077 contatos do sistema
        function gerarTodosContatosSistema() {
            console.log('üì¶ Gerando contatos do sistema...');
            const contatos = [];
            let id = 1;
            
            // Gerar contatos para cada categoria
            Object.entries(CATEGORIAS_SISTEMA).forEach(([categoria, dados]) => {
                dados.subcategorias.forEach(sub => {
                    for (let i = 0; i < sub.qtd; i++) {
                        contatos.push({
                            id: id++,
                            nome: gerarNomeAleatorio(categoria, sub.nome, i),
                            telefone: gerarTelefoneAleatorio(),
                            categoria: categoria,
                            subcategoria: sub.nome,
                            cidade: gerarCidadeAleatoria(),
                            uf: 'SP',
                            email: '',
                            empresa: gerarEmpresaAleatoria(categoria, sub.nome),
                            status: 'ativo',
                            ultimaCompra: gerarDataAleatoria()
                        });
                    }
                });
            });
            
            console.log(`‚úÖ ${contatos.length} contatos gerados!`);
            return contatos;
        }
        
        // Fun√ß√µes auxiliares para gera√ß√£o de dados
        function gerarNomeAleatorio(categoria, subcategoria, index) {
            const nomes = ['Jo√£o', 'Maria', 'Pedro', 'Ana', 'Carlos', 'Fernanda', 'Lucas', 'Julia', 'Rafael', 'Camila'];
            const sobrenomes = ['Silva', 'Santos', 'Oliveira', 'Souza', 'Lima', 'Pereira', 'Costa', 'Ferreira', 'Almeida', 'Rodrigues'];
            return `${nomes[index % nomes.length]} ${sobrenomes[Math.floor(index / nomes.length) % sobrenomes.length]}`;
        }
        
        function gerarTelefoneAleatorio() {
            const ddd = ['18', '14', '17', '16', '15'][Math.floor(Math.random() * 5)];
            const numero = String(900000000 + Math.floor(Math.random() * 99999999)).substring(0, 9);
            return `55${ddd}${numero}`;
        }
        
        function gerarCidadeAleatoria() {
            const cidades = ['Assis', 'Mar√≠lia', 'Presidente Prudente', 'Ourinhos', 'Tup√£', 'Bauru', 'Botucatu', 'Avar√©', 'Piraju', 'Paraguacu Paulista'];
            return cidades[Math.floor(Math.random() * cidades.length)];
        }
        
        function gerarEmpresaAleatoria(categoria, subcategoria) {
            const prefixos = {
                'FORNECEDOR': ['Madeireira', 'Serraria', 'Florestal', 'Agro'],
                'CLIENTE': ['Fazenda', 'Construtora', 'Com√©rcio', 'Ind√∫stria'],
                'TRANSPORTADOR': ['Transportes', 'Log√≠stica', 'Frete', 'Cargas']
            };
            const sufixos = ['Brasil', 'SP', 'Oeste', 'Centro', 'Sul', 'Norte'];
            const prefixo = prefixos[categoria]?.[Math.floor(Math.random() * prefixos[categoria].length)] || 'Empresa';
            return `${prefixo} ${sufixos[Math.floor(Math.random() * sufixos.length)]}`;
        }
        
        function gerarDataAleatoria() {
            const dias = Math.floor(Math.random() * 365);
            const data = new Date();
            data.setDate(data.getDate() - dias);
            return data.toISOString().split('T')[0];
        }
        
        // Executar todas as fun√ß√µes do sistema
        async function executarTudo() {
            console.log('EXECUTANDO TODAS AS FUNCOES DO SISTEMA...');
            
            // 1. Gerar contatos
            console.log('1. Gerando contatos...');
            const contatos = gerarTodosContatosSistema();
            console.log(`   ‚úÖ ${contatos.length} contatos gerados`);
            
            // 2. Mostrar distribui√ß√£o por categoria
            console.log('2. Distribuicao por categoria:');
            const distribuicao = {};
            contatos.forEach(c => {
                if (!distribuicao[c.categoria]) distribuicao[c.categoria] = 0;
                distribuicao[c.categoria]++;
            });
            Object.entries(distribuicao).forEach(([cat, qtd]) => {
                console.log(`   ${CATEGORIAS_SISTEMA[cat]?.emoji || 'üìå'} ${cat}: ${qtd}`);
            });
            
            // 3. Mostrar subcategorias
            console.log('3. Subcategorias:');
            Object.entries(CATEGORIAS_SISTEMA).forEach(([cat, dados]) => {
                console.log(`   ${dados.emoji} ${cat}:`);
                dados.subcategorias.forEach(sub => {
                    console.log(`      - ${sub.nome}: ${sub.qtd}`);
                });
            });
            
            // 4. Testar Evolution API
            console.log('4. Testando Evolution API...');
            try {
                const evolutionUrl = localStorage.getItem('evolutionUrl') || 'http://localhost:8080';
                const evolutionKey = localStorage.getItem('evolutionApiKey') || 'ENSIDE_MADEIRAS_2024_KEY';
                const response = await fetch(`${evolutionUrl}/instance/fetchInstances`, {
                    headers: { 'apikey': evolutionKey }
                });
                if (response.ok) {
                    const instances = await response.json();
                    console.log(`   ‚úÖ Evolution API conectada! ${instances.length} inst√¢ncia(s)`);
                } else {
                    console.log('   ‚ö†Ô∏è Evolution API n√£o dispon√≠vel');
                }
            } catch (e) {
                console.log('Evolution API offline');
            }
            
            // 5. Resumo final
            console.log('EXECUCAO COMPLETA!');
            console.log('Total de contatos: ' + contatos.length);
            console.log('Fornecedores: ' + (distribuicao.FORNECEDOR || 0));
            console.log('Clientes: ' + (distribuicao.CLIENTE || 0));
            console.log('Transportadores: ' + (distribuicao.TRANSPORTADOR || 0));
            
            // Atualizar interface
            contatosGoogleSheets = contatos;
            atualizarSelectContatos();
            
            // Mostrar alerta
            alert('SISTEMA EXECUTADO COM SUCESSO! Total: ' + contatos.length + ' contatos');
            
            return { contatos, distribuicao };
        }

        function formatarTelefone(tel) {
            if (!tel) return '';
            const numeros = String(tel).replace(/\D/g, '');
            if (numeros.length >= 10) {
                return numeros.startsWith('55') ? numeros : '55' + numeros;
            }
            return '';
        }

        function gerarContatosExemplo() {
            const nomes = ['Jo√£o Silva', 'Maria Santos', 'Pedro Oliveira', 'Ana Costa', 'Carlos Souza'];
            const cidades = ['Assis', 'Mar√≠lia', 'Presidente Prudente', 'Ourinhos', 'Tup√£'];
            const categorias = ['fornecedor', 'cliente', 'transportador'];
            
            return Array.from({length: 50}, (_, i) => ({
                id: i + 1,
                nome: nomes[i % nomes.length] + ' ' + (i + 1),
                telefone: '5518' + String(900000000 + Math.floor(Math.random() * 99999999)).substring(0, 9),
                categoria: categorias[i % categorias.length],
                cidade: cidades[i % cidades.length],
                uf: 'SP'
            }));
        }

        function atualizarSelectContatos() {
            const select = document.getElementById('contatosDisponiveis');
            if (!select) return;
            
            select.innerHTML = contatosGoogleSheets.map(c => 
                `<option value="${c.id}" data-telefone="${c.telefone}" data-categoria="${c.categoria}">
                    ${c.nome} - ${c.telefone} (${c.categoria})
                </option>`
            ).join('');
        }

        // Criar lista de transmiss√£o (local + Evolution API)
        async function criarListaTransmissao() {
            const nome = document.getElementById('nomeListaTransmissao')?.value?.trim() || 'Nova Lista';
            const categoria = document.getElementById('filtroCategoria')?.value || 'todos';
            const uf = document.getElementById('filtroUF')?.value || 'todos';
            
            let contatosFiltrados = [...(window.contatosGoogleSheets || [])];
            
            if (categoria !== 'todos') {
                contatosFiltrados = contatosFiltrados.filter(c => 
                    c.categoria && c.categoria.toLowerCase().includes(categoria.toLowerCase())
                );
            }
            if (uf !== 'todos') {
                contatosFiltrados = contatosFiltrados.filter(c => c.uf === uf);
            }
            
            // Limitar a 256 contatos por lista (limite WhatsApp)
            const contatosLista = contatosFiltrados.slice(0, 256);
            
            if (contatosLista.length === 0) {
                alert('‚ö†Ô∏è Nenhum contato encontrado com os filtros selecionados.\n\nClique em "Sincronizar Google Sheets" para carregar os contatos.');
                return;
            }

            const novaLista = {
                id: 'lista_' + Date.now(),
                nome: nome,
                categoria: categoria,
                uf: uf,
                contatos: contatosLista,
                total: contatosLista.length,
                criadaEm: new Date().toISOString(),
                status: 'ativa'
            };
            
            listasTransmissao.push(novaLista);
            localStorage.setItem('listasTransmissao', JSON.stringify(listasTransmissao));
            renderizarListasTransmissao();

            // Tentar criar lista na Evolution API
            const url = document.getElementById('evolutionUrl')?.value;
            const apiKey = document.getElementById('evolutionApiKey')?.value;

            if (url && apiKey) {
                try {
                    const resp = await fetch(`${url}/api/list/create`, {
                        method: 'POST',
                        headers: { 'apikey': apiKey, 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name: nome, description: `Categoria: ${categoria} | UF: ${uf} | ${contatosLista.length} contatos` })
                    });
                    if (resp.ok) {
                        const listData = await resp.json();
                        const listId = listData.list?.id;
                        novaLista.evolutionListId = listId;
                        localStorage.setItem('listasTransmissao', JSON.stringify(listasTransmissao));
                        alert(`‚úÖ Lista "${nome}" criada!\n\nüìä ${contatosLista.length} contatos\nüì± Evolution API: Lista ID ${listId}\n\nPara enviar mensagens, use o bot√£o "üì® Enviar" na lista.`);
                    } else {
                        alert(`‚úÖ Lista "${nome}" criada localmente com ${contatosLista.length} contatos.\n‚ö†Ô∏è N√£o foi poss√≠vel sincronizar com Evolution API.`);
                    }
                } catch (e) {
                    alert(`‚úÖ Lista "${nome}" criada localmente com ${contatosLista.length} contatos.\n‚ö†Ô∏è Evolution API offline: ${e.message}`);
                }
            } else {
                alert(`‚úÖ Lista "${nome}" criada com ${contatosLista.length} contatos!\nüí° Configure a Evolution API para sincronizar.`);
            }
        }
        
        // Fun√ß√£o para abrir a lista na planilha Google Sheets
        function abrirListaNaPlanilha(lista) {
            const spreadsheetId = GOOGLE_SHEETS_CONFIG.spreadsheetId;
            
            // Criar CSV dos contatos para copiar
            const csvData = lista.contatos.map(c => 
                `${c.nome || ''},${c.telefone || ''},${c.categoria || ''},${c.cidade || ''},${c.uf || ''},${c.email || ''}`
            ).join('\n');
            
            // Salvar no localStorage para refer√™ncia
            localStorage.setItem('ultimaListaCriada', JSON.stringify({
                nome: lista.nome,
                contatos: lista.contatos,
                criadaEm: lista.criadaEm
            }));
            
            // Abrir a planilha na aba LISTAS_TRANSMISSAO (gid=1114979046)
            const url = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/edit?gid=1114979046`;
            window.open(url, '_blank');
            
            // Mostrar modal com os contatos
            mostrarContatosLista(lista);
        }
        
        // Mostrar modal com contatos da lista
        function mostrarContatosLista(lista) {
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center;';
            
            const contatosHTML = lista.contatos.slice(0, 50).map((c, i) => 
                `<tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <td style="padding: 8px;">${i + 1}</td>
                    <td style="padding: 8px;">${c.nome || '-'}</td>
                    <td style="padding: 8px;">${c.telefone || '-'}</td>
                    <td style="padding: 8px;">${c.categoria || '-'}</td>
                    <td style="padding: 8px;">${c.uf || '-'}</td>
                </tr>`
            ).join('');
            
            modal.innerHTML = `
                <div style="background: var(--card-bg, #1e293b); padding: 30px; border-radius: 15px; max-width: 800px; max-height: 80vh; overflow-y: auto; color: white;">
                    <h2 style="color: var(--primary, #0ea5e9); margin-bottom: 20px;">üìã ${lista.nome}</h2>
                    <p style="margin-bottom: 15px;">Total: <strong>${lista.total}</strong> contatos | Categoria: <strong>${lista.categoria}</strong> | UF: <strong>${lista.uf || 'Todos'}</strong></p>
                    
                    <div style="margin-bottom: 20px;">
                        <button onclick="copiarContatosCSV('${lista.id}')" style="padding: 10px 20px; background: linear-gradient(135deg, #22c55e, #16a34a); border: none; border-radius: 8px; color: white; cursor: pointer; margin-right: 10px;">
                            üìã Copiar para Planilha (CSV)
                        </button>
                        <button onclick="exportarListaParaSheets('${lista.id}')" style="padding: 10px 20px; background: linear-gradient(135deg, #0ea5e9, #0284c7); border: none; border-radius: 8px; color: white; cursor: pointer;">
                            üì§ Adicionar na Planilha
                        </button>
                    </div>
                    
                    <table style="width: 100%; border-collapse: collapse; font-size: 0.9em;">
                        <thead>
                            <tr style="background: rgba(14,165,233,0.2);">
                                <th style="padding: 10px; text-align: left;">#</th>
                                <th style="padding: 10px; text-align: left;">Nome</th>
                                <th style="padding: 10px; text-align: left;">Telefone</th>
                                <th style="padding: 10px; text-align: left;">Categoria</th>
                                <th style="padding: 10px; text-align: left;">UF</th>
                            </tr>
                        </thead>
                        <tbody>${contatosHTML}</tbody>
                    </table>
                    ${lista.total > 50 ? `<p style="color: #94a3b8; margin-top: 10px; text-align: center;">... e mais ${lista.total - 50} contatos</p>` : ''}
                    
                    <button onclick="this.parentElement.parentElement.remove()" style="margin-top: 20px; padding: 12px 30px; background: #64748b; border: none; border-radius: 8px; color: white; cursor: pointer; width: 100%;">
                        Fechar
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // Copiar contatos em formato CSV para colar na planilha
        function copiarContatosCSV(listaId) {
            const lista = listasTransmissao.find(l => l.id === listaId);
            if (!lista) return;
            
            const header = 'NOME,TELEFONE,CATEGORIA,CIDADE,UF,EMAIL';
            const rows = lista.contatos.map(c => 
                `${c.nome || ''},${c.telefone || ''},${c.categoria || ''},${c.cidade || ''},${c.uf || ''},${c.email || ''}`
            );
            const csv = [header, ...rows].join('\n');
            
            navigator.clipboard.writeText(csv).then(() => {
                alert('‚úÖ Contatos copiados!\n\n1. Abra a planilha Google Sheets\n2. V√° para a aba LISTAS_TRANSMISSAO ou crie uma nova aba\n3. Cole (Ctrl+V) os dados');
            }).catch(() => {
                // Fallback para navegadores antigos
                const textarea = document.createElement('textarea');
                textarea.value = csv;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('‚úÖ Contatos copiados para a √°rea de transfer√™ncia!');
            });
        }
        
        // Exportar lista para uma nova aba na planilha
        async function exportarListaParaSheets(listaId) {
            const lista = listasTransmissao.find(l => l.id === listaId);
            if (!lista) return;
            
            const spreadsheetId = GOOGLE_SHEETS_CONFIG.spreadsheetId;
            const nomeAba = lista.nome.replace(/[^a-zA-Z0-9]/g, '_').substring(0, 30);
            
            // Criar URL para adicionar dados via Google Forms/Apps Script (se configurado)
            // Por enquanto, abrir a planilha e mostrar instru√ß√µes
            const url = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/edit`;
            window.open(url, '_blank');
            
            alert(`üìä Para adicionar a lista "${lista.nome}" na planilha:\n\n1. Clique em "+" para criar nova aba\n2. Nomeie como: ${nomeAba}\n3. Cole os contatos (j√° copiados)\n\nüí° Dica: Use o bot√£o "Copiar para Planilha" primeiro!`);
        }

        function renderizarListasTransmissao() {
            const container = document.getElementById('listasTransmissaoContainer');
            if (!container) return;
            
            if (listasTransmissao.length === 0) {
                container.innerHTML = '<p style="color: #94a3b8; text-align: center;">Nenhuma lista criada ainda</p>';
                return;
            }
            
            container.innerHTML = listasTransmissao.map(lista => `
                <div class="grid-card" style="position: relative;">
                    <span style="position: absolute; top: 10px; right: 10px; background: ${lista.status === 'ativa' ? '#22c55e' : '#94a3b8'}; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.7em;">${lista.status}</span>
                    <h3>${getCategoriaEmoji(lista.categoria)} ${lista.nome}</h3>
                    <p style="color: var(--primary); font-size: 1.5em; font-weight: bold;">${lista.total}</p>
                    <p style="color: #94a3b8;">contatos</p>
                    <p style="color: #64748b; font-size: 0.8em;">UF: ${lista.uf || 'Todos'}</p>
                    <div style="margin-top: 10px; display: flex; gap: 5px; flex-wrap: wrap;">
                        <button onclick="enviarListaEvolution('${lista.id}')" style="padding: 8px 12px; font-size: 0.8em; background: linear-gradient(135deg, #22c55e, #16a34a);">üì® Enviar</button>
                        <button onclick="exportarListaCSV('${lista.id}')" class="btn-secondary" style="padding: 8px 12px; font-size: 0.8em;">üì§ CSV</button>
                        <button onclick="excluirLista('${lista.id}')" class="btn-secondary" style="padding: 8px 12px; font-size: 0.8em; background: #ef4444;">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        // Enviar mensagem para lista via Evolution API
        async function enviarListaEvolution(listaId) {
            const lista = listasTransmissao.find(l => l.id === listaId);
            if (!lista) {
                alert('‚ùå Lista n√£o encontrada');
                return;
            }
            
            const mensagem = prompt(`üì® Mensagem para "${lista.nome}" (${lista.total} contatos):\nUse {nome} para personalizar.`, 'üå≤ Ol√° {nome}! Somos a ENSIDE MADEIRAS. Confira nossas ofertas de eucalipto tratado!');
            if (!mensagem) return;
            
            const url = document.getElementById('evolutionUrl')?.value;
            const apiKey = document.getElementById('evolutionApiKey')?.value;

            if (!url || !apiKey) {
                alert('‚ö†Ô∏è Configure a URL e API Key da Evolution API primeiro.');
                return;
            }

            // Extrair telefones v√°lidos
            const phones = lista.contatos.map(c => {
                const tel = String(c.telefone || '').replace(/\D/g, '');
                return tel.startsWith('55') ? tel : '55' + tel;
            }).filter(t => t.length >= 12);

            if (phones.length === 0) {
                alert('‚ùå Nenhum telefone v√°lido na lista.');
                return;
            }

            const progressEl = document.getElementById('progressoEnvio');
            if (progressEl) {
                progressEl.style.display = 'block';
                progressEl.innerHTML = `<p>‚è≥ Enviando para ${phones.length} contatos...</p>`;
            }

            try {
                // Enviar em lotes de 256 via send-bulk (Evolution API v2.0.0)
                const LOTE = 256;
                let totalEnviados = 0;
                let totalErros = 0;

                for (let i = 0; i < phones.length; i += LOTE) {
                    const lote = phones.slice(i, i + LOTE);
                    const response = await fetch(`${url}/api/message/send-bulk`, {
                        method: 'POST',
                        headers: { 'apikey': apiKey, 'Content-Type': 'application/json' },
                        body: JSON.stringify({ phones: lote, message: mensagem })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        totalEnviados += data.messagesSent || lote.length;
                    } else {
                        totalErros += lote.length;
                    }

                    if (progressEl) {
                        const progresso = Math.round(((i + lote.length) / phones.length) * 100);
                        progressEl.innerHTML = `
                            <div style="background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; margin: 10px 0;">
                                <div style="background: linear-gradient(90deg, #22c55e, #16a34a); width: ${progresso}%; height: 20px; transition: width 0.3s;"></div>
                            </div>
                            <p>‚úÖ Enviados: ${totalEnviados} | ‚ùå Erros: ${totalErros} | ${progresso}%</p>
                        `;
                    }

                    if (i + LOTE < phones.length) await new Promise(r => setTimeout(r, 2000));
                }

                const countEl = document.getElementById('evolutionMsgs');
                if (countEl) countEl.textContent = parseInt(countEl.textContent || '0') + totalEnviados;
                if (progressEl) progressEl.style.display = 'none';
                alert(`üì® Envio conclu√≠do!\n\n‚úÖ Enviados: ${totalEnviados}\n‚ùå Erros: ${totalErros}\nüìä Total: ${phones.length}\nüìÖ ${new Date().toLocaleString('pt-BR')}`);

            } catch (error) {
                if (progressEl) progressEl.style.display = 'none';
                alert(`‚ùå Erro ao enviar: ${error.message}`);
            }
        }

        function exportarListaCSV(listaId) {
            const lista = listasTransmissao.find(l => l.id === listaId);
            if (!lista) return;
            
            const csv = 'Nome,Telefone,Categoria,Cidade,UF\n' + 
                lista.contatos.map(c => `${c.nome},${c.telefone},${c.categoria},${c.cidade},${c.uf}`).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${lista.nome.replace(/\s+/g, '_')}.csv`;
            link.click();
        }

        function excluirLista(listaId) {
            if (!confirm('‚ö†Ô∏è Deseja excluir esta lista?')) return;
            
            listasTransmissao = listasTransmissao.filter(l => l.id !== listaId);
            localStorage.setItem('listasTransmissao', JSON.stringify(listasTransmissao));
            renderizarListasTransmissao();
        }

        // Sincronizar com Google Sheets
        async function sincronizarGoogleSheets() {
            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = '‚è≥ Sincronizando...';
            
            await carregarContatosGoogleSheets();
            await sincronizarListasComPlanilha();
            
            btn.disabled = false;
            btn.innerHTML = 'üîÑ Sincronizar Google Sheets';
        }

        // Sincronizar listas de transmiss√£o com a planilha Google Sheets
        async function sincronizarListasComPlanilha() {
            const sheetId = GOOGLE_SHEETS_CONFIG.spreadsheetId;
            const sheetName = 'LISTAS_TRANSMISSAO';
            
            // Carregar listas existentes da planilha
            try {
                const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=LISTAS_TRANSMISSAO`;
                const response = await fetch(url);
                const text = await response.text();
                // Extrair JSON corretamente (remover wrapper do Google Visualization)
                const jsonStart = text.indexOf('{');
                const jsonEnd = text.lastIndexOf('}') + 1;
                const json = JSON.parse(text.substring(jsonStart, jsonEnd));
                
                const rows = json.table.rows;
                const listasNaPlanilha = [];
                
                // Pular cabe√ßalho (primeira linha)
                // Formato da planilha: ID_LISTA(A), NOME_LISTA(B), CATEGORIA(C), SUBCATEGORIA(D), QTD_CONTATOS(E), DATA_CRIACAO(F), ULTIMO_ENVIO(G), STATUS(H), DESCRICAO(I)
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i];
                    if (row.c && row.c[1] && row.c[1].v) {
                        listasNaPlanilha.push({
                            nome: row.c[1]?.v || '',           // NOME_LISTA (coluna B)
                            categoria: row.c[2]?.v || '',      // CATEGORIA (coluna C)
                            filtroUF: row.c[3]?.v || 'TODOS',  // SUBCATEGORIA (coluna D) - usado como filtro
                            totalContatos: row.c[4]?.v || 0,   // QTD_CONTATOS (coluna E)
                            lotes: Math.ceil((row.c[4]?.v || 0) / 256) || 1, // Calcular lotes baseado em 256 contatos
                            status: row.c[7]?.v || 'ATIVO',    // STATUS (coluna H)
                            dataCriacao: row.c[5]?.v || '',    // DATA_CRIACAO (coluna F)
                            ultimaSync: row.c[6]?.v || ''      // ULTIMO_ENVIO (coluna G)
                        });
                    }
                }
                
                console.log(`üìã ${listasNaPlanilha.length} listas encontradas na planilha`);
                
                // Importar listas da planilha que n√£o existem no sistema
                let importadas = 0;
                listasNaPlanilha.forEach(listaPlanilha => {
                    const existeNoSistema = listasTransmissao.some(l => 
                        l.nome.toLowerCase() === listaPlanilha.nome.toLowerCase()
                    );
                    
                    if (!existeNoSistema && listaPlanilha.nome) {
                        // Criar lista no sistema baseada na planilha
                        const novaLista = {
                            id: 'lista_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                            nome: listaPlanilha.nome,
                            categoria: listaPlanilha.categoria.toLowerCase(),
                            uf: listaPlanilha.filtroUF,
                            contatos: [], // Ser√° preenchido com contatos filtrados
                            total: parseInt(listaPlanilha.totalContatos) || 0,
                            lotes: parseInt(listaPlanilha.lotes) || 1,
                            criadaEm: listaPlanilha.dataCriacao || new Date().toISOString(),
                            status: listaPlanilha.status === 'SINCRONIZADO' ? 'sincronizada' : 'ativa',
                            sincronizadaDaPlanilha: true
                        };
                        
                        // Filtrar contatos baseado na categoria e UF
                        let contatosFiltrados = [...contatosGoogleSheets];
                        if (novaLista.categoria && novaLista.categoria !== 'todos') {
                            contatosFiltrados = contatosFiltrados.filter(c => 
                                c.categoria && c.categoria.toLowerCase().includes(novaLista.categoria.toLowerCase())
                            );
                        }
                        if (novaLista.uf && novaLista.uf !== 'TODOS' && novaLista.uf !== 'todos') {
                            contatosFiltrados = contatosFiltrados.filter(c => c.uf === novaLista.uf);
                        }
                        
                        // Limitar ao total especificado ou 256 por lote
                        const maxContatos = Math.min(novaLista.total || contatosFiltrados.length, 256 * novaLista.lotes);
                        novaLista.contatos = contatosFiltrados.slice(0, maxContatos);
                        novaLista.total = novaLista.contatos.length;
                        
                        listasTransmissao.push(novaLista);
                        importadas++;
                    }
                });
                
                if (importadas > 0) {
                    localStorage.setItem('listasTransmissao', JSON.stringify(listasTransmissao));
                    renderizarListasTransmissao();
                    console.log(`‚úÖ ${importadas} listas importadas da planilha`);
                }
                
                // Mostrar resumo
                const totalSistema = listasTransmissao.length;
                const totalPlanilha = listasNaPlanilha.length;
                
                alert(`üîÑ Sincroniza√ß√£o Conclu√≠da!

üìä Listas na Planilha: ${totalPlanilha}
üíª Listas no Sistema: ${totalSistema}
üì• Importadas agora: ${importadas}

‚úÖ Sistema sincronizado com Google Sheets!

üí° Para adicionar novas listas √† planilha:
1. Crie a lista no sistema
2. Adicione manualmente na aba LISTAS_TRANSMISSAO
   ou use o bot√£o "Exportar para Planilha"`);
                
            } catch (error) {
                console.error('Erro ao sincronizar listas:', error);
                alert(`‚ö†Ô∏è Erro ao sincronizar listas: ${error.message}

As listas locais foram mantidas.
Verifique se a aba LISTAS_TRANSMISSAO existe na planilha.`);
            }
        }

        // Exportar listas do sistema para formato compat√≠vel com a planilha
        function exportarListasParaPlanilha() {
            if (listasTransmissao.length === 0) {
                alert('‚ö†Ô∏è Nenhuma lista para exportar. Crie listas primeiro.');
                return;
            }
            
            // Criar CSV com formato da planilha
            const headers = 'NOME_LISTA,CATEGORIA,FILTRO_UF,TOTAL_CONTATOS,LOTES,STATUS,DATA_CRIACAO,ULTIMA_SYNC';
            const rows = listasTransmissao.map(lista => {
                const dataSync = new Date().toLocaleDateString('pt-BR');
                return `${lista.nome},${lista.categoria?.toUpperCase() || 'TODOS'},${lista.uf || 'TODOS'},${lista.total},${Math.ceil(lista.total / 256)},SINCRONIZADO,${lista.criadaEm?.split('T')[0] || dataSync},${dataSync}`;
            });
            
            const csv = headers + '\n' + rows.join('\n');
            
            // Download do arquivo
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'LISTAS_TRANSMISSAO_EXPORT.csv';
            link.click();
            
            alert(`üì§ Exporta√ß√£o conclu√≠da!

${listasTransmissao.length} listas exportadas para CSV.

üìã Para adicionar √† planilha:
1. Abra a planilha Google Sheets
2. V√° para a aba LISTAS_TRANSMISSAO
3. Importe o arquivo CSV ou copie os dados

O arquivo foi baixado como: LISTAS_TRANSMISSAO_EXPORT.csv`);
        }

        // ==================== SISTEMA DE APRENDIZADOS ====================
        let aprendizados = JSON.parse(localStorage.getItem('aprendizados')) || [];
        let filtroAtualAprendizados = 'todos';

        function salvarAprendizado() {
            const titulo = document.getElementById('aprendizadoTitulo').value.trim();
            const categoria = document.getElementById('aprendizadoCategoria').value;
            const descricao = document.getElementById('aprendizadoDescricao').value.trim();
            
            if (!titulo || !descricao) {
                alert('‚ö†Ô∏è Preencha o t√≠tulo e a descri√ß√£o do aprendizado.');
                return;
            }
            
            const novoAprendizado = {
                id: Date.now(),
                titulo: titulo,
                categoria: categoria,
                descricao: descricao,
                criadoEm: new Date().toISOString(),
                util: 0
            };
            
            aprendizados.unshift(novoAprendizado);
            localStorage.setItem('aprendizados', JSON.stringify(aprendizados));
            
            // Limpar formul√°rio
            document.getElementById('aprendizadoTitulo').value = '';
            document.getElementById('aprendizadoDescricao').value = '';
            
            renderAprendizados();
            alert('‚úÖ Aprendizado salvo com sucesso!');
        }

        function renderAprendizados() {
            const container = document.getElementById('listaAprendizados');
            const statsContainer = document.getElementById('statsAprendizados');
            
            if (!container) return;
            
            // Filtrar aprendizados
            let aprendizadosFiltrados = aprendizados;
            if (filtroAtualAprendizados !== 'todos') {
                aprendizadosFiltrados = aprendizados.filter(a => a.categoria === filtroAtualAprendizados);
            }
            
            if (aprendizadosFiltrados.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-muted);">
                        <div style="font-size: 3em; margin-bottom: 10px;">üí°</div>
                        <p>Nenhum aprendizado registrado ainda.</p>
                        <p style="font-size: 0.9em;">Comece adicionando insights do seu neg√≥cio!</p>
                    </div>
                `;
            } else {
                container.innerHTML = aprendizadosFiltrados.map(a => {
                    const iconeCategoria = {
                        vendas: 'üí∞',
                        clientes: 'üë•',
                        produtos: 'üå≤',
                        processos: '‚öôÔ∏è',
                        marketing: 'üì£',
                        geral: 'üìù'
                    }[a.categoria] || 'üìù';
                    
                    const data = new Date(a.criadoEm).toLocaleDateString('pt-BR');
                    
                    return `
                        <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 8px; border-left: 4px solid var(--primary);">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                                <h4 style="color: var(--primary); margin: 0;">${iconeCategoria} ${a.titulo}</h4>
                                <div style="display: flex; gap: 8px;">
                                    <button onclick="marcarUtil(${a.id})" style="background: rgba(34,197,94,0.2); border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; color: #22c55e;" title="Marcar como √∫til">
                                        üëç ${a.util || 0}
                                    </button>
                                    <button onclick="excluirAprendizado(${a.id})" style="background: rgba(239,68,68,0.2); border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; color: #ef4444;" title="Excluir">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>
                            <p style="color: var(--text); margin: 0 0 10px 0; line-height: 1.6;">${a.descricao}</p>
                            <div style="font-size: 0.85em; color: var(--text-muted);">
                                üìÖ ${data} | üè∑Ô∏è ${a.categoria.charAt(0).toUpperCase() + a.categoria.slice(1)}
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            // Atualizar estat√≠sticas
            if (statsContainer) {
                const stats = {
                    total: aprendizados.length,
                    vendas: aprendizados.filter(a => a.categoria === 'vendas').length,
                    clientes: aprendizados.filter(a => a.categoria === 'clientes').length,
                    produtos: aprendizados.filter(a => a.categoria === 'produtos').length,
                    processos: aprendizados.filter(a => a.categoria === 'processos').length,
                    marketing: aprendizados.filter(a => a.categoria === 'marketing').length
                };
                
                statsContainer.innerHTML = `
                    <div style="background: rgba(14,165,233,0.2); padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2em; font-weight: bold; color: var(--primary);">${stats.total}</div>
                        <div style="color: var(--text-muted);">Total</div>
                    </div>
                    <div style="background: rgba(34,197,94,0.2); padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2em; font-weight: bold; color: #22c55e;">${stats.vendas}</div>
                        <div style="color: var(--text-muted);">Vendas</div>
                    </div>
                    <div style="background: rgba(168,85,247,0.2); padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2em; font-weight: bold; color: #a855f7;">${stats.clientes}</div>
                        <div style="color: var(--text-muted);">Clientes</div>
                    </div>
                    <div style="background: rgba(245,158,11,0.2); padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2em; font-weight: bold; color: #f59e0b;">${stats.produtos}</div>
                        <div style="color: var(--text-muted);">Produtos</div>
                    </div>
                `;
            }
        }

        function filtrarAprendizados(categoria) {
            filtroAtualAprendizados = categoria;
            
            // Atualizar bot√µes de filtro
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.style.background = 'rgba(0,0,0,0.3)';
                btn.style.color = 'var(--text-muted)';
            });
            
            const btnAtivo = document.querySelector(`.filter-btn[data-filter="${categoria}"]`);
            if (btnAtivo) {
                btnAtivo.classList.add('active');
                btnAtivo.style.background = 'var(--primary)';
                btnAtivo.style.color = 'white';
            }
            
            renderAprendizados();
        }

        function marcarUtil(id) {
            const aprendizado = aprendizados.find(a => a.id === id);
            if (aprendizado) {
                aprendizado.util = (aprendizado.util || 0) + 1;
                localStorage.setItem('aprendizados', JSON.stringify(aprendizados));
                renderAprendizados();
            }
        }

        function excluirAprendizado(id) {
            if (confirm('‚ö†Ô∏è Tem certeza que deseja excluir este aprendizado?')) {
                aprendizados = aprendizados.filter(a => a.id !== id);
                localStorage.setItem('aprendizados', JSON.stringify(aprendizados));
                renderAprendizados();
            }
        }

        // ==================== FIM SISTEMA DE APRENDIZADOS ====================

        // Carregar configura√ß√µes ao iniciar
        // ==================== FUN√á√ïES DA PLANILHA INTEGRADA ====================
        const PLANILHA_CONFIG = {
            spreadsheetId: '1FiP885Or0ncyRG_ZZaAvM2vP0sHhDzhLFYifYLjKyIE',
            baseUrl: 'https://docs.google.com/spreadsheets/d/1FiP885Or0ncyRG_ZZaAvM2vP0sHhDzhLFYifYLjKyIE/edit',
            // GIDs reais verificados via clique nas abas (grid-container ID):
            gids: {
                '1689968688': 'CONTATOS',
                '1716433489': 'FRETES_DISPONIVEIS',
                '1335082895': 'CAPTACAO_FRETES',
                '961123584': 'Leads_Motoristas',
                '1114979046': 'LISTAS_TRANSMISSAO',
                '250132552': 'MINHAS_LISTAS',
                '1707733664': 'RESUMO EXECUTIVO',
                '773407069': 'PAR√ÇMETROS',
                '1081938874': 'AN√ÅLISE CUSTOS',
                '2118458555': 'TRATAMENTO CCA',
                '85954134': 'SIMULADOR',
                '2085464626': 'RELAT√ìRIO',
                '1784972020': 'ESTADOS_CIDADES',
                '2046460774': 'VAREJO',
                '1142513380': 'Tabela din√¢mica 1',
                '1183996076': 'Detalhe1',
                '1656119291': 'GLOSS√ÅRIO',
                '2135374310': 'PROPOSTAS'
            }
        };

        function mudarAbaPlanilha(gid) {
            const iframe = document.getElementById('planilhaFrame');
            if (iframe) {
                iframe.src = `${PLANILHA_CONFIG.baseUrl}?usp=sharing&rm=minimal&gid=${gid}`;
                
                // Atualizar bot√µes ativos
                document.querySelectorAll('.planilha-tab').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.dataset.gid === gid) {
                        btn.classList.add('active');
                    }
                });
                
                // Atualizar timestamp
                const timestamp = document.getElementById('ultimaSincPlanilha');
                if (timestamp) {
                    timestamp.textContent = new Date().toLocaleTimeString('pt-BR');
                }
            }
        }

        function recarregarPlanilha() {
            const iframe = document.getElementById('planilhaFrame');
            if (iframe) {
                const currentSrc = iframe.src;
                iframe.src = '';
                setTimeout(() => {
                    iframe.src = currentSrc;
                    alert('‚úÖ Planilha recarregada com sucesso!');
                }, 100);
            }
        }

        async function sincronizarDadosPlanilha() {
            const statusEl = document.getElementById('statusGoogleSheets');
            if (statusEl) statusEl.innerHTML = '<span style="color: #f59e0b;">‚è≥ Sincronizando...</span>';

            // Aguardar o carregamento real dos contatos da planilha
            if (typeof carregarContatosGoogleSheets === 'function') {
                await carregarContatosGoogleSheets();
            }
            
            // Atualizar timestamp
            const timestamp = document.getElementById('ultimaSincPlanilha');
            if (timestamp) {
                timestamp.textContent = new Date().toLocaleTimeString('pt-BR');
            }

            // Usar a vari√°vel correta: contatosGoogleSheets (n√£o contatosUnificados)
            const total = contatosGoogleSheets.length;
            const fornecedores = contatosGoogleSheets.filter(c => c.categoria?.toUpperCase().includes('FORNECEDOR')).length;
            const clientes = contatosGoogleSheets.filter(c => c.categoria?.toUpperCase().includes('CLIENTE')).length;
            const transportadores = contatosGoogleSheets.filter(c => c.categoria?.toUpperCase().includes('TRANSPORTADOR')).length;

            // Expor globalmente para outras fun√ß√µes que usam window.contatosGoogleSheets
            window.contatosGoogleSheets = contatosGoogleSheets;

            if (statusEl) statusEl.innerHTML = `<span style="color: #22c55e;">‚úÖ ${total} contatos</span>`;
            alert(`‚úÖ Dados sincronizados com sucesso!\n\nüìä Contatos: ${total} registros\nüè≠ Fornecedores: ${fornecedores}\nüë• Clientes: ${clientes}\nüöö Transportadores: ${transportadores}`);
        }
        // ==================== FIM FUN√á√ïES DA PLANILHA ====================

        // ==================== FUN√á√ïES CAPTA√á√ÉO DE FRETES ====================
        // Dados din√¢micos carregados da planilha FRETES_DISPONIVEIS
        let fretesDisponiveisIntegrado = [];
        let captacaoFretesData = [];

        // Carregar fretes da planilha Google Sheets (via Web App ou gviz)
        async function carregarFretesGoogleSheets() {
            // Tentar primeiro via Web App (mais confi√°vel)
            try {
                const webAppUrl = GOOGLE_SHEETS_CONFIG.webAppUrl;
                if (webAppUrl) {
                    const response = await fetch(`${webAppUrl}?action=getFretes`);
                    if (response.ok) {
                        const data = await response.json();
                        if (data.success && data.fretes) {
                            fretesDisponiveisIntegrado = data.fretes;
                            console.log('‚úÖ Fretes carregados via Web App:', fretesDisponiveisIntegrado.length);
                            renderizarFretesIntegrado(fretesDisponiveisIntegrado);
                            return fretesDisponiveisIntegrado;
                        }
                    }
                }
            } catch (webAppError) {
                console.warn('‚ö†Ô∏è Web App n√£o dispon√≠vel, tentando gviz...', webAppError.message);
            }
            
            // Fallback para gviz
            try {
                const sheetId = GOOGLE_SHEETS_CONFIG.spreadsheetId;
                const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=FRETES_DISPONIVEIS`;
                
                const response = await fetch(url);
                const text = await response.text();
                
                const jsonStart = text.indexOf('{');
                const jsonEnd = text.lastIndexOf('}') + 1;
                
                if (jsonStart === -1 || jsonEnd === 0) {
                    throw new Error('Resposta inv√°lida da planilha');
                }
                
                const jsonData = JSON.parse(text.substring(jsonStart, jsonEnd));
                
                if (!jsonData.table || !jsonData.table.rows) {
                    throw new Error('Estrutura de dados inv√°lida');
                }
                
                const rows = jsonData.table.rows;
                // Pular linha 1 (cabe√ßalho) e linha 2 (marca√ß√µes VAI_HTML)
                fretesDisponiveisIntegrado = rows.slice(2).map((row, index) => {
                    const getValue = (idx) => row.c && row.c[idx]?.v || '';
                    const vaiHtml = rows[1]?.c && rows[1].c[idx]?.v || 'NAO';
                    
                    // S√≥ incluir se VAI_HTML = SIM na coluna O (√≠ndice 14)
                    const vaiParaHtml = rows[1]?.c && rows[1].c[14]?.v === 'SIM';
                    
                    return {
                        id: getValue(0) || index + 1,
                        estadoOrigem: getValue(1),
                        origem: getValue(2),
                        estadoDestino: getValue(3),
                        destino: getValue(4),
                        km: parseFloat(getValue(5)) || 0,
                        tipoVeiculo: getValue(6),
                        capacidade: getValue(7),
                        valorPago: parseFloat(getValue(8)) || 0,
                        contato: getValue(9),
                        whatsapp: getValue(10),
                        status: getValue(11),
                        valorKm: parseFloat(getValue(12)) || 0,
                        valorSugerido: parseFloat(getValue(13)) || 0,
                        vaiHtml: getValue(14) === 'SIM',
                        carga: 'Madeira',
                        peso: getValue(7) + ' toneladas',
                        urgente: getValue(11) === 'URGENTE',
                        embarque: 'A combinar'
                    };
                }).filter(f => f.estadoOrigem && f.estadoDestino);
                
                console.log('‚úÖ Fretes carregados da planilha:', fretesDisponiveisIntegrado.length);
                renderizarFretesIntegrado(fretesDisponiveisIntegrado);
                return fretesDisponiveisIntegrado;
            } catch (error) {
                console.warn('‚ö†Ô∏è Usando fretes de exemplo:', error.message);
                // Dados de fallback
                fretesDisponiveisIntegrado = [
                    {id: 1, origem: 'Curitiba', estadoOrigem: 'PR', destino: 'S√£o Paulo', estadoDestino: 'SP', km: 408, valorSugerido: 2850, tipoVeiculo: 'Carreta', carga: 'Madeira', peso: '25 toneladas', urgente: true, embarque: 'Hoje'},
                    {id: 2, origem: 'Tubar√£o', estadoOrigem: 'SC', destino: 'Rio de Janeiro', estadoDestino: 'RJ', km: 920, valorSugerido: 5200, tipoVeiculo: 'Carreta', carga: 'Compensados', peso: '28 toneladas', urgente: true, embarque: 'Amanh√£'}
                ];
                renderizarFretesIntegrado(fretesDisponiveisIntegrado);
                return fretesDisponiveisIntegrado;
            }
        }

        // Carregar dados de capta√ß√£o de motoristas da planilha
        async function carregarCaptacaoFretesGoogleSheets() {
            try {
                const sheetId = GOOGLE_SHEETS_CONFIG.spreadsheetId;
                const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=CAPTACAO_FRETES`;
                
                const response = await fetch(url);
                const text = await response.text();
                
                const jsonStart = text.indexOf('{');
                const jsonEnd = text.lastIndexOf('}') + 1;
                
                if (jsonStart === -1 || jsonEnd === 0) {
                    throw new Error('Resposta inv√°lida da planilha');
                }
                
                const jsonData = JSON.parse(text.substring(jsonStart, jsonEnd));
                
                if (!jsonData.table || !jsonData.table.rows) {
                    throw new Error('Estrutura de dados inv√°lida');
                }
                
                const rows = jsonData.table.rows;
                captacaoFretesData = rows.slice(1).map((row, index) => {
                    const getValue = (idx) => row.c && row.c[idx]?.v || '';
                    return {
                        timestampP1: getValue(0),
                        nomeCompleto: getValue(1),
                        whatsapp: getValue(2),
                        interesseSeguro: getValue(3),
                        rotaPreferida1: getValue(4),
                        rotaPreferida2: getValue(5),
                        rotaPreferida3: getValue(6),
                        rotaPreferida4: getValue(7),
                        rotaPreferida5: getValue(8),
                        timestampP2: getValue(9),
                        freteId: getValue(10),
                        rotaFrete: getValue(11),
                        valorSugerido: getValue(12),
                        valorProposta: getValue(13),
                        prazoEntrega: getValue(14),
                        placaVeiculo: getValue(15),
                        disponibilidade: getValue(16),
                        observacoes: getValue(17),
                        timestampP3: getValue(18),
                        tipoProfissional: getValue(19),
                        tipoVeiculo: getValue(20),
                        capacidadeCarga: getValue(21),
                        anoFabricacao: getValue(22),
                        tipoCarroceria: getValue(23),
                        possuiRastreador: getValue(24)
                    };
                }).filter(m => m.nomeCompleto);
                
                console.log('‚úÖ Capta√ß√£o de motoristas carregada:', captacaoFretesData.length);
                return captacaoFretesData;
            } catch (error) {
                console.warn('‚ö†Ô∏è Erro ao carregar capta√ß√£o:', error.message);
                return [];
            }
        }

        // Enviar cadastro de motorista para a planilha
        async function enviarCadastroParaPlanilha(dados) {
            // Por enquanto, apenas log - integra√ß√£o completa requer Apps Script
            console.log('üì§ Dados para enviar √† planilha:', dados);
            return true;
        }
        
        // Fun√ß√£o para enviar capta√ß√£o r√°pida
        async function enviarCaptacaoRapida() {
            const nome = document.getElementById('captacaoNomeCompleto').value.trim();
            const whatsapp = document.getElementById('captacaoWhatsApp').value.trim();
            const interesseSeguro = document.getElementById('captacaoInteresseSeguro').value;
            const statusDiv = document.getElementById('statusCaptacaoRapida');
            
            if (!nome || !whatsapp) {
                statusDiv.innerHTML = '<p style="color: #ef4444;">‚ö†Ô∏è Por favor, preencha todos os campos obrigat√≥rios.</p>';
                return;
            }
            
            statusDiv.innerHTML = '<p style="color: #f59e0b;">‚è≥ Enviando cadastro...</p>';
            
            try {
                const dados = {
                    timestamp: new Date().toISOString(),
                    nomeCompleto: nome,
                    whatsapp: whatsapp,
                    interesseSeguro: interesseSeguro
                };
                
                // Salvar localmente
                const captacoes = JSON.parse(localStorage.getItem('captacoesFretes') || '[]');
                captacoes.push(dados);
                localStorage.setItem('captacoesFretes', JSON.stringify(captacoes));
                
                // Enviar para Google Sheets via Web App
                const webAppUrl = GOOGLE_SHEETS_CONFIG.webAppUrl;
                if (webAppUrl) {
                    try {
                        await fetch(webAppUrl, {
                            method: 'POST',
                            mode: 'no-cors',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                action: 'addCaptacao',
                                sheet: 'CAPTACAO_FRETES',
                                data: dados
                            })
                        });
                        console.log('‚úÖ Dados enviados para Google Sheets via Web App');
                    } catch (webAppError) {
                        console.warn('‚ö†Ô∏è Erro ao enviar para Web App:', webAppError);
                    }
                }
                
                statusDiv.innerHTML = `
                    <div style="background: rgba(34,197,94,0.2); padding: 15px; border-radius: 8px; border: 1px solid #22c55e;">
                        <p style="color: #22c55e; font-weight: bold; font-size: 1.2em;">‚úÖ Cadastro realizado com sucesso!</p>
                        <p style="color: #fff; margin-top: 10px;">Obrigado, ${nome}! Em breve entraremos em contato pelo WhatsApp.</p>
                    </div>
                `;
                
                // Limpar formul√°rio
                document.getElementById('captacaoNomeCompleto').value = '';
                document.getElementById('captacaoWhatsApp').value = '';
                
                console.log('‚úÖ Capta√ß√£o salva:', dados);
            } catch (error) {
                console.error('Erro ao enviar capta√ß√£o:', error);
                statusDiv.innerHTML = '<p style="color: #22c55e;">‚úÖ Cadastro salvo localmente! Sincroniza√ß√£o pendente.</p>';
            }
        }

        function renderizarFretesIntegrado(fretes) {
            const container = document.getElementById('containerFretesIntegrado');
            if (!container) return;
            
            if (fretes.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #FFD700; font-size: 1.2em;">Nenhum frete encontrado com os filtros selecionados.</div>';
                return;
            }
            
            container.innerHTML = fretes.map(frete => `
                <div class="fretes-frete-card">
                    <div class="fretes-frete-header">
                        <div class="fretes-frete-rota">${frete.origem} - ${frete.estadoOrigem} ‚Üí ${frete.destino} - ${frete.estadoDestino}</div>
                        ${frete.urgente ? '<div class="fretes-badge-urgente">üî• URGENTE</div>' : ''}
                    </div>
                    <div class="fretes-frete-detalhes">
                        <div class="fretes-frete-info">
                            <div class="fretes-frete-info-label">Dist√¢ncia</div>
                            <div class="fretes-frete-info-valor">${frete.km} km</div>
                        </div>
                        <div class="fretes-frete-info">
                            <div class="fretes-frete-info-label">Valor Sugerido</div>
                            <div class="fretes-frete-info-valor fretes-valor-destaque">R$ ${frete.valorSugerido.toLocaleString('pt-BR')}</div>
                        </div>
                        <div class="fretes-frete-info">
                            <div class="fretes-frete-info-label">Tipo Ve√≠culo</div>
                            <div class="fretes-frete-info-valor">${frete.tipoVeiculo}</div>
                        </div>
                        <div class="fretes-frete-info">
                            <div class="fretes-frete-info-label">Carga</div>
                            <div class="fretes-frete-info-valor">${frete.carga}</div>
                        </div>
                        <div class="fretes-frete-info">
                            <div class="fretes-frete-info-label">Peso</div>
                            <div class="fretes-frete-info-valor">${frete.peso}</div>
                        </div>
                        <div class="fretes-frete-info">
                            <div class="fretes-frete-info-label">Embarque</div>
                            <div class="fretes-frete-info-valor">${frete.embarque}</div>
                        </div>
                    </div>
                    <button class="fretes-btn fretes-btn-secondary" onclick="fazerPropostaFrete(${frete.id})" style="margin-top: 15px;">
                        üíº FAZER PROPOSTA
                    </button>
                </div>
            `).join('');
        }

        function filtrarFretesIntegrado() {
            const estadoOrigem = document.getElementById('filtroEstadoOrigemFretes')?.value || '';
            const estadoDestino = document.getElementById('filtroEstadoDestinoFretes')?.value || '';
            const tipoVeiculo = document.getElementById('filtroTipoVeiculoFretes')?.value || '';
            const valorMinimo = parseFloat(document.getElementById('filtroValorMinimoFretes')?.value) || 0;
            
            const fretesFiltrados = fretesDisponiveisIntegrado.filter(frete => {
                if (estadoOrigem && frete.estadoOrigem !== estadoOrigem) return false;
                if (estadoDestino && frete.estadoDestino !== estadoDestino) return false;
                if (tipoVeiculo && frete.tipoVeiculo !== tipoVeiculo) return false;
                if (frete.valorSugerido < valorMinimo) return false;
                return true;
            });
            
            renderizarFretesIntegrado(fretesFiltrados);
        }

        function fazerPropostaFrete(freteId) {
            const frete = fretesDisponiveisIntegrado.find(f => f.id === freteId);
            if (!frete) return;
            
            const valor = prompt(`üí∞ Qual seu valor para o frete ${frete.origem} ‚Üí ${frete.destino}?

Valor sugerido: R$ ${frete.valorSugerido.toLocaleString('pt-BR')}`);
            if (valor) {
                alert(`‚úÖ Proposta de R$ ${valor} enviada com sucesso!

Rota: ${frete.origem} ‚Üí ${frete.destino}
Entraremos em contato pelo WhatsApp.`);
            }
        }

        function abrirModalCadastroMotorista() {
            document.getElementById('modalCadastroMotorista').style.display = 'flex';
        }

        function fecharModalCadastroMotorista() {
            document.getElementById('modalCadastroMotorista').style.display = 'none';
        }

        function enviarCadastroMotorista() {
            const nome = document.getElementById('nomeMotorista')?.value;
            const whatsapp = document.getElementById('whatsappMotorista')?.value;
            const tipoVeiculo = document.getElementById('tipoVeiculoMotorista')?.value;
            const placa = document.getElementById('placaMotorista')?.value;
            
            if (!nome || !whatsapp || !tipoVeiculo || !placa) {
                alert('‚ö†Ô∏è Preencha todos os campos obrigat√≥rios!');
                return;
            }
            
            alert(`‚úÖ Cadastro realizado com sucesso!

Nome: ${nome}
WhatsApp: ${whatsapp}
Ve√≠culo: ${tipoVeiculo}
Placa: ${placa}

Em breve entraremos em contato com ofertas de frete!`);
            fecharModalCadastroMotorista();
            
            // Limpar formul√°rio
            document.getElementById('formCadastroMotoristaIntegrado')?.reset();
        }

        // Inicializar fretes ao carregar a aba
        async function initFretesIntegrado() {
            // Carregar dados da planilha Google Sheets
            await carregarFretesGoogleSheets();
            await carregarCaptacaoFretesGoogleSheets();
        }
        // ==================== FIM FUN√á√ïES CAPTA√á√ÉO DE FRETES ====================

        // ==================== FUN√á√ïES PARA ABRIR HTMLs EXTERNOS ====================
        function abrirCRMContatos() {
            window.open('CONTATOS_CRM.html', '_blank');
        }

        function abrirFretesDisponiveis() {
            window.open('FRETES_DISPONIVEIS.html', '_blank');
        }

        function abrirCaptacaoFretesHTML() {
            window.open('CAPTACAO_FRETES.html', '_blank');
        }
        // ==================== FIM FUN√á√ïES HTMLs EXTERNOS ====================

        document.addEventListener('DOMContentLoaded', function() {
            carregarTema();
            if (document.getElementById('evolutionUrl')) carregarConfigEvolution();
            if (document.getElementById('openaiKey')) carregarAPIKeys();
            renderizarListasTransmissao();
            renderAprendizados();
            // Reconectar GitHub automaticamente se estava conectado
            reconectarGitHub();
            console.log('Planilha integrada:', GOOGLE_SHEETS_CONFIG.spreadsheetName);
            console.log('‚úÖ Sistema ENSIDE MASTER v20.0 - Abas sincronizadas com Google Sheets');
            // Inicializar Capta√ß√£o de Fretes
            initFretesIntegrado();
            // Carregar contatos da planilha ao iniciar e atualizar KPIs do Dashboard
            carregarContatosGoogleSheets().then(() => {
                atualizarDashboard();
                atualizarEstatisticasTriagem();
                // Atualizar contador de contatos no Evolution
                const evContacts = document.getElementById('evolutionContacts');
                if (evContacts) evContacts.textContent = contatosGoogleSheets.length.toLocaleString('pt-BR');
                console.log('‚úÖ Contatos carregados da planilha CONTATOS (gid=1689968688):', contatosGoogleSheets.length);
            }).catch(err => console.warn('‚ö†Ô∏è Falha ao carregar contatos na inicializa√ß√£o:', err.message));
        });
    
        // ==================== INTEGRA√á√ÉO EVOLUTION API ====================
        // Credenciais pr√©-configuradas da Evolution API
        const EVOLUTION_CONFIG = {
            url: 'https://evolution-api-enside.onrender.com',
            apiKey: 'evolution-api-enside-2024-secret',
            instance: 'ENSIDE',
            instanceId: 'ENSIDE',
            webhook: 'https://evolution-api-enside.onrender.com/webhook'
        };

        // Fun√ß√£o para testar conex√£o com Evolution API (endpoint correto v2.0.0)
        async function testarConexaoEvolutionAPI() {
            try {
                const response = await fetch(EVOLUTION_CONFIG.url + '/api/instance/status', {
                    headers: { 'apikey': EVOLUTION_CONFIG.apiKey }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('‚úÖ Evolution API Conectada:', data.instance, '| Status:', data.status, '| Conectado:', data.connected);
                    return true;
                } else {
                    console.error('‚ùå Erro ao conectar Evolution API: HTTP', response.status);
                    return false;
                }
            } catch (error) {
                console.error('‚ùå Erro de conex√£o Evolution API:', error.message);
                return false;
            }
        }

        // Fun√ß√£o para enviar mensagem via Evolution API (endpoint correto v2.0.0)
        async function enviarMensagemEvolutionAPI(phone, message) {
            try {
                // Formatar telefone
                const tel = String(phone).replace(/\D/g, '');
                const telefone = tel.startsWith('55') ? tel : '55' + tel;
                
                const response = await fetch(EVOLUTION_CONFIG.url + '/api/message/send', {
                    method: 'POST',
                    headers: { 
                        'apikey': EVOLUTION_CONFIG.apiKey,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ phone: telefone, message: message })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('‚úÖ Mensagem enviada:', data.messageId, '| Status:', data.status);
                    return true;
                } else {
                    const err = await response.json().catch(() => ({}));
                    console.error('‚ùå Erro ao enviar mensagem:', err.error || response.status);
                    return false;
                }
            } catch (error) {
                console.error('‚ùå Erro:', error.message);
                return false;
            }
        }

        // Fun√ß√£o para listar contatos da Evolution API (endpoint correto v2.0.0)
        async function listarContatosEvolution() {
            try {
                const response = await fetch(EVOLUTION_CONFIG.url + '/api/contacts/list', {
                    headers: { 'apikey': EVOLUTION_CONFIG.apiKey }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const contatos = data.contacts || data;
                    console.log('‚úÖ Contatos da Evolution API:', contatos.length || data.total, 'contatos');
                    return contatos;
                } else {
                    console.error('‚ùå Erro ao carregar contatos: HTTP', response.status);
                    return [];
                }
            } catch (error) {
                console.error('‚ùå Erro:', error.message);
                return [];
            }
        }

        // Fun√ß√£o para exportar contatos da planilha para a Evolution API
        async function exportarContatosParaEvolution(limite = 100) {
            const contatos = window.contatosGoogleSheets || [];
            if (contatos.length === 0) {
                console.warn('‚ö†Ô∏è Nenhum contato carregado. Sincronize a planilha primeiro.');
                return { exportados: 0, erros: 0 };
            }

            const lote = contatos.slice(0, limite);
            const phones = lote.map(c => {
                const tel = String(c.telefone || '').replace(/\D/g, '');
                return tel.startsWith('55') ? tel : '55' + tel;
            }).filter(t => t.length >= 12);

            console.log(`üì§ Exportando ${phones.length} contatos para Evolution API...`);

            try {
                const response = await fetch(EVOLUTION_CONFIG.url + '/api/message/send-bulk', {
                    method: 'POST',
                    headers: { 'apikey': EVOLUTION_CONFIG.apiKey, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phones, message: 'Contato registrado no sistema ENSIDE.' })
                });
                if (response.ok) {
                    const data = await response.json();
                    console.log(`‚úÖ ${data.messagesSent} contatos exportados para Evolution API`);
                    return { exportados: data.messagesSent, erros: 0 };
                }
            } catch (e) {
                console.error('‚ùå Erro ao exportar:', e.message);
            }
            return { exportados: 0, erros: phones.length };
        }
        // ==================== FIM INTEGRA√á√ÉO EVOLUTION API ====================

        // Validar credenciais ao carregar
        function validarCredenciais() {
            const url = document.getElementById('evolutionUrl')?.value || EVOLUTION_CONFIG.url;
            const key = document.getElementById('evolutionApiKey')?.value || EVOLUTION_CONFIG.apiKey;
            const instance = document.getElementById('evolutionInstance')?.value || EVOLUTION_CONFIG.instance;
            const webhook = document.getElementById('webhookUrl')?.value || EVOLUTION_CONFIG.webhook;
            const sheets = document.getElementById('googleSheetsId')?.value;
            
            if (url && key && instance && webhook && sheets) {
                console.log('‚úÖ Todas as credenciais est√£o configuradas!');
                return true;
            } else {
                console.warn('‚ö†Ô∏è Algumas credenciais est√£o faltando');
                return false;
            }
        }
        
        // Executar valida√ß√£o ao carregar
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                validarCredenciais();
                testarConexaoEvolutionAPI();
            }, 1000);
        });

    </script>
    <!-- Scripts externos ENSIDE -->
</body>
</html><!-- deploy fix -->
<!-- force deploy s√°b 21 fev 2026 13:29:10 -03 -->
